PAGE_TITLE_TO=null;var main_poster;Profile={with_name:true,own_profile:null,is_channel:false,$dashboard:null,own_profile_ajax_deferred:null,init:function(){Profile.$dashboard=$dashboard=jQuery("#plurk-dashboard");Profile.is_channel=$dashboard.hasClass("is_channel");Profile.plurkbuddy=$dashboard.hasClass("plurkbuddy");Profile.own_profile=$dashboard.hasClass("own");Profile._initPageUser();if(!SiteState.canEdit()){Profile._showPublicTimeline()}},_showPublicTimeline:function(){if(window.PUBLIC_PLURKS&&GLOBAL.page_user.timeline_privacy==0){TimeLine._plurksFetched(PUBLIC_PLURKS);DisplayOptions.show()}else{TimeLine.getPlurks(function(){DisplayOptions.show()})}},_initPageUser:function(){var b=SiteState.getPageUser();if(!b){return}MISC={invite_url:b.invite_url};if(SiteState.canEdit()){Profile.fetchInitialTimeline()}if(b.is_warned&&!b.was_warned){(new PopWindow({url:"/Users/showWarning",width:440,height:200})).show()}Profile._initDashboard(b);Profile._initPlurkBox();Profile._initMouseEvent();if(!b.no_spider){if(b.show_spider){TimeLine.showSpider()}else{if(b.last_visit){var e=b.last_visit;var c=new Date();var d=c-e;var a=d/(1000*86400);if(a>=90){TimeLine.showSpider()}}}}setTimeout(function(){var f=location.search;var h=/window=([^&]*)/.exec(location.search);if(h&&h.length==2){h=h[1]}if(h=="alerts"){return TopBar.showNotifications()}else{if(h=="invite"){return TopBar.showFriends("inviteFriends")}else{if(h=="FacebookApp"){return TopBar.showMyAccount("/FacebookApp")}else{if(h=="TwitterApp"){return TopBar.showMyAccount("/TwitterApp")}else{if(h=="YahooApp"){return TopBar.showMyAccount("/YahooApp")}else{if(h=="wallet"){return TopBar.showPremium("/Premium/")}else{if(h=="purchase"){return TopBar.showPremium("/Premium/purchase")}else{if(h=="ads"){return TopBar.showPremium("/Premium/ads")}else{if(h=="transactions"){return TopBar.showPremium("/Premium/log")}else{if(h&&h.indexOf("/")==0){(new PopWindow({url:h,width:650})).show()}else{if(h=="restricted"){(new PopWindow({content:'<div style="width: 420px; padding: 10px 10px 10px 10px; font-size: 20px; line-height: 25px;">'+_("Sorry, you don't have permission to access this plurk.")+"</div>",width:440,height:0})).show()}else{if(h=="show_theme"){(new PopWindow({url:"/Settings/show?page=theme",width:650})).show();return}else{if(h=="install_design"){if(confirm(_("Are you sure you want to install a new design?\nYou can easily revert back to your old design."))){(new PopWindow({url:"/Settings/show?page=theme",width:650})).show();return}else{var g=AJS.getRequest("/deleteNewDesign");g.sendReq({})}}}}}}}}}}}}}}},50)},_initDashboard:function(){var a=SiteState.getPageUser();jQuery("#join_date").text(formatDate(a.join_date,a.dateformat));jQuery("#last_visit").text(formatDate(a.last_visit,a.dateformat));Profile.renderFans();if(!Profile.is_channel){Profile.renderFriends()}Profile._renderKarma();Profile._updateRelationship(a.relationship);if(!SiteState.canEdit()){if(!a.invitation_code){TimeLine.excludeUser=function(c){var b=SiteState.getPageUser().uid;return c!=b}}if(SiteState.getSessionUser()){Profile.renderFriendFan();SendGift.renderSendGift()}}},_initPlurkBox:function(){if(SiteState.canEdit()){var d=SiteState.getSessionUser();var c={lang:(d&&d.default_lang)||"en"};main_poster=new PlurkPoster(c);main_poster.onSubmit(function(e){main_poster.setPosting(true);jQuery.when(PlurkAdder.addPlurk(e)).done(function(f){main_poster.setPosting(false);main_poster.clear()}).fail(function(f){if(f&&f.msg){alert(f.msg)}main_poster.setPosting(false)})});jQuery("#main_poster").append(main_poster.table);var b=AJS.getQueryArgument("status");var a=AJS.getQueryArgument("qualifier");if(b){jQuery(main_poster.input).val(AJS.urldecode(b))}if(a){main_poster.menu.setQualifier(a)}jQuery("#plurk_form").css("display","block")}},_initMouseEvent:function(){var g=Profile.$dashboard;var a=g.find("#dash-profile");var c=g.find("#dash-stats");var m=c.find("#dash-stats-table");var d=g.find("#dash-friends");var h=g.find("#dash-award");if(Profile.own_profile){AddHoverToolTip(a.find("#profile_pic"),_("Click to Upload a profile picture"));c.find(".karma_hover").mouseover(function(){return Profile.karmaHoverOn(this)});var e=SiteState.getSessionUser();if(e){var f="",l="";f=e.location;l=f.substring(0,f.indexOf(","));if(l!=""){d.find("#loc_field").val(l)}}}var n=Utils.getYears(SiteState.getPageUser().date_of_birth);if(n){a.find("#span_years").text(n)}h.find("#award_bar").replaceWith(Badges.render(SiteState.getPageUser()));d.find("#dashboard-invite").click(function(){_gaq_push(["_trackEvent","Invite","click","dashboard"]);return false});var j=g.find("#dash-fans");if(Object.keys(FRIENDS).length>8){j.find("#tw_help").hide()}j.find("#block_user a").mouseenter(function(o){HoverPopView(this,false,{content:_("A blocked user won't be able to see your profile, follow you, respond to your plurks or befriend you. You can use this feature to protect yourself."),ex_class:"popTooltip",direction:"bottom"})});if(Profile.own_profile){j.find("#sharePlurk #invite_url").val(MISC.invite_url).click(function(){return Utils.copyToClipboard(this)}).mouseenter(function(o){HoverPopView(this,false,{content:_("Users that sign up via this link will automatically become your fans.").trim(),ex_class:"popTooltip",direction:"bottom"})});var b=j.find(".dash-icon");b.find(".promo-clique a").mouseenter(function(o){HoverPopView(this,false,{content:_("Group your friends with clique").trim(),ex_class:"popTooltip",direction:"bottom"})});b.find(".promo-facebook a").mouseenter(function(o){HoverPopView(this,false,{content:_("Share your plurks on facebook").trim(),ex_class:"popTooltip",direction:"bottom"})});b.find(".promo-mobile a").mouseenter(function(o){HoverPopView(this,false,{content:_("Visit your mobile Plurk page").trim(),ex_class:"popTooltip",direction:"bottom"})});b.find(".promo-widget a").mouseenter(function(o){HoverPopView(this,false,{content:_("Embed your Plurk widget").trim(),ex_class:"popTooltip",direction:"bottom"})})}},renderFriendFan:function(){var a=SiteState.getPageUser();if(a.has_block||a.nick_name=="plurkbuddy"){return}var b=new FriendFanStatusButton(a);Profile.friendFanButton=b;jQuery("#render_friend").empty().append(b.friend_holder);jQuery("#render_follow").empty().append(b.follow_holder,b.fan_holder);jQuery(b.friend_holder).click(function(){FriendFanEditor.switchFriendState(a)});jQuery(b.follow_holder).click(function(){FriendFanEditor.switchFollowState(a)});FriendFanEditor.addUpdatedEvent(function(){Profile.friendFanButton.updateState();var c=SiteState.getSessionUser();if(a.are_friends){FRIENDS[c.id]=c}else{delete FRIENDS[c.id];if(a.is_following){FANS[c.id]=c}else{delete FANS[c.uid]}Profile.renderFans()}Profile.renderFriends()});jQuery("#num_of_mutual_friends").text(a.num_of_mutual_friends)},_genericRender:function(h,l,a){var h=AJS.$(h);if(!h){return}var b=function(o,n){jQuery(o).mouseover(function(){Profile.showFriendInfo(o,n)})};var e=jQuery('<ul class="clearfix">');var m=l.length;var d=0;while(m>0){if(SiteState.canEdit()&&d>7){break}if(!SiteState.canEdit()&&d>11||l.length==0){break}var c=Math.floor((l.length-1)*Math.random());var j=FRIENDS[l[c]]||FANS[l[c]]||USERS[l[c]]||SiteState.getUserById(l[c]);l.splice(c,1);if(!j||(a&&j.only_fan==1)){continue}if(j.user_id==99999){continue}var g="//s.plurk.com/dd62d0912d070c4769e88e6cb760cfbc.gif";if(j.has_profile_image){g=Users.getUserImgSrc(j,"medium")}var f=jQuery('<li><a href="/'+j.nick_name+'" class="user_link"><img src="'+g+'"></a></li>').appendTo(e);b(f[0],j);d++}jQuery(h).empty().append(e)},_genericRenderList:function(h,l,a){var h=AJS.$(h);if(!h){return}var b=function(o,n){jQuery(o).mouseover(function(){Profile.showFriendInfo(o,n)})};var l=l.slice(0);var e=AJS.UL({c:"clearfix"});var m=l.length;var d=0;while(true&&m>0){if(SiteState.canEdit()&&d>7){break}if(!SiteState.canEdit()&&d>15||l.length==0){break}var c=Math.floor((l.length-1)*Math.random());var j=FRIENDS[l[c]]||FANS[l[c]]||USERS[l[c]]||SiteState.getUserById(l[c]);l.splice(c,1);if(!j||(a&&j.only_fan==1)){continue}if(j.user_id==99999){continue}var g="//s.plurk.com/dd62d0912d070c4769e88e6cb760cfbc.gif";if(j.has_profile_image){g=Users.getUserImgSrc(j,"medium")}var f=AJS.A({href:"/"+j.nick_name,c:"user_link"},AJS.IMG({src:g}));b(f,j);AJS.ACN(e,AJS.LI(f));d++}AJS.RCN(h,e)},_genericRenderListFull:function(a){if(!Array.isArray(a)||!window.SiteState){return null}var b={};a.forEach(function(d){var c=FRIENDS[d]||FANS[d]||USERS[d]||SiteState.getUserById(d);if(!c||c.user_id==99999){return}b[d]=c});return b},showFriendInfo:function(e,b,d){var a=jQuery(e).find("img").attr("src");var c='<div><img src="'+a.replace("small","medium")+'" width="45" height="45" style="float:left;margin-right:10px;"><b>'+b.full_name+"</b> @"+b.nick_name+"<br>"+Users.getGender(b)+" "+Users.getLocation(b)+"<br><span>"+_("Karma")+": "+b.karma+"</span></div>";HoverPopView(e,false,{content:c,ex_class:"popTooltip",direction:"bottom"})},renderFriends:function(){Profile._genericRender("friend_holder",AJS.keys(FRIENDS),true);if(AJS.keys(FRIENDS).length<1){AJS.RCN(AJS.$("friend_holder"),AJS.SPAN(_("No friends yet.")),AJS.A({s:"margin-left:4px",href:"/?window=invite"},_("Invite your friends now!")))}},renderFans:function(){if(!AJS.$("fan_holder")){return false}Profile._genericRender("fan_holder",AJS.keys(FANS));var b=null;if(SiteState.canEdit()){b=AJS.P({s:"margin-top: 8px"},AJS.SMALL(_("Fans are people that follow your time line, but aren't on your friends list.")))}if(AJS.keys(FANS).length==0){AJS.RCN(AJS.$("fan_holder"),AJS.SPAN(_("No fans yet."),b))}if(GLOBAL.page_user.timeline_privacy!=0&&SiteState.canEdit()){var c=AJS.A({href:"javascript:void(0)"},_("Change Privacy in My Account"));AJS.onEvent(c,"click",TopBar.showPrivacy);AJS.RCN(AJS.$("fan_holder"),AJS.SPAN(_("Currently you can't have fans. You need to allow everyone to view your plurks first. "),AJS.BR(),AJS.BR(),c,b));AJS.hideElement(AJS.$bytc("div","show_all_friends",AJS.$("dash-fans")))}else{if(GLOBAL.page_user.timeline_privacy!=0){var a=SiteState.getPageUser().gender==0&&"her"||"his";AJS.RCN(AJS.$("fan_holder"),AJS.SPAN(_("This user can't have fans due to their privacy settings.")));AJS.hideElement(AJS.$bytc("div","show_all_friends",AJS.$("dash-fans")))}}},prefetchTimeline:function(){if(SiteState.canEdit()){Profile.own_profile_ajax_deferred=jQuery.Deferred();var b=AJS.loadJSON("/Users/getOwnProfileData");b.addCallback(function(c){Profile.own_profile_ajax_deferred.resolve(c)});var a=AJS.keys(FRIENDS);b.sendReq({known_friends:AJS.serializeJSON(a)})}},fetchInitialTimeline:function(){Profile.own_profile_ajax_deferred.done(function(d){AJS.update(USERS,d.replurkers);Poll.disabled=true;Poll.init();var b=[AJS.$("update_mute"),AJS.$("noti_np"),AJS.$("noti_re")];AJS.showElement(AJS.$("updater"));AJS.hideElement(b);AJS.ACN(AJS.$("updater"),AJS.DIV({id:"unread_loader"},_("Loading unread...")," ",AJS.IMG({src:"//s.plurk.com/7f5c4282d2e9accfdae99cc6abb6c9bb.gif"})));var e=function(){AJS.hideElement(AJS.$("updater"));AJS.removeElement(AJS.$("unread_loader"));AJS.showElement(b);Poll.disabled=false};var c=AJS.loadJSON("/Users/getUnreadPlurks");c.addCallback(e);c.addCallback(function(f){AJS.update(USERS,f.replurkers);Poll.initUnreadPlurks(f.unread_plurks)});c.addErrback(e);c.addCallback(function(f){Poll.initUnreadPlurks([])});var a=AJS.keys(FRIENDS);c.sendReq({known_friends:AJS.serializeJSON(a)});TimeLine._plurksFetched(d.plurks);Profile.own_profile_ajax_deferred=undefined})},relationships:{not_saying:"",single:_("Single"),married:_("Married"),divorced:_("Divorced"),engaged:_("Engaged"),in_relationship:_("In Relationship"),unstable_relationship:_("In Unstable Relationship"),complicated:_("Complicated"),widowed:_("Widowed"),open_relationship:_("Open Relationship")},_updateRelationship:function(b){var a=Profile.$dashboard.find("#relationship");a.text(Profile.relationships[b])},showShareDesign:function(){(new PopWindow({url:"/showShareDesign",width:440,height:180})).show();return false},_renderKarma:function(){var a=Profile.$dashboard.find("#karma");if(!a.length){return}var b=SiteState.getPageUser().karma;var c="karma_red";if(b>=21){c="karma_orange"}if(b>=41){c="karma_yellow"}if(b>=61){c="karma_blue"}if(b>=81){c="karma_green"}if(b>=100){c="karma_top"}a.get(0).className=c;Profile.renderKarmaChange()},renderKarmaChange:function(){if(!SiteState.canEdit()){return}var b=Profile.$dashboard.find("#karma_arrow");if(!b.length){return}var a=SiteState.getPageUser().karma_change;if(a==0){return}var c=a<0&&"pif-arrow-down"||"pif-arrow-up";b.addClass(c).addClass("show")},_karma_tips:[_("Try to plurk regularly (each day), but don't plurk too much (over 30 times pr. day)"),_("Plurking interesting stuff and getting followers will increase your karma"),_("Losing followers will lower your karma"),_("Karma will be lowered if you request friendship and get rejected")+' <br /> <img src="/static/emoticons/platinum/idiot.gif" />',_("Inviting people to Plurk will gain you more karma")+' <br /> <img src="/static/emoticons/gold/rock_n_roll.gif" />',_("Responses from other plurkers will gain your karma"),_("Your karma will drop if you don't update your timeline each day"),_("Updating your profile (location, birth day etc.) will gain you more karma"),_("Uploading a profile picture will increase your karma"),_("Having fun on Plurk will increase your karma")+' <br /> <img src="/static/emoticons/silver/dance.gif" />',_("Getting more karma will enable you to use exclusive emoticons and other features"),_("Having karma over 40 will enable you to change your display name"),_("Having karma over 10 will enable you to title your profile")],cur_tip:0,_getRandomTip:function(){var b=null;var a=Profile._karma_tips;while(true){b=a[Math.round(Math.random()*(a.length-1))];if(b!=Profile.cur_tip){break}}Profile.cur_tip=b;return b},karma_view:null,karmaHoverOn:function(g){if(Profile.karma_view){return}var h=_("Karma has gone up %s since last karma update.");var j=_("Karma has gone down %s since last karma update.");var b=function(){var l="";l+="<br /><br /><b>"+_("Karma trend")+":</b><br />";l+='<div id="karma_trend_holder"><img src="//s.plurk.com/7f5c4282d2e9accfdae99cc6abb6c9bb.gif" /></div>';return l};var a=function(){var m=function(n){window.__karma_trend=n.replace("http://","//");AJS.RCN(AJS.$("karma_trend_holder"),AJS.IMG({c:"karma_graph",src:n}));if(Profile.karma_view){Profile.karma_view.layout()}};if(window.__karma_trend){m(window.__karma_trend)}else{if(!window.__karma_trend_req){window.__karma_trend_req=true;var l=AJS.getRequest("/Users/getKarmaGraph");l.addCallback(m);l.addErrback(function(){window.__karma_trend_req=false});l.sendReq({user_id:SiteState.getPageUser().id})}}};if(SiteState.canEdit()){var c=SiteState.getPageUser().karma_change;var f="";if(c<=0||c>0){f=format(h,"+"+c.toFixed(2));if(c<0){f=format(j,""+c.toFixed(2))}}var e=SiteState.getSessionUser().karma_fall_reason;if(SiteState.canEdit()&&e){f+="<br /><br /><b>"+_("Karma fall reason")+":</b><br />";if(e=="friends_rejections"){f+=_("You got too many friendship rejections.")}else{if(e=="too_much_plurking"||e=="too_short_responses"){f+=_("You plurked too much - remember to plurk interesting stuff.")}else{if(e=="karma_vacation"){f+=_("Karma vacation mode costs 1 karma points. Your karma is frozen. Unfreeze it from My Account.").replace("1","0.5")}else{if(e=="inactivity"){f+=_("You are too inactive. Tell us what you are thinking, feeling or doing!")}else{if(e=="spam_content"){f+="<font color=yellow>"+_('Many of your plurks contains content marked as spam by many other plurk users, which has violated our terms of service. <a href="%s">Click here to see how you can improve it.</a>').replace("%s","https://www.plurk.com/faq#spam")+"</font>"}}}}}}f+="<br /><br /><b>"+_("Karma tip")+":</b><br />"+Profile._getRandomTip();f+=b();Profile.karma_view=HoverPopView(g,true,{content:f,ex_class:"popTooltip karma_tooltip",direction:"bottom",onHide:function(){Profile.karma_view=null}})}else{var d=SiteState.getPageUser();var c=d.karma_change;f=format(h,c.toFixed(2));if(c<0){f=format(j,""+c.toFixed(2))}f+=b();Profile.karma_view=HoverPopView(g,true,{content:f,ex_class:"popTooltip karma_tooltip",direction:"bottom",onHide:function(){Profile.karma_view=null}})}a()},updatePageTitle:function(a){SiteState.getPageUser()["page_title"]=a;TopBar.updateTitle();if(PAGE_TITLE_TO){clearTimeout(PAGE_TITLE_TO)}PAGE_TITLE_TO=setTimeout(AJS.$p(Profile._ajaxSavePageTitle,a),500)},_ajaxSavePageTitle:function(b){var a=AJS.getRequest("/Settings/setPageTitle");a.addCallback(function(c){if(c){SiteState.getPageUser()["page_title"]=c;TopBar.updateTitle()}});a.sendReq({title:b})},_blockUserText:function(){return _("A blocked user won't be able to see your profile, follow you, respond to your plurks or befriend you. You can use this feature to protect yourself.")},blockCurrentUser:function(){(new PopWindow({url:"/Friends/blockUser?block_uid="+SiteState.getPageUser().id,width:650})).show()},unblockCurrentUser:function(){(new PopWindow({url:"/Friends/unblockUser?block_uid="+SiteState.getPageUser().id,width:650})).show()}};(function(a){if(top.FriendFanEditor){FriendFanEditor=top.FriendFanEditor;FriendFanStatusButton=top.FriendFanStatusButton;return}var d={};var c=0;var b=function(g,h,f){var e=jQuery.Deferred();a.post(g,h).done(function(j){e.resolve(j);a.each(d,function(l,m){m()})}).fail(function(){e.reject()});return e.promise()};FriendFanEditor={switchFriendState:function(f){var e=f.id;if(f.are_friends){a.when(b("/Users/removeFriend",{friend_id:e},e)).done(function(){f.friend_status=-1;f.are_friends=false;f.is_following=false;f.is_fan=false})}else{if(f.friend_status==0){a.when(b("/Notifications/removeNotification",{friend_id:e},e)).done(function(){f.friend_status=-1})}else{a.when(b("/Notifications/addNotification",{friend_id:e,cur_user:top.SiteState.getSessionUser().id},e)).done(function(g){g=parseInt(g);f.friend_status=g;if(g===1){f.are_friends=true;f.is_following=true;f.is_fan=null}})}}},switchFollowState:function(f){var e=f.id;var g={friend_id:e,cur_user:top.SiteState.getSessionUser().id,value:f.is_following?0:1};a.when(b("/Users/setFollowingTL",g,e)).done(function(){f.is_following=g.value})},addUpdatedEvent:function(e){d[++c]=e;return c},removeUpdatedEvent:function(e){delete d[e]}};FriendFanStatusButton=function(e,f){this._init(e,f)};FriendFanStatusButton.prototype={_init:function(e,f){var g=this;g.user=e;g.ops=a.extend({icon_only:false},f);g.bcls=" friend_man"+(g.ops.icon_only?" icon_only":"");if(!e.is_channel){g.friend_holder=a("<a void></a>")[0]}g.follow_holder=a("<a void></a>")[0];g.fan_holder=a("<a void></a>").addClass("pif-fans friend_man icon_only is_fan")[0];AddHoverToolTip(g.fan_holder,_("Your Fan"));g.updateState()},updateState:function(){this._updateFriendStatus();this._updateFollowStatus();this._updateFanStatus()},_updateFriendStatus:function(){var l=this;var g=l.user;if(l.friend_holder){var e,h,f,j;if(g.are_friends){e=_("Friend");h=_("Unfriend");f="pif-user-friend add_friend";j="pif-cancel remove"}else{if(g.friend_status==0){e=_("Request sent");h=_("Cancel friendship request");f="pif-user-asking pending";j="pif-cancel remove"}else{e=_("Add as friend");h=l.ops.icon_only?e:"";f=j="pif-user-add add_friend"}}f+=l.bcls;j+=l.bcls;a(l.friend_holder).html(l.ops.icon_only?"":e).attr("class",f).off("mouseenter mouseleave").on("mouseenter",function(){a(this).attr("class",j);if(h){HoverPopView(this,false,{content:h,ex_class:"popTooltip",direction:"top"})}}).on("mouseleave",function(){a(this).attr("class",f)})}},_updateFollowStatus:function(){var l=this;var g=l.user;var m=a(l.follow_holder);if(!g.are_friends&&!g.can_follow){m.css("display","none")}else{var e,h,f,j;if(g.is_following){e=_("Following");h=_("Unfollow");f="pif-follow add_follow";j="pif-cancel remove"}else{e=_("Follow");h=l.ops.icon_only?e:"";f=j="pif-follow_add add_follow"}f+=l.bcls;j+=l.bcls;m.css("display","").html(l.ops.icon_only?"":e).attr("class",f).off("mouseenter mouseleave").on("mouseenter",function(){a(this).attr("class",j);if(h){HoverPopView(this,false,{content:h,ex_class:"popTooltip",direction:"top"})}}).on("mouseleave",function(){a(this).attr("class",f)})}},_updateFanStatus:function(){var f=this;var e=f.user;a(f.fan_holder).css("display",(e.are_friends||!e.is_fan)?"none":"")}}})(jQuery);Badges={badges:{"10_invites":["cmp_10_invites",format(_("Invited more than %d users"),10)],"25_invites":["cmp_25_invites",format(_("Invited more than %d users"),25)],"50_invites":["cmp_50_invites",format(_("Invited more than %d users"),50)],"100_invites":["cmp_100_invites",format(_("Invited more than %s users"),100)],"1000_invites":["cmp_1000_invites",format(_("Invited more than %s users"),1000)],"5":["cmp_5",_("Promoter of Plurk")],"6":["cmp_6",_("Has had over 100 responses to own plurk")],"7":["cmp_7",_("Translator of Plurk")],"8":["cmp_8",format(_("Has invited over %d users via Plurk widget"),50)],"9":["cmp_9",_("Reached Plurk nirvana")],"50_fans":["cmp_50_fans",format(_("Has more than %s fans"),50)],"500_fans":["cmp_500_fans",format(_("Has more than %s fans"),500)],"5000_fans":["cmp_5000_fans",format(_("Has more than %s fans"),5000)],"50000_fans":["cmp_50000_fans",format(_("Has more than %s fans"),50000)],"13":["cmp_13",_("Is a good Plurk hacker!")],"14":["cmp_14",_("In the karma 100 club")],"15":["cmp_15",_("Developer of Plurk tools using Plurk API.")],upload_profile_image:["cmp_upload_profile_image",_("Has uploaded a profile picture")],"100000_views":["cmp_100000_views",format(_("Has over %s profile views"),100000)],"10000_views":["cmp_10000_views",format(_("Has over %s profile views"),10000)],"1000_views":["cmp_1000_views",format(_("Has over %s profile views"),1000)],"100_views":["cmp_100_views",format(_("Has over %s profile views"),100)],"25000_plurks":["cmp_25000_plurks",format(_("Plurked over %s times"),25000)],"10000_plurks":["cmp_10000_plurks",format(_("Plurked over %s times"),10000)],"1000_plurks":["cmp_1000_plurks",format(_("Plurked over %s times"),1000)],"100_plurks":["cmp_100_plurks",format(_("Plurked over %s times"),100)],"10_plurks":["cmp_10_plurks",format(_("Plurked over %s times"),10)],"100000_comments":["cmp_100000_comments",format(_("Responded over %s times"),100000)],"50000_comments":["cmp_50000_comments",format(_("Responded over %s times"),50000)],"5000_comments":["cmp_5000_comments",format(_("Responded over %s times"),5000)],"500_comments":["cmp_500_comments",format(_("Responded over %s times"),500)],"50_comments":["cmp_50_comments",format(_("Responded over %s times"),50)],coin:["cmp_coin",_("Has Plurk Coin(s)")],store:["cmp_store_linked","在噗打合作社開店"]},render:function(c,e){var b=AJS.DIV({c:"award_bar clearfix"});if(!c.badges){return b}var d=c.badges;AJS.map(d,function(h){var j=Badges.createBadge(h,e);if(j){AJS.ACN(b,j)}});var g=c.days_joined;if(g){var f;var a=[3000,2000,1500,1000,500,100,10];AJS.map(a,function(j){if(g>=j){var h=format(_("Has been user for over %s days (~%s days)"),j,g);Badges.badges[j+"_days"]=["cmp_"+j+"_days",h];AJS.ACN(b,Badges.createBadge(j+"_days",e));return true}})}return b},createBadge:function(d,g,c){var f=39,a=39;if(g){f=16,a=16}var h=Badges.badges[d];if(!h){return null}var b=h[0];if(g){b+="_mini"}var e=AJS.IMG({src:"//s.plurk.com/22edb6617e829a61262a0835d85572f7.gif",width:f,height:a,c:b});if(c!=true){if(d=="7"){e=AJS.DIV(AJS.A({href:"http://pctp.plurk.com/",target:"_blank"},e))}else{if(d=="15"){e=AJS.DIV(AJS.A({href:"https://www.plurk.com/API/",target:"_blank"},e))}else{if(d=="5"){e=AJS.DIV(AJS.A({href:"http://blog.plurk.com/2010/06/04/blog-needs-love/",target:"_blank"},e))}else{e=AJS.DIV(e)}}}jQuery(e).mouseover(function(){var j=Badges.createBadge(d,false,true);var l=(g?'<div class="'+h[0]+'" style="margin:0 auto 8px;"></div>':"")+h[1];HoverPopView(e,false,{content:l,ex_class:"popTooltip",direction:"bottom",offset:2})})}return e}};Qualifiers={qual_to_en:{},init:function(){var c=this;var b=AJS.keys(LANG_QUAL);AJS.map(b,function(e){var f=c.qual_to_en[e]={};var d=LANG_QUAL[e];AJS.map(AJS.keys(d),function(g){f[d[g]]=g})});var a={};AJS.map(b,function(d){a[d]=AJS.keys(c.qual_to_en[d])});this.matchers=a},getFirstWQual:function(b,e){if(!Qualifiers.matchers){Qualifiers.init()}e=e||"en";var d=b.split(/[.,\s]/);if(d.length>0){var c=AJS.getFirst(d).toLowerCase();var a=Qualifiers.matchers[e];if(a&&c&&AJS.isIn(c,a)){return c}}return null},transformContentQualifer:function(d,f,h){var c=AJS.isIn(d,[":","freestyle"]);try{var b=this.getFirstWQual(f,h)}catch(g){var b=null}var a=b&&b.length||0;if(b&&h!="en"){a=b.length;try{b=Qualifiers.qual_to_en[h][b]}catch(g){b=null}}if(c&&b&&b!="whispers"){new_content=f.substring(a);if(!new_content.match(/^\s*$/)){f=new_content;d=b}}if(d=="freestyle"){d=":"}return[d,f.replace(/^\s*/,"").replace(/\s*$/,"")]},format:function(s,c,g,a,t,m,p,o,h){var q={href:"/"+s.nick_name,"data-uid":s.id,"class":"name"};if(h){q.style="color: #0a9c17;"}else{if(s.name_color){q.style="color: #"+s.name_color+";"}}var r=o||s.display_name||s.nick_name;var e=AJS.A(q,r);if(a){e=r}var n=AJS.setHTML(AJS.SPAN(),"&nbsp;");is_freestyle=AJS.isIn(c,[":","freestyle"]);if(!is_freestyle){var d=this._(s.gender,t,c);n=AJS.SPAN({c:"qualifier q_"+c},d)}var b=AJS.SPAN;if(AJS.isIe()){b=AJS.DIV}var l;if(t=="ja"){AJS.addClass(e,"jap_qual");l=b(e)}else{if(window.IS_RTL&&!AJS.isIn(t,["ar","he"])){l=b(n,e)}else{l=b(e,n)}}var j=2+r.length;j+=n.innerHTML.length;var f=(p?AJS.SPAN:AJS.DIV)({c:"text_holder"});AJS.setHTML(f,g);if(t=="ja"){AJS.ACN(f,n)}if(p){AJS.addClass(n,"qual_embedded")}return[l,f,j]},getQual:function(b){var a;return((a=b?b.className.match(/q_.+/):0)?a[0]:"q_freestyle").replace("q_","")},_:function(c,d,b){var a;d=d||"en";if(window.LANG_QUAL&&LANG_QUAL[d]){a=LANG_QUAL[d][b]}if(AJS.isArray(a)){if(c==1){a=a[0]}else{a=a[1]}}if(a){return a}return null}};AJS.AEV(window,"load",AJS.$b(Qualifiers.init,Qualifiers));(function(a){QualifierSelector=function(d,e,j,c,h){var f=this;f.cur_lang=d;f.cookie=e;f.on_change=h;f.input_type=c;f.ex_menu_class=j;var b=c=="big"?[14,11]:[8,7];var g=a('<div class="dd_img m_qualifier"><span></span><i class="pif-dropdown"></i></div>');g.click(function(){if(Qualifiers.getQual(this)=="whispers"){f.resetQualifier()}else{f.toggleMenu()}});f.button=g[0];f.resetQualifier()};QualifierSelector.prototype.resetQualifier=function(){if(this.cookie){this.setQualifier(SiteState.getSessionUser()[this.cookie])}else{this.setQualifier("says")}};QualifierSelector.prototype.getQualifier=function(){return Qualifiers.getQual(this.button)};QualifierSelector.prototype.setQualifier=function(c){var f=a(this.button);var e=this.cookie;if(e&&c!="whispers"){if(e!="default_qual_mini"||e=="default_qual_mini"&&AJS.isIn(c,["freestyle","says"])){PlurkAdder.saveUserValue(this.cookie,c)}}var b="dd_img m_qualifier";if(c=="freestyle"){c=":";cur_qual="q_freestyle"}else{cur_qual="q_"+c}f.attr("class",b+" "+cur_qual);var d=f.children("span");user=SiteState.getSessionUser();d.html(Qualifiers._(user.gender,this.cur_lang,c)||"").css("display",c==":"?"none":"");f.children("i").attr("class",c=="whispers"?"pif-cancel":"pif-dropdown");this.on_change(c)};QualifierSelector.prototype.toggleMenu=function(){var h=this;if(!h.menu){var c=["freestyle","loves","likes","shares","gives","hates","wants","wishes","needs","will","hopes","asks","has","was","wonders","feels","thinks","says","is"];var d=SiteState.getSessionUser();if(this.input_type=="big"&&d.post_anonymous_plurk&&AJS.$bytc("body","timeline").length){c.push("whispers")}var e=a("<ul></url>");var j=SiteState.getSessionUser().gender;for(var l in c){var f=c[l];var g=Qualifiers._(j,h.cur_lang,f);if(f=="freestyle"){g=': <span class="extra_txt">('+(g?g:_("freestyle"))+")</span>"}e.append('<li class="q_'+f+'">'+g+"</li>")}var b=a('<div class="qual_menu '+h.ex_menu_class+'"></div>').append(e);h.menu=new PopView({content:b[0],direction:"right",keep:false,onHide:function(){h.menu=null}});h.menu.showFrom(h.button);e.find("li").click(function(n){var m=Qualifiers.getQual(this);h.setQualifier(m);n.stopPropagation();h.menu.hide()})}}})(jQuery);__q_loves=_("loves");__q_likes=_("likes");__q_replurks=_("replurks");__q_shares=_("shares");__q_gives=_("gives");__q_hates=_("hates");__q_wants=_("wants");__q_wishes=_("wishes");__q_needs=_("needs");__q_will=_("will");__q_hopes=_("hopes");__q_asks=_("asks");__q_has=_("has");__q_was=_("was");__q_wonders=_("wonders");__q_feels=_("feels");__q_thinks=_("thinks");__q_says=_("says");__q_is=_("is");__q_whispers=_("whispers");Formatter={re_short_url:/\[url:([0-9a-z]{6}):(.*?)\]/g,realOwnLinks:function(b){var a=function(e,d,c){return"http://"+c};return b.replace(Formatter.re_short_url,a)}};LANG_QUAL={el:{wants:"\u03b8\u03ad\u03bb\u03b5\u03b9",needs:"\u03c7\u03c1\u03b5\u03b9\u03ac\u03b6\u03b5\u03c4\u03b1\u03b9",says:"\u03bb\u03ad\u03b5\u03b9",asks:"\u03c1\u03c9\u03c4\u03ac\u03b5\u03b9",wonders:"\u03b1\u03bd\u03b1\u03c1\u03c9\u03c4\u03b9\u03ad\u03c4\u03b1\u03b9",freestyle:"\u03b5\u03bb\u03b5\u03cd\u03b8\u03b5\u03c1\u03bf \u03c3\u03c4\u03c5\u03bb",was:"\u03ae\u03c4\u03b1\u03bd",is:"\u03b5\u03af\u03bd\u03b1\u03b9",shares:"\u03bc\u03bf\u03b9\u03c1\u03ac\u03b6\u03b5\u03c4\u03b1\u03b9",will:"\u03b8\u03b1",whispers:"whispers",feels:"\u03b1\u03b9\u03c3\u03b8\u03ac\u03bd\u03b5\u03c4\u03b1\u03b9",wishes:"\u03b5\u03cd\u03c7\u03b5\u03c4\u03b1\u03b9",likes:"\u03b3\u03bf\u03c5\u03c3\u03c4\u03ac\u03c1\u03b5\u03b9",loves:"\u03b1\u03b3\u03b1\u03c0\u03ac\u03b5\u03b9",hopes:"\u03b5\u03bb\u03c0\u03af\u03b6\u03b5\u03b9",has:"\u03ad\u03c7\u03b5\u03b9",replurks:"replurks",thinks:"\u03bd\u03bf\u03bc\u03af\u03b6\u03b5\u03b9",hates:"\u03bc\u03b9\u03c3\u03b5\u03af",gives:"\u03b4\u03af\u03bd\u03b5\u03b9"},en:{wants:"wants",needs:"needs",says:"says",asks:"asks",wonders:"wonders",was:"was",is:"is",shares:"shares",will:"will",whispers:"whispers",feels:"feels",wishes:"wishes",likes:"likes",loves:"loves",hopes:"hopes",has:"has",replurks:"replurks",thinks:"thinks",hates:"hates",gives:"gives"},cn:{wants:"\u8981",needs:"\u9700\u8981",says:"\u8bf4",asks:"\u95ee",wonders:"\u597d\u5947",freestyle:"\u81ea\u7531\u767c\u63ee",was:"\u66fe\u7ecf",is:"\u662f",shares:"\u63a8\u8350",will:"\u5c07\u4f1a",whispers:"\u5077\u5077\u8bf4",feels:"\u89c9\u5f97",wishes:"\u671f\u5f85",likes:"\u559c\u6b22",loves:"\u7231",hopes:"\u671f\u5f85",has:"\u6709",replurks:"\u8f6c\u5657",thinks:"\u60f3",hates:"\u8ba8\u538c",gives:"\u7ed9"},ca:{wants:"vol",needs:"necessita",says:"diu",asks:"pregunta",wonders:"desitja",freestyle:"freestyle",was:"era/estava",is:"\u00e9s/est\u00e0",shares:"comparteix",will:"ser\u00e0",whispers:"whispers",feels:"sent",wishes:"desitja",likes:"li agrada",loves:"estima",hopes:"espera",has:"t\u00e9",replurks:"replurks",thinks:"pensa",hates:"odia",gives:"d\u00f3na"},it:{wants:"vuole",needs:"ha bisogno",says:"dice",asks:"chiede",wonders:"si chiede",freestyle:"freestyle",was:"era",is:"sta",shares:"condivide",will:"va",whispers:"sussurra",feels:"si sente",wishes:"augura",likes:"gradisce",loves:"ama",hopes:"spera",has:"ha",replurks:"replurka",thinks:"pensa",hates:"odia",gives:"offre"},ar:{wants:"\u064a\u0631\u064a\u062f",needs:"\u064a\u062d\u062a\u0627\u062c/\u062a\u062d\u062a\u0627\u062c",says:"\u064a\u0642\u0648\u0644",asks:"\u064a\u0633\u0627\u0644",wonders:" \u064a\u062a\u0639\u062c\u0651\u0628/\u062a\u062a\u0639\u062c\u0651\u0628",freestyle:"freestyle",was:"\u0643\u0627\u0646",is:"\u064a",shares:"\u064a\u0642\u0627\u0633\u0645",will:"\u0633\u0648\u0641",whispers:"whispers",feels:"\u064a\u062d\u0633",wishes:"\u064a\u0627\u0645\u0644",likes:"\u064a\u062d\u0628",loves:"\u064a\u062d\u0628",hopes:"\u064a\u0623\u0645\u0644/\u062a\u0623\u0645\u0644",has:"\u0644\u0647",replurks:"replurks",thinks:"\u064a\u0641\u0643\u0631",hates:"\u0643\u0631\u0647",gives:"\u064a\u0639\u0637\u064a"},ga:{wants:"teasta\u00edonn",needs:"teasta\u00edonn",says:"deireann",asks:"fiafra\u00edonn",wonders:"d\u00e9anann iontas",freestyle:"mar is mian leat",was:"bh\u00ed",is:"t\u00e1",shares:"comhroinneann",will:"rachfaidh",whispers:"whispers",feels:"braitheann",wishes:"oireann do",likes:"is maith le",loves:"is aoibhinn",hopes:"t\u00e1 s\u00fail ag",has:"rinne",replurks:"replurks",thinks:"s\u00edleann",hates:"is fuath",gives:"tugann"},"in":{wants:"ingin",needs:"butuh",says:"bilang",asks:"tanya",wonders:"bertanya-tanya",freestyle:"freestyle",was:"tadi",is:"sedang",shares:"berbagi",will:"akan",whispers:"bisik",feels:"rasa",wishes:"berharap",likes:"suka",loves:"cintai",hopes:"mendambakan",has:"telah",replurks:"me-replurk",thinks:"pikir",hates:"benci",gives:"memberi"},cs:{wants:"chce",needs:"pot\u0159ebuje",says:"\u0159\u00edk\u00e1",asks:"se pt\u00e1",wonders:"se div\u00ed",freestyle:"freestyle",was:"byl/a",is:"je",shares:"sd\u00edl\u00ed",will:"bude",whispers:"whispers",feels:"se c\u00edt\u00ed",wishes:"p\u0159eje",likes:"se l\u00edb\u00ed",loves:"miluje",hopes:"douf\u00e1",has:"m\u00e1",replurks:"replurks",thinks:"si mysl\u00ed",hates:"nesn\u00e1\u0161\u00ed",gives:"d\u00e1v\u00e1"},es:{wants:"quiere",needs:"necesita",says:"dice",asks:"pregunta",wonders:"se pregunta",freestyle:"freestyle",was:"estaba",is:"est\u00e1",shares:"comparte",will:"har\u00e1",whispers:"susurra",feels:"siente",wishes:"desea",likes:"prefiere",loves:"ama",hopes:"espera",has:"tiene",replurks:"replurkea",thinks:"piensa",hates:"odia",gives:"ofrece"},ru:{wants:"\u0445\u043e\u0447\u0435\u0442",needs:"\u043d\u0443\u0436\u0434\u0430\u0435\u0442\u0441\u044f",says:"\u0433\u043e\u0432\u043e\u0440\u0438\u0442",asks:"\u0441\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u0442",wonders:"\u0440\u0430\u0437\u043c\u044b\u0448\u043b\u044f\u0435\u0442",was:["\u0431\u044b\u043b","\u0431\u044b\u043b\u0430"],is:null,shares:["\u043d\u0430\u0448\u0435\u043b","\u043d\u0430\u0448\u043b\u0430"],will:"\u0431\u0443\u0434\u0435\u0442",whispers:"\u0448\u0435\u043f\u0447\u0435\u0442",feels:"\u0447\u0443\u0432\u0441\u0442\u0432\u0443\u0435\u0442",wishes:null,likes:"\u0438\u043d\u0442\u0435\u0440\u0435\u0441\u0443\u0435\u0442\u0441\u044f",loves:"\u043b\u044e\u0431\u0438\u0442",hopes:"\u043d\u0430\u0434\u0435\u0435\u0442\u0441\u044f",has:null,replurks:"\u0440\u0435\u043f\u043b\u044e\u0440\u043a\u043d\u0443\u043b",thinks:"\u0434\u0443\u043c\u0430\u0435\u0442",hates:"\u043d\u0435\u043d\u0430\u0432\u0438\u0434\u0438\u0442",gives:"\u0434\u0430\u0440\u0438\u0442"},nb:{wants:"vil ha",needs:"trenger",says:"sier",asks:"sp\u00f8r",wonders:"lurer p\u00e5",freestyle:"fristil",was:"var",is:"er",shares:"deler",will:"vil",whispers:"whispers",feels:"f\u00f8ler\n",wishes:"\u00f8nsker",likes:"liker",loves:"elsker",hopes:"h\u00e5per",has:"har",replurks:"replurks",thinks:"synes",hates:"hater",gives:"gir"},tr_hk:{wants:"\u60f3\u8981",needs:"\u9700\u8981",says:"\u8b1b",asks:"\u554f",wonders:"\u597d\u5947",freestyle:"\u81ea\u7531\u767c\u63ee",was:"\u66fe\u7d93",is:"\u55ba\u5ea6",shares:"\u5206\u4eab",will:"\u5c07\u6703",whispers:"\u5077\u5077\u8aaa",feels:"\u89ba\u5f97",wishes:"\u671f\u5f85",likes:"\u937e\u610f",loves:"\u611b",hopes:"\u5e0c\u671b",has:"\u5df2\u7d93",replurks:"\u8f49\u5657",thinks:"\u5fc3\u8ad7",hates:"\u6700\u618e",gives:"\u7540"},tr:{wants:"istiyor ki",needs:"ihtiyac\u0131 var",says:"diyor ki",asks:"soruyor ki",wonders:"merak ediyor",freestyle:"serbest",was:"was",is:"is",shares:"payla\u015f\u0131yor",will:"yapmay\u0131 d\u00fc\u015f\u00fcn\u00fcyor",whispers:"whispers",feels:"hissediyor ki",wishes:"umuyor ki",likes:"ho\u015flan\u0131yor",loves:"seviyor",hopes:"umut ediyor",has:"has",replurks:"replurks",thinks:"d\u00fc\u015f\u00fcn\u00fcyor ki",hates:"nefret ediyor\n",gives:"veriyor"},ne:{wants:"wil",needs:"heeft nood aan",says:"zegt",asks:"vraagt",wonders:"vraagt zich af",freestyle:"freestyle",was:"was",is:"is",shares:"verstuurt",will:"zal",whispers:"whispers",feels:"voelt",wishes:"hoopt",likes:"houdt van",loves:"is wild van",hopes:"hoopt",has:"heeft",replurks:"replurks",thinks:"denkt",hates:"haat",gives:"geeft"},ta_fp:{wants:"gusto",needs:"ay nangangailangan",says:"sinasabi",asks:"nagtatanong",wonders:"ay nagtataka",freestyle:"freestyle",was:null,is:"ay",shares:"ipinamamahagi",will:null,whispers:"whispers",feels:"nararamdaman",wishes:"naghahangad",likes:null,loves:"mahal",hopes:"ay umaasang",has:null,replurks:"replurks",thinks:"iniisip",hates:"kinasusuklam",gives:"nagbibigay"},th:{wants:"\u0e15\u0e49\u0e2d\u0e07\u0e01\u0e32\u0e23",needs:"\u0e15\u0e49\u0e2d\u0e07\u0e01\u0e32\u0e23",says:"\u0e1e\u0e39\u0e14",asks:"\u0e16\u0e32\u0e21",wonders:"\u0e2a\u0e07\u0e2a\u0e31\u0e22",freestyle:"\u0e44\u0e21\u0e48\u0e23\u0e30\u0e1a\u0e38",was:"\u0e40\u0e04\u0e22",is:"\u0e40\u0e1b\u0e47\u0e19",shares:"\u0e41\u0e1a\u0e48\u0e07\u0e1b\u0e31\u0e19",will:"\u0e08\u0e30",whispers:"whispers",feels:"\u0e23\u0e39\u0e49\u0e2a\u0e36\u0e01",wishes:"\u0e1b\u0e23\u0e32\u0e23\u0e16\u0e19\u0e32",likes:"\u0e0a\u0e2d\u0e1a",loves:"\u0e23\u0e31\u0e01",hopes:"\u0e04\u0e32\u0e14\u0e2b\u0e27\u0e31\u0e07",has:"\u0e21\u0e35",replurks:"replurks",thinks:"\u0e04\u0e34\u0e14",hates:"\u0e40\u0e01\u0e25\u0e35\u0e22\u0e14",gives:"\u0e43\u0e2b\u0e49"},ro:{wants:"vrea",needs:"vrea",says:"spune",asks:"\u00eentreab\u0103",wonders:"se \u00eentreab\u0103",freestyle:"stil liber",was:"a fost",is:"este",shares:"Actiuni",will:"va",whispers:"whispers",feels:"se simte",wishes:"viseaz\u0103",likes:"Ii place",loves:"iube\u0219te",hopes:"sper\u0103",has:"a ",replurks:"replurks",thinks:"crede",hates:"ur\u0103\u0219te",gives:"ofer\u0103"},pl:{wants:"chce",needs:"potrzebuje",says:"m\u00f3wi",asks:"pyta",wonders:"zastanawia si\u0119",freestyle:"freestyle",was:["by\u0142","by\u0142a"],is:"jest",shares:"dzieli si\u0119",will:"b\u0119dzie",whispers:"szepcze z ukrycia",feels:"czuje",wishes:"\u017cyczy",likes:"lubi",loves:"uwielbia",hopes:"ma nadziej\u0119",has:"ma",replurks:"replurkuje",thinks:"my\u015bli",hates:"nienawidzi",gives:"daje"},fr:{wants:"veut",needs:"a besoin",says:"dit",asks:"demande",wonders:"se demande",freestyle:"personnaliser",was:"\u00e9tait",is:"est",shares:"partage",will:"va",whispers:"chuchote",feels:"se sent",wishes:"souhaite",likes:"appr\u00e9cie",loves:"aime",hopes:"esp\u00e8re",has:"a",replurks:"replurke",thinks:"pense",hates:"d\u00e9teste",gives:"donne"},dk:{wants:"\u00f8nsker",needs:"beh\u00f8ver",says:"siger",asks:"sp\u00f8rger",wonders:"spekulerer p\u00e5",freestyle:"fri tekst",was:"var",is:"er",shares:"deler",will:"vil",whispers:"whispers",feels:"f\u00f8ler",wishes:"\u00f8nsker",likes:"kan lide",loves:"elsker",hopes:"h\u00e5ber",has:"har",replurks:"replurks",thinks:"synes",hates:"hader",gives:"giver"},pt_BR:{wants:"quer",needs:"precisa",says:"diz",asks:"pergunta",wonders:"admira",freestyle:"freestyle",was:"estava",is:"est\u00e1",shares:"compartilha",will:"vai",whispers:"whispers",feels:"sente",wishes:"deseja",likes:"gosta",loves:"ama",hopes:"espera",has:"tem",replurks:"replurks",thinks:"pensa",hates:"odeia",gives:"d\u00e1"},hr:{wants:"ho\u0107e",needs:"treba",says:"ka\u017ee",asks:"pita",wonders:"se pita",freestyle:"slobodni stil",was:null,is:"je",shares:"dijeli",will:"\u0107e",whispers:"whispers",feels:"osje\u0107a",wishes:"\u017eeli",likes:"\u017eeli",loves:"voli",hopes:"se nada ",has:["je bio","je bila"],replurks:"replurks",thinks:"misli",hates:"mrzi",gives:"daje"},de:{wants:"will",needs:"braucht",says:"sagt",asks:"fragt",wonders:"fragt sich",was:"war",is:"ist",shares:"teilt",will:"wird",whispers:"fl\u00fcstert",feels:"f\u00fchlt",wishes:"w\u00fcnscht",likes:"mag",loves:"liebt",hopes:"hofft",has:"hat",replurks:"teilt",thinks:"denkt",hates:"hasst",gives:"gibt"},hu:{wants:"szeretne",needs:"k\u00e9r",says:"szerint",asks:"azt k\u00e9rdi",wonders:"azon tanakodik",freestyle:"freestyle",was:"m\u00e1r",is:"most",shares:"mutatja",will:"majd",whispers:"megs\u00fagja",feels:"\u00fagy \u00e9rzi",wishes:"azt k\u00edv\u00e1nja",likes:"szereti",loves:"im\u00e1dja",hopes:"rem\u00e9li",has:"mostanra",replurks:"visszplurk\u00f6k",thinks:"arra gondol",hates:"ut\u00e1lja",gives:"ad"},fa:{wants:"\u0645\u06cc\u062e\u0648\u0627\u0647\u062f",needs:"\u0646\u06cc\u0627\u0632 \u062f\u0627\u0631\u062f \u0628\u0647 ",says:"\u06af\u0641\u062a\u0647 \u0647\u0627",asks:"\u0645\u06cc\u067e\u0631\u0633\u062f",wonders:"\u0634\u06af\u0641\u062a \u0632\u062f\u0647 \u0627\u0633\u062a ",freestyle:"\u0642\u0627\u0644\u0628 \u0631\u0627\u06cc\u06af\u0627\u0646",was:"\u0628\u0648\u062f",is:"\u0647\u0633\u062a",shares:"\u0628\u0647 \u0627\u0634\u062a\u0631\u0627\u06a9 \u0645\u06cc\u06af\u0630\u0627\u0631\u062f",will:"\u062e\u0648\u0627\u0647\u062f",whispers:"whispers",feels:"\u0627\u062d\u0633\u0627\u0633 \u0645\u06cc\u06a9\u0646\u062f",wishes:"\u0622\u0631\u0632\u0648 \u0645\u06cc\u06a9\u0646\u062f \u06a9\u0647",likes:"\u062f\u0648\u0633\u062a\u062f\u0627\u0631",loves:"\u0639\u0627\u0634\u0642",hopes:"\u0627\u0645\u06cc\u062f\u0648\u0627\u0631 \u0627\u0633\u062a",has:"\u0628\u0627\u06cc\u062f",replurks:"replurks",thinks:"\u0641\u06a9\u0631 \u0645\u06cc\u06a9\u0646\u062f",hates:"\u0646\u0641\u0631\u062a \u062f\u0627\u0631\u062f \u0627\u0632 ",gives:"\u0645\u06cc\u062f\u0647\u062f"},hi:{wants:"\u091a\u093e\u0939\u0924\u093e \u0939\u0948 ",needs:"\u091a\u093e\u0939\u0924\u093e \u0939\u0948 ",says:"\u0915\u0939\u0924\u0947 \u0939\u0948\u0902 ",asks:"\u092a\u0942\u091b\u093e \u0939\u0948 ",wonders:"\u0906\u0936\u094d\u091a\u0930\u094d\u092f \u0915\u0930\u0924\u093e \u0939\u0948 ",freestyle:"\u092e\u0941\u0915\u094d\u0924 \u0936\u0948\u0932\u0940 ",was:"\u0925\u093e ",is:"\u0939\u0948 ",shares:"\u0938\u093e\u091d\u093e \u0915\u093f\u092f\u093e ",will:"\u0907\u091a\u094d\u091b\u093e  ",whispers:"whispers",feels:"\u092e\u0939\u0938\u0942\u0938 \u0915\u093f\u092f\u093e ",wishes:"\u0936\u0941\u092d\u0947\u0915\u094d\u0937\u093e \u0939\u0948 ",likes:"\u092a\u0938\u0902\u0926 \u0939\u0948 ",loves:"\u092a\u094d\u092f\u093e\u0930 \u0939\u0948 ",hopes:"\u0906\u0936\u093e \u0939\u0948 \u0915\u093f ",has:"\u0930\u0916\u0924\u093e \u0939\u0948 ",replurks:"replurks",thinks:"\u0938\u094b\u091a\u0924\u093e \u0939\u0948 ",hates:"\u0928\u092b\u0930\u0924 \u0939\u0948 ",gives:"\u0926\u093f\u092f\u093e \u0939\u0948 "},fi:{wants:"haluaa",needs:"tarvitsee",says:"sanoo",asks:"kysyy",wonders:"ihmettelee",freestyle:"freestyle",was:"oli",is:"on",shares:"jakaa",will:"aikoo",whispers:"whispers",feels:"tuntuu",wishes:"tahtoo",likes:"tykk\u00e4\u00e4",loves:"rakastaa",hopes:"toivoo",has:"on",replurks:"replurks",thinks:"luulee",hates:"vihaa",gives:"antaa"},ja:{wants:"\u6b32\u3057\u3044",needs:"\u5fc5\u8981\u3068\u3059\u308b",says:"\u8a71\u3059",asks:"\u5c0b\u306d\u308b",wonders:"\u4e0d\u601d\u8b70\u306b\u601d\u3046",freestyle:"\u81ea\u7531\u306b",was:"\u3067\u3057\u305f",is:"\u3067\u3059",shares:"\u5171\u6709",will:"\u305c\u3072",whispers:"\u56c1\u304f",feels:"\u611f\u3058\u308b",wishes:"\u671b\u3080",likes:"\u597d\u304d",loves:"\u611b\u3059\u308b",hopes:"\u9858\u3046",has:"\u6301\u3064",replurks:"replurks",thinks:"\u8003\u3048\u308b",hates:"\u5acc\u3046",gives:"\u3042\u3052\u308b"},he:{wants:"\u05e8\u05d5\u05e6\u05d4",needs:"\u05e6\u05e8\u05d9\u05da\\\u05d4",says:"\u05d0\u05d5\u05de\u05e8/\u05ea",asks:"\u05e9\u05d5\u05d0\u05dc/\u05ea",wonders:"\u05ea\u05d5\u05d4\u05d4",freestyle:"\u05d7\u05d5\u05e4\u05e9\u05d9",was:"\u05e7\u05d5\u05d3\u05dd",is:"\u05db\u05e8\u05d2\u05e2",shares:"\u05de\u05e9\u05ea\u05e3",will:"   ",whispers:"whispers",feels:"\u05de\u05e8\u05d2\u05d9\u05e9",wishes:"\u05de\u05e9\u05ea\u05d5\u05e7\u05e7",likes:"\u05de\u05d7\u05d1\u05d1/\u05d0\u05d5\u05d4\u05d1",loves:"\u05d0\u05d5\u05d4\u05d1",hopes:"\u05de\u05e7\u05d5\u05d5\u05d4",has:"(\u05d1\u05e2\u05d1\u05e8)",replurks:"replurks",thinks:"\u05d7\u05d5\u05e9\u05d1",hates:"\u05e9\u05d5\u05e0\u05d0",gives:"\u05e0\u05d5\u05ea\u05df"},ms:{wants:"mahu",needs:"harus",says:"kata",asks:"tanya",wonders:"hairan",freestyle:"gaya bebas",was:"sedang",is:"sedang",shares:"berkongsi",will:"akan",whispers:"whispers",feels:"rasa",wishes:"berharap",likes:"suka",loves:"suka",hopes:"harap",has:"telah",replurks:"replurks",thinks:"fikir",hates:"benci",gives:"memberi"},ko:{wants:"\ubc14\ub798\uc694",needs:"\ud544\uc694\ud574\uc694",says:"\uc648 ",asks:"\uad81\uae08\ud574\uc694",wonders:"\uad81\uae08\ud574\uc694",freestyle:"\uc5c6\uc74c",was:"\uc804\uc5d0",is:"\uc9c0\uae08",shares:"\ub098\ub204\uc5b4\uc694",will:"\uc7a5\ucc28",whispers:"whispers",feels:"\ub290\uaef4\uc694",wishes:"\uae30\uc6d0\ud574\uc694",likes:"\uc88b\uc544\ud574\uc694",loves:"\uc0ac\ub791\ud574\uc694",hopes:"\ud76c\ub9dd\ud574\uc694",has:"\uc774\ubbf8",replurks:"replurks",thinks:"\uc0dd\uac01\ud574\uc694",hates:"\uc2eb\uc5b4\ud574\uc694",gives:"\ub4dc\ub824\uc694"},sv:{wants:"vill",needs:"beh\u00f6ver",says:"s\u00e4ger",asks:"fr\u00e5gar",wonders:"undrar",freestyle:"valfritt",was:"var",is:"\u00e4r",shares:"delar",will:"kommer",whispers:"whispers",feels:"k\u00e4nner",wishes:"\u00f6nskar",likes:"gillar",loves:"\u00e4lskar",hopes:"hoppas",has:"har",replurks:"replurks",thinks:"tycker",hates:"hatar",gives:"ger"},sk:{wants:"chce",needs:"potrebuje",says:"hovor\u00ed",asks:"sa p\u00fdta",wonders:"sa \u010duduje",freestyle:"vo\u013en\u00fd \u0161t\u00fdl",was:"bol",is:"je",shares:"zdiela",will:"bude",whispers:"whispers",feels:"sa c\u00edti",wishes:"si \u017eel\u00e1",likes:"m\u00e1 r\u00e1d",loves:"miluje",hopes:"d\u00fafa",has:"m\u00e1",replurks:"replurks",thinks:"si mysl\u00ed",hates:"nezn\u00e1\u0161a",gives:"d\u00e1va"},uk:{wants:"\u0445\u043e\u0447\u0435",needs:"\u043f\u043e\u0442\u0440\u0435\u0431\u0443\u0454",says:"\u0433\u043e\u0432\u043e\u0440\u0438\u0442\u044c",asks:"\u0437\u0430\u043f\u0438\u0442\u0443\u0454",wonders:"\u0446\u0456\u043a\u0430\u0432\u0438\u0442\u044c\u0441\u044f",freestyle:"\u0432\u0456\u043b\u044c\u043d\u0438\u0439 \u0441\u0442\u0438\u043b\u044c",was:"\u0431\u0443\u0432",is:"\u0437\u0430\u0440\u0430\u0437",shares:"\u0434\u0456\u043b\u0438\u0442\u044c\u0441\u044f",will:"\u0431\u0443\u0434\u0435",whispers:"whispers",feels:"\u0432\u0456\u0434\u0447\u0443\u0432\u0430\u0454",wishes:"\u0431\u0430\u0436\u0430\u0454",likes:"\u043f\u043e\u0434\u043e\u0431\u0430\u0454\u0442\u044c\u0441\u044f",loves:"\u043b\u044e\u0431\u0438\u0442\u044c",hopes:"\u0441\u043f\u043e\u0434\u0456\u0432\u0430\u0454\u0442\u044c\u0441\u044f",has:"\u043c\u0430\u0454 ",replurks:"\u0440\u0435\u043f\u043b\u044e\u0440\u043a\u0438",thinks:"\u0434\u0443\u043c\u0430\u0454",hates:"\u043d\u0435\u043d\u0430\u0432\u0438\u0434\u0438\u0442\u044c",gives:"\u0434\u0430\u0440\u0443\u0454"},tr_ch:{wants:"\u60f3\u8981",needs:"\u9700\u8981",says:"\u8aaa",asks:"\u554f",wonders:"\u597d\u5947",freestyle:"\u81ea\u7531\u767c\u63ee",was:"\u66fe\u7d93",is:"\u6b63\u5728",shares:"\u5206\u4eab",will:"\u6253\u7b97",whispers:"\u5077\u5077\u8aaa",feels:"\u89ba\u5f97",wishes:"\u671f\u5f85",likes:"\u559c\u6b61",loves:"\u611b",hopes:"\u5e0c\u671b",has:"\u5df2\u7d93",replurks:"\u8f49\u5657",thinks:"\u60f3",hates:"\u8a0e\u53ad",gives:"\u7d66"}};var InputUtil={placeCursor:function(c,b){if(AJS.isIe()){var a=c.createTextRange();a.collapse(true);a.move("character",b);a.select()}else{if(c.selectionStart||c.selectionStart=="0"){c.selectionStart=b;c.selectionEnd=b}}c.focus()},insertAtCursor:function(l,e,a,c){cursor_at=e.indexOf("~");if(cursor_at==-1){cursor_at=e.length}e=e.replace("~","");if(document.selection){l.focus();sel=document.selection.createRange();var f=sel.text;sel.text=e;var j=e.length-cursor_at;sel.moveStart("character",-j);sel.moveEnd("character",-j);sel.select();if(c){InputUtil.insertAtCursor(l,f)}}else{if(l.selectionStart||l.selectionStart=="0"){var g=l.scrollTop;var h=l.selectionStart;var b=l.selectionEnd;var f=l.value.substring(h,b);if(a){h=b}cursor_at+=h;l.value=l.value.substring(0,h)+e+l.value.substring(b,l.value.length);l.selectionStart=cursor_at;l.selectionEnd=cursor_at;l.scrollTop=g;if(c){InputUtil.insertAtCursor(l,f)}}else{l.value+=e}}l.focus()},selectionRange:function(b,g,a){if(b.setSelectionRange){b.focus();b.setSelectionRange(g,a)}else{if(b.createTextRange){var c=b.createTextRange();c.collapse(true);c.moveEnd("character",a);c.moveStart("character",g);c.select()}else{if(b.selectionStart){b.selectionStart=g;b.selectionEnd=a}}}var f=b.cols;var e=(g-(g%f))/f-1;var d=b.clientHeight/b.rows;b.scrollTop=d*e}};var ImageUtil={dataURItoBlob:function(d){var f=d.split(",");var c=f[0].indexOf("base64")>=0?atob(f[1]):unescape(f[1]);var g=f[0].split(":")[1].split(";")[0];var b=new Uint8Array(c.length);for(var e=0;e<c.length;e++){b[e]=c.charCodeAt(e)}return new Blob([b],{type:g})},base64ToArrayBuffer:function(d){var f=d.split(",");var c=f[0].indexOf("base64")>=0?atob(f[1]):unescape(f[1]);var b=new ArrayBuffer(c.length);var a=new Uint8Array(b);for(var e=0;e<c.length;e++){a[e]=c.charCodeAt(e)}return b},getImageExifOrientation:function(f){var c=ImageUtil.base64ToArrayBuffer(f.src);var b=new DataView(c);if(b.getUint8(0)!=255||b.getUint8(1)!=216){return 0}var a=0;for(var d=2;b.getUint8(d)==255;d+=2+b.getUint16(d+2)){if(b.getUint8(d+1)!=225){continue}d+=4;if(b.getUint32(d)!=1165519206){break}var j,m=d+6;if(b.getUint16(m)==18761){j=false}else{if(b.getUint16(m)==19789){j=true}else{break}}if(b.getUint16(m+2,!j)!=42){break}var g=b.getUint32(m+4,!j);if(g<8){break}var n=m+g,h=b.getUint16(n,!j),l;for(var e=0;e<h;e++){l=n+e*12+2;if(b.getUint16(l,!j)==274){a=b.getUint16(l+8,!j);break}}break}return a}};(function(a){ShareControl=function(c,b){var f=this;f.input=c;f.dropElm=b;f.pv_items={};f.uploads=[];f.dragoutTimer=null;var e=a('<div class="share_list"><ul></ul></div>');f.add_btn=a('<li class="add_photo">+</li>').on("click",function(h){f.triggerAdd();h.stopPropagation()});f.file_input=a('<input name="image" type="file" accept="image/*" multiple/>').css({opacity:0,visibility:"hidden",display:"none"}).appendTo(e).change(function(h){a.each(h.target.files,function(){f.addFile(this)});a(this).val("");_gaq_push(["_trackEvent","upload","image","add-by-button"])});f.list=e;f.update();var d=null;a(c).on("input",function(){clearTimeout(d);d=setTimeout(function(){f.update()},500)});var g=a("<div class='drop_indicator'>").prependTo(b).html(_("Drop image to upload"));a(b).on("dragenter dragover",function(h){if(a.inArray("Files",h.originalEvent.dataTransfer.types)>-1){clearTimeout(f.dragoutTimer);g.css({display:"block",opacity:0.9});h.stopPropagation();return false}else{g.css({display:"none"});return true}}).on("drop",function(j){g.css("display","none");var h=j.originalEvent.dataTransfer;if(h.files==null||h.files.length==0){return true}a.each(h.files,function(){if(this.type.substr(0,5)=="image"){f.addFile(this)}});_gaq_push(["_trackEvent","upload","image","add-by-drop"]);j.stopPropagation();return false});a(document).on("dragover",function(h){if(a.inArray("Files",h.originalEvent.dataTransfer.types)>-1){clearTimeout(f.dragoutTimer);g.css({display:"block",opacity:0.5});return false}else{g.css({display:"none"});return true}}).on("drop",function(h){g.css("display","none");return true}).on("dragleave",function(h){clearTimeout(f.dragoutTimer);f.dragoutTimer=setTimeout(function(){g.css("display","none")},100);return false})};ShareControl.prototype.clear=function(){for(var c in this.pv_items){this.pv_items[c].remove()}this.pv_items={};for(var b=0;b<this.uploads.length;++b){a(this.uploads[b]["item"]).html('<div class="progress error"></div>').off("click")}this.uploads=[];if(this.uploading){this.uploading=0;if(this.xhr){this.xhr.abort();this.xhr=null}}this.update()};ShareControl.prototype.setHidden=function(c){var b=this;$list=a(b.list);var d=c?"none":"block";if($list.css("display")!=d){a(b.list).css("display",d);setTimeout(function(){a(b.input).trigger("input")},10)}};ShareControl.prototype.makeImgPreview=function(e){var c=a("<li></li>").attr("url",e).css("background-image","url("+e+")");link=a("<a href="+e+"></a>")[0];var d;if(e.indexOf("//images.plurk.com/")>0){d=link.protocol+"//www.plurk.com/favicon.ico";var b=new Image();b.onload=function(){if(b.width>1024||b.height>1024){$bone=a('<img src="//s.plurk.com/52103266944dabda5188c4a47b3a6b50.png" class="hi-def">').mouseenter(function(){var g=window.LANG&&window.LANG.indexOf("zh_")!=-1;var f=a(Handlebars.compile('<div class="premOnlyTip"><div class="msg">{{{msg}}}</div><a href="/coin" target="_blank" class="pif-bone button">{{detailTip}}</a></div>')({msg:g?"這是擁有噗幣上傳的較高解析圖片！":"",detailTip:g?"查看更多關於噗幣的事":"More about Plurk Coin"}));HoverPopView(this,true,{content:f,ex_class:"popTooltip",direction:"top"})}).appendTo(c)}};b.src=e}else{d=link.protocol+"//"+link.hostname+"/favicon.ico"}c.append("<img src="+d+' class="ico">');return c};ShareControl.prototype.makeMetaPreview=function(c){var d=this;var b=a('<li class="meta"><div class="content">...</div></li>').attr("url",c);a.post("/TimeLine/previewURL",{url:c}).done(function(j){if(j&&j.url&&j.html){var h;var g;var e=a("<div>"+j.html+"</div>");var f=e.children("img");if(f.length){h=f.attr("src");f.remove()}g=e.html();b[0].updateContent=function(l){b.find(".content").html(l?l:((h?'<div class="img" style="background-image:url('+h+')"></div>':"")+g))};b[0].updateContent();$edit_btn=a('<a class="pif-edit"></a>').on("click",function(o){var s=d.input;var r=a(s);var p=a(this).parent();var u=parseInt(p.attr("index"));var n;var q=d.input.value.substring(u,u+parseInt(p.attr("length")));var l=/\(([^\)]*)\)$/;var m=l.exec(q);if(m){u+=m.index+1;n=u+m[1].length}else{n=u+q.length;var t=r.val();r.val(t.substring(0,n)+" ("+_("Link Caption")+")"+t.substring(n,t.length)).trigger("input");u+=q.length+2;n=u+_("Link Caption").length}a(s).focus();InputUtil.selectionRange(s,u,n);o.stopPropagation()});b.append($edit_btn)}});return b};ShareControl.prototype.update=function(){var l=this;var e=/(\bhttps?:\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])(?: \(([^\)]*)\))?/ig;l.add_btn.detach();$ul=a(l.list).find("ul");for(var o in l.pv_items){l.pv_items[o].detach()}var g=null;e.lastIndex=0;while(g=e.exec(l.input.value)){var b=g[1];var h=g.index;var c=g[0].length;if(b.indexOf("//emos.plurk.com/")>0){continue}var n=b.match(/\.(gif|jpe?g|bmp|png)$/i);if(b in l.pv_items){var d=l.pv_items[b];d.attr("url",b).attr("index",h).attr("length",c);$ul.append(d);if(d.hasClass("meta")){var j=g[2];if(d[0].updateContent){d[0].updateContent(j&&j.length?j:null)}}}else{var m=n?l.makeImgPreview(b):l.makeMetaPreview(b);l.pv_items[b]=m;$ul.append(m);m.on("click",function(s){console.log(this);var r=parseInt(a(this).attr("index"));var q=r+parseInt(a(this).attr("length"));var p=l.input;a(p).focus();InputUtil.selectionRange(p,r,q);s.stopPropagation()})}}for(var f=0;f<l.uploads.length;++f){$ul.append(l.uploads[f]["item"])}$ul.append(l.add_btn);a(l.add_btn).html("+");l.setHidden($ul.children().length<=1)};ShareControl.prototype.triggerAdd=function(){a(this.file_input).trigger("click")};ShareControl.prototype.addFile=function(d){var e=this;var c=a('<li class="uploading">...</li>');var f={item:c};e.uploads.push(f);e.update();if(e.onChanged){e.onChanged()}c.mouseover(function(){a(this).children(".progress").addClass("pif-cancel");a(this).children(".error").removeClass("pif-cancel pif-warning").addClass("pif-refresh")}).mouseout(function(){a(this).children(".progress").removeClass("pif-cancel pif-refresh");a(this).children(".error").addClass("pif-warning")}).click(function(m){if(c.find(".error").length){c.html('<div class="progress"><div></div></div>');e.upload()}else{for(var j=0;j<e.uploads.length;++j){var l=e.uploads[j]["item"];if(c.is(l)){c.remove();if(j==0&&e.uploading&&e.xhr){e.xhr.abort();e.xhr=null;e.uploading=0}e.uploads.splice(j,1);e.update();e.upload();if(e.onChanged){e.onChanged()}break}}}m.stopPropagation()});var h=function(j,l){c.css("background-image","url("+j+")").html('<div class="progress"><div></div></div>');if(l){f.file=d}else{f.data=ImageUtil.dataURItoBlob(j)}e.upload()};var g=d.name.split(".").pop().toLowerCase();var b=new FileReader();b.onload=function(l){if(!top.SiteState.getSessionUser().premium&&["jpg","jpeg","png"].indexOf(g)>-1){var j=new Image();j.onload=function(){if(j.width<=1024&&j.height<=1024){h(l.target.result,true);return}var p=ImageUtil.getImageExifOrientation(j);var s=Math.min(Math.min(1024/j.width,1024/j.height),1);var o=j.width*s;var r=j.height*s;var q=document.createElement("canvas");q.width=p>4&&p<9?r:o;q.height=p>4&&p<9?o:r;var n=q.getContext("2d");switch(p){case 2:n.translate(o,0);n.scale(-1,1);break;case 3:n.translate(o,r);n.rotate(Math.PI);break;case 4:n.translate(0,r);n.scale(1,-1);break;case 5:n.rotate(0.5*Math.PI);n.scale(1,-1);break;case 6:n.rotate(0.5*Math.PI);n.translate(0,-r);break;case 7:n.rotate(0.5*Math.PI);n.translate(o,-r);n.scale(-1,1);break;case 8:n.rotate(-0.5*Math.PI);n.translate(-o,0);break}n.fillStyle="white";n.fillRect(0,0,o,r);n.drawImage(this,0,0,o,r);var m=q.toDataURL("image/jpeg",0.85);h(m)};j.src=l.target.result}else{h(l.target.result,true)}};b.readAsDataURL(d)};ShareControl.prototype.upload=function(){var e=this;if(e.uploading||e.uploads.length==0){return}e.uploading=1;var g=null;var c;for(var d=0;d<e.uploads.length;++d){g=e.uploads[d];c=a(g.item);if(c.find(".error").length){g=null;c=null}else{break}}if(g==null||(!g.data&&!g.file)){e.uploading=0;return}var h=new FormData();h.append("image",g.data?g.data:g.file);h.append("file_id",Math.round((new Date()).getTime()/1000));h.append("mini",e.input.id.indexOf("big")==-1);var b=Date.now();var j=e.xhr=new XMLHttpRequest();j.open("POST","/Shares/uploadImageGetUrl");j.onload=function(){if(j.status===200){c.remove();var f=a.parseJSON(j.response);if(f.status=="ok"){var m=a(e.input);var l=m.val();a(e.input).val(l+(l.length?" ":"")+f.filename+" ").trigger("input").focus();e.uploads.splice(0,1);e.update();e.xhr=null;e.uploading=0;e.upload();if(e.onChanged){e.onChanged()}return}}c.html('<div class="progress error pif-warning"></div>');e.xhr=null;e.uploading=0;e.upload()};j.upload.onprogress=function(f){c.find(".progress div").css("width",(f.loaded/f.total*100|0)+"%")};j.send(h)}})(jQuery);(function(a){PlurkPoster=function(d){var b={mode:"big",more_options:true,show_submit:true,cookie:"default_qual",input_id:"input_big",lang:"en"};if(d){for(var c in d){b[c]=d[c]}}this.mode=b.mode;this.more_options=b.more_options;this.init(b)};PlurkPoster.prototype={htmlTmpl:'<div class="plurkForm"><div class="input_holder"><div class="qual_holder"></div><div class="textarea_holder"><textarea name="content" class="content" id="{{input_id}}"></textarea></div><div class="share_holder"></div></div><ul class="icons_holder"></ul><div class="plurk_to"></div><div class="char_updater" id="{{input_id}}_cu"></div></div>',init:function(d){var e=this;var c=a(Handlebars.compile(e.htmlTmpl)({input_id:d.input_id}));e.table=c[0];var b;if(d.show_submit){b=a('<div class="click submit_img">Plurk</div>').prependTo(c);e.submit_btn=b[0]}var f=c.find("textarea.content");e.input=f[0];e.initOualMenu(d);e.share=new ShareControl(e.input,e.table);e.share.onChanged=function(){e.updated()};c.find(".share_holder").append(e.share.list);if(d.more_options){e.privateOptions=new PrivateOptions(c.find(".plurk_to")[0])}e.initToolButtons(d);MaxChar.init(e.input,c.find(".char_updater")[0],d.lang);f.on("input",function(){var j=parseFloat(f.css("line-height"));var l=f.height();f.height(0);var g=Math.max(Math.min((f[0].scrollHeight/j)*j,j*4),j);f.height(g);if(e.mode=="big"){var h=jQuery("#plurk_form").height()-86;if(jQuery("body").scrollTop()-l+j-60<=h){jQuery("body").scrollTop(h)}}e.updated()});if(e.submit_btn){b.click(function(){e.submit();return false})}f.keypress(function(g){if(g.which==13&&!g.shiftKey){e.submit();return false}});setTimeout(function(){var g=new UserComplete(e.input,"@")});this.menu.resetQualifier()},initOualMenu:function(c){var d=this;var b=a(d.table);var e=function(f){if(d.submit_btn){var g=Qualifiers.getQual(d.submit_btn);a(d.submit_btn).removeClass("q_"+g+" submit_img_color").addClass(f==":"?"submit_img_color":("q_"+f))}a(d.input).focus();if(d.type=="plurk"){if(f=="whispers"){if(b.find(".whispers_hint").length==0){a("#plurk_to").css("display","none");var j='<div id="anon_msg">'+_('This message will be posted anonymously. Check <a href="%s" target="_blank">here</a> for more about Anonymous Plurk.')+"</div>";var h=(window.LANG&&window.LANG.indexOf("zh_")==0)?"http://zh.blog.plurk.com/archives/1695":"http://en.blog.plurk.com/2013/01/21/what-is-anonymous-plurk/";j=j.replace("%s",h);a('<div class="whispers_hint">'+j+"</div>").insertAfter(b.find("#plurk_to"))}}else{a("#plurk_to").css("display","block");b.find(".whispers_hint").remove()}}};d.menu=new QualifierSelector(c.lang,c.cookie,c.extra_menu_class,d.mode,e);b.find(".qual_holder").css("float",c.lang=="ja"?"right":"left").append(d.menu.button)},initToolButtons:function(d){var e=this;$holder=a(e.table).find(".icons_holder");function c(g,j){var f=(e.mode=="big")?"cmp_"+g:"cmp_"+g+"_mini";var h=a('<li class="'+f+"_off pif-"+g+'"></li>');h.click(function(l){if(g=="emoticon"){Emoticons.toggle(e.input.id,l)}else{if(g=="privacy"){e.privateOptions.toggleFrom(e.input)}else{if(g=="sync"){e.toggleSyncForm()}else{if(g=="media"){e.share.triggerAdd()}else{if(g=="anynomous"){if(Qualifiers.getQual(e.menu.button)=="whispers"){e.menu.resetQualifier()}else{e.menu.setQualifier("whispers")}}}}}}}).mouseover(function(){a(this).removeClass(f+"_off").addClass(f+"_on");HoverPopView(this,false,{content:j,ex_class:"popTooltip",direction:"top"})}).mouseout(function(){a(this).removeClass(f+"_on").addClass(f+"_off")});return h}$holder.append(c("emoticon",_("Select emoticon(s)"))).append(c("media",_("Share media")));if(d.more_options){$holder.append(c("sync",_("Plurk to other networks")));var b=SiteState.getSessionUser();if(b&&b.post_anonymous_plurk){$holder.append(c("anynomous",_("whispers")))}$holder.append(c("privacy",_("Privacy options")))}},toggleSyncForm:function(){var g=this;var d=1;if(g.sync){g.sync.toggleFrom(g.input)}else{var e=a('<ul class="sync_checked_ul" class="content"></ul>');var c=SiteState.getSessionUser();var b=a('<li><input type="checkbox"></li>').appendTo(e);if(c.has_facebook){b.append('<label for="facebook_sync">Facebook</label>').children("input").attr({"class":"facebook_sync",checked:"checked"})}else{b.append('<a href="javascript:void(0)">Facebook</a>').children("input").attr({"class":"add_facebook_sync",name:"facebook_sync",disable:"disable"});b.click(function(){top.TopBar.showMyAccount("/FacebookApp/");return false})}var f=a('<li><input type="checkbox"></li>').appendTo(e);if(c.has_twitter){f.append('<label for="twitter_sync">Twitter</label>').children("input").attr({"class":"twitter_sync",checked:"checked"})}else{f.append('<a href="javascript:void(0)">Twitter</a>').children("input").attr({"class":"add_Twitter_sync",name:"twitter_sync",disable:"disable"});f.click(function(){top.TopBar.showMyAccount("/TwitterApp/");return false})}if(window.LANG&&(window.LANG.indexOf("zh_Hant")!==-1)){var h=a('<li><input type="checkbox"></li>').appendTo(e);if(c.has_weibo){h.append('<label for="weibo_sync">'+_("Sina Weibo")+"</label>").children("input").attr({"class":"weibo_sync",checked:"checked"})}else{h.append('<a href="javascript:void(0)">'+_("Sina Weibo")+"</a>").children("input").attr({"class":"add_weibo_sync",name:"weibo_sync",disable:"disable"});h.click(function(){top.TopBar.showMyAccount("/weiboApp/");return false})}}$sync_holder=a('<div class="sync_checked_holder"></div>').append(a('<div class="sync_checked_form"></div>').append('<div class="header">'+_("Also post to:")+"</div>",e));g.sync=new PopView({content:$sync_holder[0],offset:2,align:"left",arrowAlign:"left",style:{"z-index":2000}});g.sync.showFrom(a(g.table).find(".textarea_holder textarea"))}},clear:function(){this.clearing=true;a(this.input).val("").focus().trigger("input");this.share.clear();this.menu.resetQualifier();if(this.privateOptions){this.privateOptions.reset()}this.clearing=false},setToUser:function(d,b){var c=this;if(c.type!="plurk"){return}c.to_user_id=d;$table=a(c.table);$table.find(".icons_holder .pif-sync, .icons_holder .pif-anynomous, .icons_holder .pif-privacy").remove();if(c.privateOptions){if(c.privateOptions.popview){c.privateOptions.popview.hide();c.privateOptions.popview.remove()}c.privateOptions=null}if(c.sync){c.sync.hide();c.sync.remove();c.sync=null}$table.find(".plurk_to").html('<i class="pif-privacy"></i>'+_("this plurk will be viewable to")+" <b>"+b+"</b>")},setToPlurk:function(c){var d=this;if(d.type!="response"){return}console.log("setToPlurk",c);d.to_plurk_obj=0;d.clear();var b=PlurkPoster.typing_responses[c.plurk_id];console.log(b);if(b){d.setPosting=b.posting;d.input.value=b.content||"";if(b.uploading){d.share.uploads=b.uploading;d.share.update()}}else{d.setPosting=false}d.to_plurk_obj=c},setPosting:function(b){var c=this;if(b){a(c.table).addClass("posting");a(c.input).attr("readOnly",true);if(c.submit_btn){a(c.submit_btn).addClass("pif-plurkapp").html("")}}else{a(c.table).removeClass("posting");a(c.input).attr("readOnly",false);if(c.submit_btn){a(c.submit_btn).removeClass("pif-plurkapp").html("Plurk")}a(c.input).focus()}},submit:function(){var c=this;if(a(c.input).attr("readOnly")){return}var b=a(c.input).val();if(!b.length){return}var f={lang:c.menu.cur_lang,qualifier:c.menu.getQualifier(),content:a(c.input).val()};if(c.more_options){if(c.privateOptions){f.no_comments=c.privateOptions.getNoComment();f.replurkable=c.privateOptions.getReplurkable();var e=c.privateOptions.getLimitedTo();if(e){f.limited_to=e}}if(c.sync){$sync_view=a(c.sync.view);var d=function(j,g){var h=a(c.sync.view).find(j);if(h.length&&!h.prop("checked")){f.content+=" !"+g}};d(".facebook_sync","FB");d(".twitter_sync","TW");d(".weibo_sync","WB")}}if(c.on_submit){c.on_submit.call(c,f)}},onSubmit:function(b){this.on_submit=b},updated:function(){var b=this;if(b.on_change&&!b.clearing){var c={content:a(b.input).val(),uploads:b.share.uploads};b.on_change.call(b,c)}},onChange:function(b){this.on_change=b},load:function(c){var b=this;if(c){if(c.content){a(b.input).val(c.content)}if(c.uploads){b.share.uploads=c.uploads}}}}})(jQuery);Emoticons={all_paths:{},isEmoticon:function(c){var b=Emoticons.all_paths;if(!Emoticons.inited_paths){var a=EmoticonsList.generateEmoticons("all",{karma:100,recruited:50});AJS.map(a,function(d){b[d[1]]=true});Emoticons.inited_paths=true}return b[c]},current_tab:null,is_inited:false,init:function(){},_$emoSelecter:null,_emoPopView:null,_init:function(){if(this.is_inited){return false}var e=388;var b='<div id="emoticon_selecter_holder"><div id="emoticons_scroll_holder"><div id="emoticons_holder"></div><div id="emoticons_scroll_bar"></div></div><div id="emoticons_tabs"></div></div>';Emoticons._$emoSelecter=jQuery(b).css({width:e}).click(function(g){g.stopPropagation()});Emoticons._emoPopView=new PopView({content:Emoticons._$emoSelecter[0],id:"emoticon_selecter",offset:2,direction:"top",align:"left",arrowAlign:"left",onresize:true,onShow:function(){Emoticons.checkTabsArrows();Emoticons._enableScrollBarEvent();jQuery("#emoticons_holder",Emoticons._$emoSelecter).trigger("scroll")}});var a=e/screen.availWidth;if(a>1){Emoticons._$emoSelecter.css({transform:"scale("+(1/a)+")"});Emoticons._$emoSelecter.data("shrinked",true)}Emoticons._renderTabs();var f=jQuery("#emoticons_holder",Emoticons._$emoSelecter);var d=f[0];MouseWheel.lockWheelInElement(f);var c=jQuery("#emoticons_scroll_bar");f.scroll(function(){var j=f.height()/f[0].scrollHeight;if(j>=1){c.height(0)}else{var g=j*f.height()-2;var h=j*f.scrollTop()+1;c.height(g).css("top",h)}});jQuery("#emoticons_scroll_holder").mouseover(function(){if(!Emoticons.scrollBarDown){c.css("opacity",0.2)}}).mouseout(function(){if(!Emoticons.scrollBarDown){c.css("opacity",0)}});c.mousedown(function(g){Emoticons.scrollBarDown=true;Emoticons.mouseY=g.pageY;c.css("opacity",0.5);g.preventDefault()});if(FeatureManager.isAvailable("EmoticonManager")){jQuery("<a></a>").attr({id:"emo_manager_button",title:_("Manage...")}).addClass("pif-setting").click(function(){(new PopWindow({url:"/EmoticonManager2",width:660,height:444,onColse:function(){EmoticonsMy.reloadEverything()}})).show();Emoticons.forceHide();return false}).appendTo(jQuery("#emoticons_tabs",Emoticons._$emoSelecter))}this.is_inited=true;if(EmoticonsCampaign.campaignPromotion.shouldSelectCampaignTab){Emoticons.selectEmoTab(AJS.$("emo_campaign_"+EmoticonsCampaign.campaignPromotion.promotedID),"camp_"+EmoticonsCampaign.campaignPromotion.promotedID);EmoticonsCampaign.campaignPromotion.shouldSelectCampaignTab=false}else{Emoticons.selectEmoTab(AJS.$("emo_basic"),"basic")}},_renderTabs:function(){var c=jQuery("<ul></ul>").appendTo("#emoticons_tabs",Emoticons._$emoSelecter);var b=function(g,d,f,e){return jQuery('<li id="'+g+'"><a><img src="'+d+'" title="'+f+'" /></a></li>').appendTo(c).click(function(h){Emoticons.selectEmoTab(this,e,h)})};b("emo_basic","//s.plurk.com/2113008363b43280790642731d28756a.png",_("Basic set"),"basic");var a=b("emo_extra","//s.plurk.com/a5f799bcf978e05621c0970db122d1ac.png",_("Extra set"),"extra");EmoticonsCampaign.loadTabsIntoEmoPanel(a);b("emo_my","//s.plurk.com/abc64276d84b2ce45e5c5092ee61c017.png",_("My Emoticons"),"my_1");EmoticonsMy.loadTabs(c[0])},selectEmoTab:function(c,a,b){if(b){AJS.preventDefault(b)}Emoticons.current_tab=a;Emoticons._checkNeedsToScrollBySelectingTab(c);AJS.removeClass(AJS.$bytc("li",null,AJS.$("emoticons_tabs")),"current");AJS.addClass(c,"current");if(a.substr(0,3)=="my_"){EmoticonsMy.showEmoticons(a)}else{if(a.substr(0,5)=="camp_"){EmoticonsCampaign.showCampaign(a)}else{if(a=="campaign_emoticons"){EmoticonsCampaign.showEmoticons()}else{Emoticons.showEmoticons(a)}}}jQuery("#emoticons_holder",Emoticons._$emoSelecter).scrollTop(0).trigger("scroll");return false},showEmoticons:function(e){var b=SiteState.getSessionUser();var c=b&&b.karma||0;var d=EmoticonsList.generateEmoticons(e);Emoticons._renderEmoticonHolder(d);var a=null;if(EmoticonsList.event.enabled&&e==EmoticonsList.event.type){if(Emoticons.event.generateExtraEmo){a=Emoticons.event.generateExtraEmo()}}else{if(c<50){var f=AJS.A({href:"javascript:void(0)",c:"red_link"},_("Want extra exclusive emoticons?"));AJS.AEV(f,"click",function(){Emoticons.forceHide();(new PopWindow({url:"/Help/extraSmilies",width:440})).show();return false});a=AJS.DIV({c:"extra_emos_tip"},f)}}jQuery("#emoticons_holder",Emoticons._$emoSelecter).append(a)},_renderEmoticonPagesContainer:function(c,d){var b=jQuery("<ul></ul>").attr("id","emoticon_child_container");for(var a in c){var f=c[a];var e=jQuery("<li></li>").addClass(a>=d?"disabled":"enabled").data("emo_type",f[2]).append(jQuery("<img />").attr("src",f[1]));if(f.length>3){e.data("emoobj",f[3])}b.append(e)}b.on("mouseover",".enabled,.disabled",function(){var g=jQuery(this);var h=g.data("emoobj");if(h){EmoticonsMy.showHint(g,h,g.hasClass("enabled"))}});b.on("click",".enabled",function(){Emoticons.select(this)});return b},_renderEmoticonHolder:function(a){Emoticons.replaceEmoticonPagesParentContent(Emoticons._renderEmoticonPagesContainer(a))},_putPrerenderedIntoEmoticonHolder:function(a){Emoticons.replaceEmoticonPagesParentContent(a)},replaceEmoticonPagesParentContent:function(){var b=jQuery("#emoticons_holder",Emoticons._$emoSelecter);if(jQuery("ul",b).hasClass("emoticons_my")||jQuery("ul",b).hasClass("emoticons_campaign")||jQuery("ul",b).hasClass("emoticons_campaign_holder")){b.children().detach()}else{b.empty()}for(var a=0;a<arguments.length;a++){b.append(arguments[a])}},scrollBarDown:false,mouseY:0,_enableScrollBarEvent:function(){var b=jQuery("#emoticons_holder",Emoticons._$emoSelecter);var a=jQuery("#emoticons_scroll_bar");jQuery(document).on("mousemove.emoticonScroll",function(d){if(Emoticons.scrollBarDown){var c=d.pageY-Emoticons.mouseY;var f=b[0].scrollHeight/b.height();b.scrollTop(b.scrollTop()+f*c);Emoticons.mouseY=d.pageY;d.preventDefault()}});jQuery(document).on("mouseup.emoticonScroll",function(c){if(Emoticons.scrollBarDown){Emoticons.scrollBarDown=false;a.css("opacity",0.2);c.preventDefault()}})},_clearScrollBarEvent:function(){jQuery(document).off("mousemove.emoticonScroll").off("mouseup.emoticonScroll")},select:function(d){var c=jQuery(d).data("emo_type");var a=AJS.$("input_big_private")?AJS.$("input_big_private"):AJS.$(Emoticons.cur_input);var b="";if(AJS.strip(a.value)!=""){b=" ";if(AJS.getLast(a.value)==" "){b=""}}InputUtil.insertAtCursor(a,b+c);_gaq_push(["_trackEvent","emos_select",Emoticons.current_tab,c]);PlurkBoxExpand.init(a);Emoticons.forceHide()},forceHide:function(){Emoticons._emoPopView.hide();var a=AJS.$("input_big_private")?AJS.$("input_big_private"):AJS.$(Emoticons.cur_input);a.focus();Emoticons.shown=false;Emoticons._clearScrollBarEvent()},forceHideIfBoundToPlurkResponse:function(){if(Emoticons.cur_input=="input_small"){Emoticons.forceHide()}},cur_input:null,toggle:function(a,b){Emoticons._init();Emoticons.cur_input=a;Emoticons._emoPopView.toggleFrom(jQuery("#"+a));setTimeout(function(){})},checkTabsArrows:function(){var a=jQuery("#emoticons_tabs",Emoticons._$emoSelecter);var b=a.find("ul");var c=b.find("li").length;if(c>9){if(jQuery(".emo_tab_arrow",a).length===0){var d=jQuery(Handlebars.compile('<div class="emo_tab_arrow" id="emo_tab_arrow_left"><span class="pif-arrow-left"></span></div>')());var e=jQuery(Handlebars.compile('<div class="emo_tab_arrow" id="emo_tab_arrow_right"><span class="pif-arrow-right"></span></div>')());a.append(d).append(e);b.addClass("emo_tabs_with_arrows");d.click(function(){if(!d.hasClass("disabled")){Emoticons._onTabsArrowClick("left")}});e.click(function(){if(!e.hasClass("disabled")){Emoticons._onTabsArrowClick("right")}})}Emoticons._checkArrowsEnabledness()}else{jQuery(".emo_tab_arrow",a).remove()}},_onTabsArrowClick:function(c){var a=jQuery("#emoticons_tabs ul",Emoticons._$emoSelecter);a.stop();var b=Math.floor(a.scrollLeft()/38)*38;b+=((c==="left")?-1:1)*(38*6);if(b==a.scrollLeft()){return}a.stop().animate({scrollLeft:b},250,function(){Emoticons._checkArrowsEnabledness()})},_checkArrowsEnabledness:function(){var a=jQuery("#emoticons_tabs",Emoticons._$emoSelecter);var b=a.find("ul");if(b.scrollLeft()===0){jQuery("#emo_tab_arrow_left",a).addClass("disabled")}else{jQuery("#emo_tab_arrow_left",a).removeClass("disabled")}if(b.scrollLeft()+b.width()>=b[0].scrollWidth){jQuery("#emo_tab_arrow_right",a).addClass("disabled")}else{jQuery("#emo_tab_arrow_right",a).removeClass("disabled")}},_checkNeedsToScrollBySelectingTab:function(b){var c=jQuery(b);var a=jQuery("#emoticons_tabs ul",Emoticons._$emoSelecter);if(c.position().left==0){Emoticons._onTabsArrowClick("left")}else{if(c.position().left>=a.width()-38){Emoticons._onTabsArrowClick("right")}}}};EmoticonsCampaign={campaignEmoticonsAdapted:[],$campaignEmoticonsCached:null,campaigns:{},$campaignsCached:{},campaignAJAXPromise:null,loadTabsIntoEmoPanel:function(a){var c=jQuery(a);jQuery.ajax("/EmoticonManager/getCampaignEmoticons",{data:{form_token:GLOBAL.session_user.token,format:"json"},dataType:"json",type:"POST"}).done(function(d){EmoticonsCampaign.campaignEmoticonsAdapted=[];for(var e in d){jQuery.map(d[e],function(f){EmoticonsCampaign.campaignEmoticonsAdapted.push([null,f.url,"{"+f.keyword+"}"])})}});var b=function(l){for(var e=0;e<l.length;e++){var h={};var g=l[e];h.emoticons0=[];h.emoticons1=[];for(var f=0;f<g.emoticons.length;f++){var d=g.emoticons[f];if(d.stage==0){h.emoticons0.push([null,d.url,"{"+d.keyword+"}"])}else{if(g.signup){h.emoticons1.push([null,d.url,"{"+d.keyword+"}"])}else{h.emoticons1.push([null,d.url])}}}h.name=g.campaign_name;h.promotion=g.promotion;h.url=g.url;h.end=isNaN(new Date(g.end))?null:Cal.formatMonthDate(Cal.convertToLocal(new Date(g.end),true));h.type=g.type;h.finished=g.signup;h.sponsorLinkTitle=g.company_name;h.sponsorLinkURL=g.company_url;EmoticonsCampaign.campaigns[g.id]=h;var j=jQuery("<li></li>").data("cid",g.id).attr({id:"emo_campaign_"+g.id}).append(jQuery("<a></a>").attr({href:"javascript:void(0)"}).append(jQuery("<img />").attr({src:g.icon,title:g.campaign_name})));j.click(function(m){Emoticons.selectEmoTab(this,"camp_"+jQuery(this).data("cid"),m)});c.after(j);c=j;Emoticons.checkTabsArrows()}};EmoticonsCampaign.campaignAJAXPromise.done(b)},showEmoticons:function(){if(EmoticonsCampaign.$campaignEmoticonsCached){Emoticons.replaceEmoticonPagesParentContent(EmoticonsCampaign.$campaignEmoticonsCached);return false}Emoticons._renderEmoticonHolder(EmoticonsCampaign.campaignEmoticonsAdapted);jQuery("#emoticons_holder #emoticon_child_container",Emoticons._$emoSelecter).addClass("emoticons_campaign");EmoticonsCampaign.$campaignEmoticonsCached=jQuery("#emoticons_holder",Emoticons._$emoSelecter).contents();return false},showCampaign:function(e){var j=parseInt(e.substr(5));Emoticons._currentEmoticonPage=0;if(EmoticonsCampaign.$campaignsCached[j]){Emoticons.replaceEmoticonPagesParentContent(EmoticonsCampaign.$campaignsCached[j]);return false}var h=EmoticonsCampaign.campaigns[j];var d="<div id='emoticon_child_container' class='emoticons_campaign_holder'></div>";var c=jQuery(Handlebars.compile(d)({title:h.name}));var g;if(h.emoticons0.length>0){c.append(g=Emoticons._renderEmoticonPagesContainer(h.emoticons0))}if(h.finished){if(h.type==0){c.append(Emoticons._renderEmoticonPagesContainer(h.emoticons1))}var a="<div class='emoticons_campaign_sponsor_link'><a href='{{sponsorLinkURL}}' id='emoticons_campaign_sponsor_link' target='_blank'>{{sponsorLinkTitle}}</a></div>";var l=Handlebars.compile(a)({sponsorLinkURL:h.sponsorLinkURL,sponsorLinkTitle:h.sponsorLinkTitle});c.append(l)}else{var f="<div class='emoticons_campaign_description'>{{{desc}}}</div><div class='emoticons_campaign_signup'><a href='{{campaignURL}}' id='emoticons_campaign_signup' target='_blank'>{{signupMsg}}</a></div><div class='emoticons_campaign_end_message'>{{endMsg}}</div>";var b=Handlebars.compile(f)({desc:h.promotion,signupMsg:_("Get more emoticons"),campaignURL:h.url,endMsg:h.end?_("This campaign ends on %s").replace("%s",h.end):""});c.append(b)}EmoticonsCampaign.$campaignsCached[j]=c;c.addClass("emoticons_campaign");Emoticons.replaceEmoticonPagesParentContent(c);if(h.finished){jQuery("a#emoticons_campaign_sponsor_link",c).click(function(){_gaq_push(["_trackEvent","emo_campaign","sponsor_link_click",j.toString()])})}else{jQuery("a#emoticons_campaign_signup",c).click(function(){_gaq_push(["_trackEvent","emo_campaign","signup",j.toString()])})}return false},campaignPromotion:{promotionIsOn:false,$promotion:null,promotedID:2,emoSelectorButtonMousedownHelper:null,shouldSelectCampaignTab:false}};jQuery(document).ready(function(){if(document.cookie.indexOf("campaign_promotion")!=-1){return}EmoticonsCampaign.campaignAJAXPromise=jQuery.ajax("/EmoticonManager/getCampaigns",{data:{form_token:GLOBAL.session_user?GLOBAL.session_user.token:null,format:"json"},dataType:"json",type:"POST"});EmoticonsCampaign.campaignAJAXPromise.done(function(e){for(var b=0;b<e.length;b++){if(e[b].id==EmoticonsCampaign.campaignPromotion.promotedID){if(!e[b].signup){EmoticonsCampaign.campaignPromotion.promotionIsOn=true}break}}if(EmoticonsCampaign.campaignPromotion.promotionIsOn){var a="<div class='AmiTT_main AmiTT_left' id='emoticons_campaign_promotion'>   <div class='tooltip_cnt'>       <img src='{{img}}' />       {{desc}}   </div></div>";var c=jQuery("#main_poster");var d=function(){EmoticonsCampaign.campaignPromotion.$promotion.removeClass("emoticons_campaign_promotion_show")};var f=function(){EmoticonsCampaign.campaignPromotion.$promotion.addClass("emoticons_campaign_promotion_show")};c.one("focus","textarea#input_big",function(){var h=Handlebars.compile(a)({img:"http://emos.plurk.com/pr2_a80e1ef9f174702af50db206803d54d6_64x64.png",desc:"超卡哇依表情符號現正推出！想獲得更多表情符號？動手指就可以免費下載！>>馬上前往"});EmoticonsCampaign.campaignPromotion.$promotion=jQuery(h);var g=jQuery(".emoticon_selecter_img_off",c).offset();EmoticonsCampaign.campaignPromotion.$promotion.appendTo("body").css({top:g.top+32+"px",left:g.left+3+"px"}).addClass("emoticons_campaign_promotion_show");jQuery(".icons_holder",c).on("mouseenter",d).on("mouseleave",f);EmoticonsCampaign.campaignPromotion.emoSelectorButtonMousedownHelper=function(){if(EmoticonsCampaign.campaignPromotion.promotionIsOn){EmoticonsCampaign.campaignPromotion.shouldSelectCampaignTab=true}};jQuery(".emoticon_selecter_img_on, .emoticon_selecter_img_off",c).on("mousedown",EmoticonsCampaign.campaignPromotion.emoSelectorButtonMousedownHelper)}).one("blur","textarea#input_big",function(){EmoticonsCampaign.campaignPromotion.promotionIsOn=false;document.cookie="campaign_promotion=1; expires="+(new Date((new Date()).getTime()+86400*1000)).toGMTString();jQuery(".icons_holder",c).off("mouseenter",d).off("mouseleave",f);jQuery(".emoticon_selecter_img_on, .emoticon_selecter_img_off",c).off("mousedown",EmoticonsCampaign.campaignPromotion.emoSelectorButtonMousedownHelper);EmoticonsCampaign.campaignPromotion.emoSelectorButtonMousedownHelper=null;EmoticonsCampaign.campaignPromotion.$promotion.removeClass("emoticons_campaign_promotion_show");setTimeout(function(){EmoticonsCampaign.campaignPromotion.$promotion.remove();EmoticonsCampaign.campaignPromotion.$promotion=null},100)})}})});EmoticonsList={basic:[[/(?:(\s+|^)):-?\)\)/,"//s.plurk.com/ff124032f8cc3a9d43b99e661f8fcb4d.gif",":-))"],[/(?:(\s+|^)):-?\)/,"//s.plurk.com/99ef3957ef779718546752b749bdeabd.gif",":-)"],[/(?:(\s+|^)):-?D/i,"//s.plurk.com/3385896779bf1c13188bf92ca516878e.gif",":-D"],[/(LOL)/,"//s.plurk.com/615f18f7ea8abc608c4c20eaa667883b.gif","(LOL)"],[/:-?P/i,"//s.plurk.com/2d5e21929e752498e36d74096b1965e1.gif",":-P"],[/\(woot\)/i,"//s.plurk.com/13b15aa49358be8f47b58552401d7725.gif","(woot)"],[/;-?\)/i,"//s.plurk.com/57c69f50e40a283dcd2e7b56fc191abe.gif",";-)"],[/:-?o/i,"//s.plurk.com/8eb05ca7a32301ba16c9496bcad893c4.gif",":-o"],[/X-?\(/,"//s.plurk.com/261c0fe4a88417146ae0292d697a5f52.gif","X-("],[/:-?\(/,"//s.plurk.com/11eed61b41a3e935773476ac33bc00d9.gif",":-("],[/:'-?\(/,"//s.plurk.com/72ddf2c585fe77dd0be731b19624d8cb.gif",":'-("],[/:-?&amp;/,"//s.plurk.com/2884b8d0e496c06136c86e9c9599edae.gif",":-&"]],silver:[[/(?:(\s+|^))\(K\)/,"//s.plurk.com/9454d15bcaf411b159dcc147ebc3f0eb.gif","(K)"],["(angry)","//s.plurk.com/a5ae31c4185bc60cd006650dc10f8147.gif","(angry)"],["(annoyed)","//s.plurk.com/35b16fc25623670e41c2be6bf8ac38c7.gif","(annoyed)"],[/\(bye\)|\(wave\)/,"//s.plurk.com/4afd784c0df9f7a3ceacb92beca543f6.gif","(wave)"],[/(?:(\s+|^))B-?\)/,"//s.plurk.com/c1c9870cf653fa3cd103d2eb0f519ccb.gif","B-)"],["(cozy)","//s.plurk.com/d1a6f08507b126ec6a215e6a2372e8bb.gif","(cozy)"],["(sick)","//s.plurk.com/5495d64ccb898ca596b061168fa0374a.gif","(sick)"],["(:","//s.plurk.com/b82e3225c92a764d225429a6487d9f04.gif","(:"],["(goodluck)","//s.plurk.com/65271ac2126706bc09d31ff67c525d67.gif","(goodluck)"],["(griltongue)","//s.plurk.com/a709dab8ddd26bd222466d31bd549579.png","(griltongue)"],[/(mmm)/,"//s.plurk.com/e3baa9d0d78c35e955a6b07c39f530fa.gif","(mmm)"],["(hungry)","//s.plurk.com/0f96595ed7733393b93a3d67aa4f2f4f.gif","(hungry)"],["(music)","//s.plurk.com/919b87048fdf7bd59dae457f4284b20b.gif","(music)"],["(tears)","//s.plurk.com/96872d481bbfe87aad5aed976c7de4ee.gif","(tears)"],["(tongue)","//s.plurk.com/56336bb821c4766001816639e55e5811.gif","(tongue)"],["(unsure)","//s.plurk.com/6cb1dc388b9259565efedef8f336d27d.gif","(unsure)"],["(highfive)","//s.plurk.com/a9560787e93f4f8890e4bd38696ba537.gif","(highfive)"],["(dance)","//s.plurk.com/a55bdb344892676b0fea545354654a49.gif","(dance)"],["(blush)","//s.plurk.com/9939dd585cf0e8d39e7912a98a9ce727.gif","(blush)"]],gold:[["(doh)","//s.plurk.com/e8ed6c7eed76d2acd9dbf469f29fbec2.gif","(doh)"],["(brokenheart)","//s.plurk.com/2b3593aea68efa7a00b4ef2850f98b8a.gif","(brokenheart)"],["(drinking)","//s.plurk.com/ed3620ff28a02e3dc9ac4ffa8e6ae2e6.gif","(drinking)"],["(girlkiss)","//s.plurk.com/08a43d50691a1ed22706fc92f568fa07.gif","(girlkiss)"],["(rofl)","//s.plurk.com/8600839dc03e6275b53fd03a0eba09cf.gif","(rofl)"],["(money)","//s.plurk.com/e6bb16b6ef386c5f23900b103dbdba31.gif","(money)"],["(rock)","//s.plurk.com/1c890273544559b17f090d09238fa763.gif","(rock)"],["(nottalking)","//s.plurk.com/f053074bcce500fbd1e2327d49748a6d.gif","(nottalking)"],["(party)","//s.plurk.com/1f44d3984a094fceae1f1a016a730fc9.gif","(party)"],["(sleeping)","//s.plurk.com/2f7c90ce56fb4a70e34c04d8d7692dd0.gif","(sleeping)"],["(thinking)","//s.plurk.com/900f3dd0adaad9142d567caf6bfb1311.gif","(thinking)"],["(bringit)","//s.plurk.com/95ace5ba1097301b5206a9e0fb431624.gif","(bringit)"],["(worship)","//s.plurk.com/95e69aa508d4bb435706b9db0a610dad.gif","(worship)"],["(applause)","//s.plurk.com/a08ed27ec14b48d4703f53f7eb94834b.gif","(applause)"],[/8-?\)/,"//s.plurk.com/85ef5fa01a6a67a525429f8bf4279fe7.gif","8-)"],[/(gym)/,"//s.plurk.com/986ecf2b1ae69072e0195b0a58545900.gif","(gym)"],[/(heart)/,"//s.plurk.com/150e3f367a063d3baf9720719d78d778.gif","(heart)"],[/(devil)/,"//s.plurk.com/3fabe74e992888be701de2a9d80c180a.gif","(devil)"],[/(lmao)/,"//s.plurk.com/92b595a573d25dd5e39a57b5d56d4d03.gif","(lmao)"],["(flower)","//s.plurk.com/af44689f789b98cfcb103844f7fbfce8.png","(flower)"]],platinum:[["(bigeyes)","//s.plurk.com/8073c1716e75d32eb79f97a9f521fa01.gif","(bigeyes)"],["(funkydance)","//s.plurk.com/373cd2f23dab7528d4875170d13d64f7.gif","(funkydance)"],["(idiot)","//s.plurk.com/8863234ebea13f109c9b15ba19a4531c.gif","(idiot)"],["(lonely)","//s.plurk.com/8738c7a1c402f41b5319abe504ce9687.gif","(lonely)"],["(scenic)","//s.plurk.com/db4c4a7d141fdcaca4d4b11f8fb360db.gif","(scenic)"],["(hassle)","//s.plurk.com/ced6d40bebe2d424b59322b311fc04bb.gif","(hassle)"],["(panic)","//s.plurk.com/b62d1e55e8311af5bc7526c595ac1dbb.gif","(panic)"],["(okok)","//s.plurk.com/9b6f4864c822e1a97c98507c2b41a74f.gif","(okok)"],["(yahoo)","//s.plurk.com/e49c8ae965452550c98fc7f99741ae0d.gif","(yahoo)"],["(cry)","//s.plurk.com/318416eab5a856bddb1e106a21ff557a.gif","(cry)"]],platinum_2:[["(banana_cool)","//s.plurk.com/4f01bac8a707e5450307f97065ec0fa7.gif","(banana_cool)"],["(banana_rock)","//s.plurk.com/48515125401120316abb97666458d05b.gif","(banana_rock)"],["(evil_grin)","//s.plurk.com/aabbc82c2b0dc72bfbce2f82c97a95e8.gif","(evil_grin)"],["(headspin)","//s.plurk.com/b0b0596acce9ffc1f2a27548aa642eaf.gif","(headspin)"],["(heart_beat)","//s.plurk.com/52991d7ff65a05526454bd1170a0f14c.gif","(heart_beat)"],["(ninja)","//s.plurk.com/846277f0a154dc95a08594b7d32a5ccd.gif","(ninja)"],["(haha)","//s.plurk.com/843739a95294fd0bf4c958840b46408f.gif","(haha)"],["(evilsmirk)","//s.plurk.com/22416dced8b59446db8cd366cc925d09.gif","(evilsmirk)"],["(eyeroll)","//s.plurk.com/e3f0f67ca3af62e34f13abf1d036a010.gif","(eyeroll)"]],karma100:[["(muhaha)","//s.plurk.com/84f94a47fcaf1df0a5f17a1cfa52fa64.gif","(muhaha)"],[/\(rammi\)|\(taser\)/,"//s.plurk.com/44117848701cd748460921cfea5c3781.gif","(taser)"],["(banana_ninja)","//s.plurk.com/88f6dda8d290f66a923c1116a2a2b4ab.gif","(banana_ninja)"],["(beer)","//s.plurk.com/eeaf87c619a0221ec9fa06413fd2d5dc.gif","(beer)"],["(coffee)","//s.plurk.com/48ec47723cb34be3fcbc914e591e69cd.gif","(coffee)"],["(fish_hit)","//s.plurk.com/259a728a690204148037fbee7e2ca2d3.gif","(fish_hit)"],["(muscle)","//s.plurk.com/4383af0e055bce112176c5104deeaadf.gif","(muscle)"],["(smileydance)","//s.plurk.com/70722ab5756c3b89c86d85feab91725d.gif","(smileydance)"],["(morning)","//s.plurk.com/91cf07e3aa16738943fa1147940b48ea.gif","(morning)"]],random:[["(dice)","//s.plurk.com/7c9a7af9caf0bcbadc74ec87400eb66d.png","(dice)"],["(dice2)","//s.plurk.com/e11a2056ff76f0c6c2eca2ad67df5710.png","(dice2)"],["(dice4)","//s.plurk.com/a1fe8924e7dc4a4252b8e2c89fc729a4.png","(dice4)"],["(dice8)","//s.plurk.com/7b990c34dc8f63d90a06a67b8eaf56aa.png","(dice8)"],["(dice10)","//s.plurk.com/001b8fae9b328c7d36a9e7f69d8fa922.png","(dice10)"],["(dice12)","//s.plurk.com/4694141aad1682240b2d3718beeccf67.png","(dice12)"],["(dice20)","//s.plurk.com/22ecc6bed8b99c6a111d5dbc65dc08fd.png","(dice20)"],["(draw)","//s.plurk.com/ed13a8c77dc92dd28996680c13f2fd92.png","(draw)"],["(bobei)","//s.plurk.com/9fc2d756c29e606fd02dd6acdc875ad9.png","(bobei)"],["(bzz)","/static/emoticons//special/bzzz1.png","(bzz)"]],basic2:[["(p-joyful)","//s.plurk.com/34d89dba00f7d827742d7356189d9e45.gif","(p-joyful)"],["(p-smile)","//s.plurk.com/2b38643430539bff6f63f8f9787cd5c7.gif","(p-smile)"],["(p-tongue)","//s.plurk.com/de3010845f3a1f4ab23a0e2cf7865158.gif","(p-tongue)"],["(p-woot)","//s.plurk.com/8a833cb73024c3a6f16e3a2aecb62a28.gif","(p-woot)"],["(p-wink)","//s.plurk.com/355adb5072668715fde7f8e2ab6102d6.gif","(p-wink)"],["(p-sad)","//s.plurk.com/01e23e195d60156d0f60359391d42112.gif","(p-sad)"],["(p-surprised)","//s.plurk.com/2618904ef64fbfd0bab3a2726308afa5.gif","(p-surprised)"],["(p-angry)","//s.plurk.com/2444992757582bb91101d01a76a90037.gif","(p-angry)"],["(p-cry)","//s.plurk.com/e15177947e8424371c5284e94eab51ee.gif","(p-cry)"],["(p-crying)","//s.plurk.com/6e772db00b9114b0b6619cdb8ac044db.gif","(p-crying)"],["(p-laugh)","//s.plurk.com/19ccc05cdc9ab033e23679fbab9ac2bf.gif","(p-laugh)"],["(p-tears)","//s.plurk.com/4eb7b895f382c8df7b81ffce8aa8d14d.gif","(p-tears)"],["(p-wave)","//s.plurk.com/f5e43e5958e4a85242087873fa758802.gif","(p-wave)"],["(p-blush)","//s.plurk.com/39bda5f5a16f063ba7dc9fbaa09df8b9.gif","(p-blush)"],["(p-goodluck)","//s.plurk.com/dcf3529adb7cffb90f52898c5fc0c263.gif","(p-goodluck)"],["(p-hungry)","//s.plurk.com/fb1e2e0e9be6cba531d91bb7e36e2e9f.gif","(p-hungry)"],["(p-nerd)","//s.plurk.com/1f89a4ed88c6f51041cf6c0dd23047e6.gif","(p-nerd)"],["(p-stare)","//s.plurk.com/7e791dbf33969a01924d256a007f8f21.gif","(p-stare)"],["(p-cool)","//s.plurk.com/85b1e00d867f4032c037f47bfbe3f4d3.gif","(p-cool)"],["(p-doh)","//s.plurk.com/40b589d4420b17ff7142d7b3cab68578.gif","(p-doh)"],["(p-griltongue)","//s.plurk.com/0bfd5bcb2d46b2f669e55c04c0147e4e.gif","(p-griltongue)"],["(p-mmm)","//s.plurk.com/875baf5c65b3a09c8bf383dddb26f3a7.gif","(p-mmm)"],["(p-rock)","//s.plurk.com/83bb765835015daa0de6e5f63c7f3dc6.gif","(p-rock)"],["(p-music)","//s.plurk.com/38ceaa23ef016e9819f59199598548d9.gif","(p-music)"],["(ooxx)","//s.plurk.com/ce6a67701d92b67104f15458c9e970a2.gif","(ooxx)"],["(p-sick)","//s.plurk.com/7b53299d7bea53e5ec2f70539e788bf3.gif","(p-sick)"],["(p-drinking)","//s.plurk.com/e0b6d6730952b44847481a711a12a842.gif","(p-drinking)"],["(p-unsure)","//s.plurk.com/d9101dee2e354e84370c639fdc7787d3.gif","(p-unsure)"]],event:{enabled:false},generateEmoticons:function(d,b){if(!b){b=GLOBAL.session_user}var e=b&&b.recruited||0;var c=b&&b.karma||0;var a=[];if(d=="basic"||d=="all"){a=a.concat(EmoticonsList.basic);if(c>=25){a=a.concat(EmoticonsList.silver)}a=a.concat(EmoticonsList.random);a=a.concat(EmoticonsList.basic2)}if(d=="extra"||d=="all"){if(e>=10){a=a.concat(EmoticonsList.platinum)}if(c>=50){a=a.concat(EmoticonsList.gold)}if(c>=81){a=a.concat(EmoticonsList.platinum_2)}if(c>=100){a=a.concat(EmoticonsList.karma100)}}if(EmoticonsList.event.enabled&&(d==EmoticonsList.event.type||d=="all")){a=a.concat(EmoticonsList.event.emos)}return a}};EmoticonsMy={renderDeferred:null,groupsMetaDeferred:null,$cachedFeatureUnavailable:null,customEmoHintTimeout:200,customEmoHintTimer:null,fullAjaxPromise:null,singleAjaxPromise:null,deleteEmo:function(b){var a=AJS.loadJSON("/EmoticonDiscovery/removeEmoticon");a.addCallback(function(c){if(!c.ok){alert("Something went wrong :(")}_gaq_push(["_trackEvent","custom_emos","remove"]);var e=jQuery(".emo_my_tab.current,#emo_my.current",Emoticons._$emoSelecter);var d=e.attr("id")==="emo_my"?1:parseInt(e.data("group"));EmoticonsMy.reloadSingle(d)});a.sendReq({form_token:GLOBAL.session_user.token,hash_id:b.hash_id})},hintTmpl:Handlebars.compile('<div>{{keyword}}<a href="javascript:void(0)" class="pif-delete">{{delString}}</a><div id="emo_disabled_tip">{{disabledString}} <a href="#" onclick="TopBar.showPremium(\'/Premium/\'); false;">{{disabledDetailsString}}</a></div></div>'),showHint:function(d,f,c){var b=jQuery(EmoticonsMy.hintTmpl({keyword:f.keyword?"["+f.keyword+"] ":"",delString:_("Delete"),disabledString:"Plurk Coins required for this emoticon.",disabledDetailsString:"View details"}));if(c){b.children("#emo_disabled_tip").remove()}var e=HoverPopView(d[0],true,{content:b,ex_class:"popTooltip emo-custom-hint",direction:"bottom"});var a=b.children("a");a.click(function(g){g.stopPropagation();g.preventDefault();if(confirm(_("Are you sure you want to delete this emoticon?"))){EmoticonsMy.deleteEmo(f)}e.hide()})},showEmoticons:function(a){if(EmoticonsMy.renderDeferred.state()==="pending"){Emoticons.replaceEmoticonPagesParentContent("<img src='//s.plurk.com/7f5c4282d2e9accfdae99cc6abb6c9bb.gif' />")}if(!FeatureManager.isAvailable("EmoticonManager")){if(Emoticons.$cachedFeatureUnavailable){Emoticons.replaceEmoticonPagesParentContent(Emoticons.$cachedFeatureUnavailable);return}var d=_("You must confirmed your E-Mail to enjoy this feature!");var f;var c=AJS.DIV({c:"emoticons_my"},AJS.DIV({c:"emo-manager-message"},d),AJS.DIV({c:"edit-profile-wrapper"},confirmEmailButton=AJS.INPUT({c:"orange-but",type:"button",value:_("Confirm my E-Mail now")})));AJS.AEV(confirmEmailButton,"click",function(){window.location="/Users/confirmEmail"});var e=jQuery(c);e.click(false);EmoticonsMy.$cachedFeatureUnavailable=e;Emoticons.replaceEmoticonPagesParentContent(e);return}var b=a.substr(3);EmoticonsMy.renderDeferred.done(function(h){if(h[b]==="tip"){var g=jQuery("<div></div>").addClass("emoticons_my");var m=jQuery("<div></div>");m.addClass("emo-manager-message").addClass("emo-manager-no");m.html(_("You have no custom emoticons right now. <br /> Get started by discovering other people's emoticons or uploading your own!"));g.append(m);var j=jQuery("<div><div>").addClass("emo-manager-no-my-emo-arrow");g.append(j);g.click(false);Emoticons.replaceEmoticonPagesParentContent(g);var l=jQuery("div.emoticons_my",jQuery("div#emoticon_selecter"));j.css({"background-image":"url(//s.plurk.com/e4259d5633ccc1e4fabc0017865f1377.png)","background-position":"0px -"+((201-l.height())+m.height()-7)+"px",height:(l.height()-m.height()+7)+"px","margin-left":(l.width()-30)})}else{Emoticons._putPrerenderedIntoEmoticonHolder(h[b])}})},tabTmpl:Handlebars.compile('<li class="emo_my_tab"><a href="javascript:void(0);"><img src="{{thumbnail_url}}" title="{{name}}"/></a></li>'),loadTabs:function(b){var a=jQuery(b);EmoticonsMy.groupsMetaDeferred.done(function(c,d){for(var f=0;f<d.length;f++){var e=d[f].toString();var g=jQuery(EmoticonsMy.tabTmpl({thumbnail_url:c[e]||"//s.plurk.com/13151d0dcee088b8f5991aaee4f57532.png",title:_("My Emoticons")}));g.data("group",e);g.click(function(h){Emoticons.selectEmoTab(this,"my_"+jQuery(this).data("group"),h)});a.append(g)}Emoticons.checkTabsArrows()})},_initLoad:function(){EmoticonsMy.groupsMetaDeferred=jQuery.Deferred();EmoticonsMy.renderDeferred=jQuery.Deferred();EmoticonsMy.fullAjaxPromise=jQuery.ajax("/EmoticonManager/getUserEmoticons",{data:{token:top.SiteState.getToken()},type:"POST",dataType:"json"}).done(function(f){EmoticonsMy.fullAjaxPromise=null;var q=f.g;var d=f.go;var a=[];for(var c in q){a.push(parseInt(c))}a.sort(function(j,g){return j-g});var l=[];for(var e=0;e<a.length;e++){var s=false;for(var b=0;b<d.length;b++){if(d[b]===a[e]){s=true;break}}if(!s){l.push(a[e])}}d=d.concat(l);var n=d;d=[];for(var e=0;e<n.length;e++){var s=false;for(var b=0;b<a.length;b++){if(a[b]===n[e]){s=true;break}}if(s){d.push(n[e])}}EmoticonsMy.groupsMetaDeferred.resolve(q,d);var p={};p["1"]=[];for(var e=0;e<a.length;e++){p[a[e].toString()]=[]}for(var h in f){if(h==="g"){continue}p[h]=EmoticonsMy._adaptEmos(f[h])}var r=true;for(var h in p){if(p[h].length!==0){r=false;break}}var m={};var o=top.SiteState.getSessionUser().premium;for(var h in p){m[h]=EmoticonsMy._renderPartsByPremAndGroup(p[h],h)}if(r){m["1"]="tip"}EmoticonsMy.renderDeferred.resolve(m)})},reloadEverything:function(){if(EmoticonsMy.singleAjaxPromise){EmoticonsMy.singleAjaxPromise.abort();EmoticonsMy.singleAjaxPromise=null}if(EmoticonsMy.fullAjaxPromise){EmoticonsMy.fullAjaxPromise.abort();EmoticonsMy.fullAjaxPromise=null}if(EmoticonsMy.renderDeferred.state()==="pending"){EmoticonsMy.renderDeferred.reject()}else{if(EmoticonsMy.renderDeferred.state()==="resolved"){EmoticonsMy.renderDeferred.done(function(a){for(var b in a){var c=a[b];if(typeof(c)==="object"){c.off();jQuery("li",c).removeData()}}})}}if(EmoticonsMy.groupsMetaDeferred.state()==="pending"){EmoticonsMy.groupsMetaDeferred.reject()}jQuery(".emo_my_tab",Emoticons._$emoSelecter).remove();Emoticons.checkTabsArrows();EmoticonsMy._initLoad();EmoticonsMy.loadTabs(jQuery("#emoticons_tabs ul",Emoticons._$emoSelecter)[0]);EmoticonsMy._reSelectTab(1)},reloadSingle:function(a){if(EmoticonsMy.fullAjaxPromise||EmoticonsMy.renderDeferred.state()==="pending"||EmoticonsMy.groupsMetaDeferred.state()==="pending"){return}if(EmoticonsMy.singleAjaxPromise){EmoticonsMy.reloadEverything();return}EmoticonsMy.singleAjaxPromise=jQuery.ajax("/EmoticonManager/getUESingleGroup",{data:{token:top.SiteState.getToken(),group_id:a},type:"POST",dataType:"json"});jQuery.when(EmoticonsMy.singleAjaxPromise,EmoticonsMy.groupsMetaDeferred,EmoticonsMy.renderDeferred).done(function(f,e,c){var d=f[0];var b=e[0];EmoticonsMy.singleAjaxPromise=null;c[a.toString()]=EmoticonsMy._renderPartsByPremAndGroup(EmoticonsMy._adaptEmos(d.e),a.toString());EmoticonsMy.renderDeferred=jQuery.Deferred();EmoticonsMy.renderDeferred.resolve(c);if(a!==1){if(b[a.toString()]!==d.g){b[a.toString()]=d.g;jQuery(".emo_my_tab",Emoticons._$emoSelecter).each(function(g,h){if(jQuery(h).data("group")===a.toString()){jQuery("img",h).attr("src",d.g||"//s.plurk.com/13151d0dcee088b8f5991aaee4f57532.png")}});EmoticonsMy.groupsMetaDeferred=jQuery.Deferred();EmoticonsMy.groupsMetaDeferred.resolve(b,e[1])}}EmoticonsMy._reSelectTab(a)})},_reSelectTab:function(a){if(jQuery(".emoticons_my",Emoticons._$emoSelecter).length>0){jQuery("#emoticon_child_container",Emoticons._$emoSelecter).removeClass("emoticons_my");Emoticons.selectEmoTab(jQuery("#emo_my",Emoticons._$emoSelecter)[0],"my_"+a)}},_renderPartsByPremAndGroup:function(c,a){var b;if(top.SiteState.getSessionUser().premium){b=Emoticons._renderEmoticonPagesContainer(c)}else{if(a=="1"){b=Emoticons._renderEmoticonPagesContainer(c,60)}else{b=Emoticons._renderEmoticonPagesContainer(c,0)}}b.addClass("emoticons_my");return b},_adaptEmos:function(a){return jQuery.map(a,function(b){if(b.keyword){return[[null,b.url,"["+b.keyword+"]",b]]}else{return[[null,b.url,b.url,b]]}})}};jQuery(document).ready(function(){if(GLOBAL.session_user){EmoticonsMy._initLoad()}});MaxChar={init:function(a,b,c){jQuery(a).on("input",function(){MaxChar.updateCharCount(a,b,c)})},re_all_urls:/https?:\/\/[^\s]*/g,re_tw_fb:/\s*!(FB|TW|YA|WB)\s*/g,calculateContentLength:function(a,e){a=AJS.strip(a);if(!e&&window.main_poster&&main_poster.menu){e=main_poster.menu.cur_lang}var c=Qualifiers.getFirstWQual(a,e)||"";a=AJS.strip(a.substr(c.length));a=a.replace(this.re_tw_fb,"");var b=0;var d=function(f){if(f.length>30){b+=30}else{b+=f.length}return""};a=a.replace(this.re_all_urls,d);return a.length+b},updateBig:function(){MaxChar.updateCharCount(AJS.$("input_big"),AJS.$("input_big_cu"))},updateCharCount:function(b,c,g,e){var b=AJS.$(b);var d=(210-MaxChar.calculateContentLength(b.value,g));if(d>=0){var a="";if(d<=50){a=format(_("%s characters left"),d)+". "}if(b.id=="input_small"){a+=_("Press Enter to add")}b.style.color="black";AJS.setHTML(c,a);AJS.removeClass(c,"char_highlight")}else{AJS.addClass(c,"char_highlight");AJS.setHTML(c,format(_('Too many characters. Try <a onclick="%s" href="http://paste.plurk.com" target="_blank">Plurk Paste</a> or remove %s of them.'),"return Misc.showPaste('"+b.id+"')",Math.abs(d)));b.style.color="red"}if(d<=50&&d>=0){AJS.addClass(c,"highlight_light")}else{AJS.removeClass(c,"highlight_light")}var f=b.scrollTop;if(f!=0){PlurkBoxExpand.init(b)}}};PlurkBoxExpand={init:function(d,e){var b=d,a=d.offsetWidth;if(e){b.className="content"}else{if(AJS.isIe()&&!d.style.width){if(a){b.style.width=a-6+"px"}}b.className="multi-line"}}};PlurkAdder={typing_responses:{},addTypingResponse:function(c,a){if(!PlurkAdder.typing_responses[c]){PlurkAdder.typing_responses[c]={}}for(var b in a){PlurkAdder.typing_responses[c][b]=a[b]}},clearTypingResponse:function(a){delete PlurkAdder.typing_responses[a]},addPlurk:function(j){var h=jQuery.Deferred();if(!j||!j.content){return h.reject({msg:"no content"}).promise()}var a=j.lang||"en";var f=j.qualifier||":";var e=j.content;var b=Qualifiers.transformContentQualifer(f,e,a);f=b[0];e=b[1];var c={lang:a,qualifier:f,content:e,no_comments:j.no_comments||0,replurkable:j.replurkable,uid:SiteState.getSessionUser().id};var d="/TimeLine/addPlurk";var g={post:function(){jQuery.post(d,c).done(function(m){var l=m.plurk;l.posted=new Date(l.posted);if(top.SiteState.canEdit()){if(TimeLine){TimeLine.addPlurks([l]);TimeLineCache.addPlurk(l)}PlurkAdder._incCount(jQuery("#plurks_count"))}h.resolve(m)}).fail(function(o,p){var n=o.responseText;var m=null;if(n=="not-logged-in"){alert(_("It seems that your login session has expired. Please login again"));var l="/login?r=/?status="+encodeURIComponent(e);window.location=l;return}else{if(n=="Must be friends"){TopBar.update_friends=true;TopBar._updateFriends();m=_("You can only send private plurks to friends")}else{if(n&&n.indexOf("anti-")==-1&&n.indexOf("anon-")==-1){m=_("Could not plurk. Try again in a minute")}}}if(o.status==400){m=PlurkAdder._antiSpanMsgs(n)}if(!m){m=_("An unknown error happened.")}h.reject({msg:m,status:o.status})})}};if(j.to_user_id){d="/Users/sendPrivatePlurk";c.to_user_id=j.to_user_id;(new PopWindow({url:"/VisualCaptcha/showCaptcha",width:500,height:500,onClose:function(){if(top.VISUAL_CAPTCHA_OK){window.captcha_checked=true;g.post()}else{h.reject()}}})).show()}else{if(j.limited_to){c.limited_to=JSON.stringify(j.limited_to)}g.post()}PlurkAdder.new_plurk_data=c;return h.promise()},_antiSpanMsgs:function(c){if(c=="anti-flood-same-content"){return _("Woaaa, could not plurk due to anti flood rules.\nIt seems you have plurked this a few minutes ago.")}else{if(c=="anti-flood-too-many-new"){return _("Woaaa, could not plurk due to anti flood rules.\nYou have plurked too many plurks the past few minutes.\nChill down and come back in 10 minutes time.")}else{if(c=="anti-flood-too-many-still"){return _("Your plurking is disabled.\nYou have plurked too much, chill down and come back in 10 minutes time.")}else{if(c=="blocked-ip"){var b=confirm(_("Your IP is blocked due to security concerns. You must unblock it using our website."));if(b){window.location="/AntiSpam/showIPBlocked"}}else{if(c=="anon-plurk-public-only"){return _("Only public plurks can be anonymously")}else{if(c=="anon-plurk-not-eligible"){return _("You're not eligible to post anonymous plurks. Try later when you have more friends.")}else{if(c=="anon-plurk-exceed-day-limit"){var a=1;return format(_("You have reached your daily anonymous plurks limit (max. %d)"),a)}else{if(c=="anon-plurk-no-comments"){return _("You can not disable comments on anonymous plurk")}else{if(c=="anti-flood-bot-response-disabled"){return _("You can not post response to this plurk")}else{if(c=="anti-flood-only-friend-can-respond"){alert(_("You can not post response to this plurk"))}else{c=c.replace("anti-flood-spam-domain",_("Your Plurk seems to contain spam. If this is not the case, please contact us on support@plurk.com"));return AJS.trimIfNeeded(c,100)}}}}}}}}}}},plurkRespAdd:function(a,f,g){var j=new jQuery.Deferred();if(!a||!a.owner_id||!a.plurk_id){return j.reject({msg:_("Unknown error happened"),status:-1}).promise()}if(!f||f.length==0){return j.reject({msg:"no content"}).promise()}var b=a.lang||"en";var h=MaxChar.calculateContentLength(f,b);if(h>210){var c=_("Content is too long. Remove %s characters.").replace("%s",h-210);return j.reject({msg:c}).promise()}g=g||":";var d=Qualifiers.transformContentQualifer(g,f,b);g=d[0];f=d[1];f=PlurkAdder.resolveNickNames(f);var e={qualifier:g,content:f,p_uid:a.owner_id,plurk_id:a.plurk_id,replurker_id:a.replurker_id,lang:b,uid:SiteState.getSessionUser().id,js_date:false};j.notifyWith(_("Plurking response..."),["ajaxing"]);PlurkAdder.posting=true;jQuery.post("/Responses/add",e).done(function(l){if(window.Poll){Poll.last_ts=parseInt(l.last_ts)}if(top.SiteState.canEdit()){PlurkAdder._incCount(AJS.$("response_count"))}if(window.Responses){Responses.addToList(l.object)}if(window.Plurk){Plurk.markAsResponded(a)}if(window.TimeLineCache){TimeLineCache.addToCache("responded",a)}Signals.sendSignal("response_added",a,l.object);j.resolve(l)}).fail(function(n,o){if(n.responseText=="not-logged-in"){alert(_("It seems that your login session has expired. Please login again"));window.location="/login";return}var l={400:PlurkAdder._antiSpanMsgs(n.responseText),404:_("This plurk seems to be deleted."),403:_("You don't have permission for this.")};var m=l[n.status]?l[n.status]:_("An unknown error happened.");j.reject({msg:m,status:n.status})}).always(function(){PlurkAdder.posting=false});return j.promise()},removePlurkByCnt:function(a){var c=AJS.map(TimeLine.plurks,function(d){if(d.content.indexOf(a)!=-1){return c}});var b=AJS.getRequest("/TimeLine/removePlurk");b.sendReq({plurk_id:c})},saveUserValue:function(a,c){var b=AJS.getRequest("/Users/updateUserValue");SiteState.getSessionUser()[a]=c;b.sendReq({name:a,value:c})},fetchUsersIfNeeded:function(a,d,b){if(!Array.isArray(a)){return}var c=[];a.forEach(function(e){if(!SiteState.getUserById(e)){c.push(e)}});if(c.length==0){d()}else{PlurkAdder.fetchUsers(c,d,b)}},fetchUsers:function(a,e,c){var b=AJS.loadJSON("/Users/fetchFriends");b.addCallback(function(d){AJS.update(USERS,d);e()});var f={ids:AJS.serializeJSON(a)};if(c){f.r=c}b.sendReq(f)},resolveNickNames:function(b){if(!window.Plurks){return b}var c=Plurks.cur_plurkers;if(!c||c.length==0){return b}var a=b.match(/\B@([^\s:@]{1,})/g);if(a){AJS.map(a,function(d){var g=d.split("@")[1].toLowerCase();var f=[];AJS.map(c,function(n){var o="";if(n.display_name){o=n.display_name.toLowerCase()}var h=n.nick_name.toLowerCase();var m=function(p){return p.indexOf(g)};var l=m(o)!=-1||m(h)!=-1;if(l){var j=m(o);if(j==-1){j=m(h)}f.push([j,g,n.nick_name,o])}});if(f.length>0){var e=f[0];AJS.map(f,function(h){if(h[1]==h[3]||h[1]==h[2]){e=h;return}if(h[0]<e[0]){e=h}});b=b.replace(new RegExp("@"+e[1],"gi"),"@"+e[2])}})}return b},getAutoCompleteIds:function(c){var b=AJS.$bytc("li","person",AJS.$(c));if(b.length==0){return null}var a=[];AJS.map(b,function(g){var f=g.nick_name;if(f=="CLIQUE"){var h=PlurkAdder._getCliqueByName(g.full_name);if(h){var e=PlurkAdder._getCliqueFriends(h);AJS.map(e,function(j){a.push(j)})}}else{var d=SiteState.getUserByNick(f);if(!d){throw"must-be-friends"}else{a.push(SiteState.getUserByNick(f).uid)}}});return a},_getLimitedTo:function(){var d=AJS.$("input_everybody");var e=AJS.$("input_only");var b=AJS.$("input_friends");if(!d||d.checked){return null}var a=[];a.push(SiteState.getSessionUser().uid);if(e.checked){var c=PlurkAdder.getAutoCompleteIds("auto_ta_holder");if(!c){return null}else{AJS.map(c,function(f){if(SiteState.getUserById(f)||COMPLETION[f]){a.push(f)}})}}else{if(b.checked){a="only-friends"}}return a},_getCliqueByName:function(b){var a=CLIQUES_DEFAULT_TRANS.indexOf(b);if(a>-1){b=CLIQUES_DEFAULT[a]}return AJS.map(CLIQUES,function(c){if(c.name==b){return c}})},_getCliqueFriends:function(a){var b=[];AJS.map(a.friends.replace(/\|\|/g,"|").split(/\|/),function(c){if(c!=""){b.push(parseInt(c))}});return b},_incCount:function(a){if(a){AJS.setHTML(a,parseInt(a.innerHTML)+1)}}};(function(a){PrivateOptions=function(c,b){this.popview=null;this.plurkTo=c;this.firsttimeCallback=undefined;this.onSubmitClick=function(){};this.expectedCompletionUIDs=b||[]};PrivateOptions.prototype={htmlTmpl:'<form class="more_options_holder" onsubmit="return false;"><div class="holder"><div class="header">'+_("Who can see this plurk?")+'</div><div class="content"><div class="item"><input type="radio" name="plurkto" class="radios" value="everybody" tabindex="-1" checked="checked"><span class="span_everybody">'+_("the whole world")+'</span><span class="span_everybody_private">'+_("(but your timeline is currently viewable to your friends only)")+'</span></div><div class="item" class="self_holder"><input type="radio" name="plurkto" class="radios" value="self" tabindex="-1">'+_("only my friends")+'</div><div class="item" class="only_holder"><table><tbody><tr><td class="td_radio"><input type="radio" name="plurkto" class="radios" value="only" tabindex="-1">'+_("only")+'</td><td class="td_ta"><span class="small">'+_("Type the name of the friend or clique")+'</span></td></tr></tbody></table></div></div></div><div class="holder" style="margin-left:16px;"><div class="header">'+_("Other options")+'</div><div class="content" style="padding-right:10px;"><div class="item"><input type="checkbox" name="no_comment" value="only_friends">'+_("Only friends can comment")+'</div><div class="item"><input type="checkbox" name="no_comment" value="no_cmt">'+_("Disable comments")+'<!--premium--></div></div></div><button class="submit">'+_("Save and reload")+"</button></form>",PR_WHOLE_WORLD:0,PR_FRI_FRI:1,PR_ONLY_FRIENDS:2,_getStrPrivacy:function(b){b=b||GLOBAL.page_user.timeline_privacy;if(b==this.PR_WHOLE_WORLD){return _("the whole world")}if(b==this.PR_ONLY_FRIENDS){return _("only my friends")}},changePrivacy:function(){if(SiteState.canEdit()){this.$holder.find(".span_everybody_private").css("display",GLOBAL.page_user.timeline_privacy==this.PR_ONLY_FRIENDS?"block":"none")}},toggleFrom:function(b){var c=this;if(!c.popview){c.$holder=a('<div class="more_options_holder">');c.$holder.append('<img src="/static/indicator_mini.gif" />');c.popview=new PopView({content:c.$holder[0],offset:2,align:"left",arrowAlign:"left",onresize:true,closest:"#smartInputFloater"});c.popview.showFrom(b);c.fetchCompletion();return}c.popview.toggleFrom(b)},initOptionsView:function(){var f=this;var h;var b=top.SiteState.getSessionUser();if(b.premium&&b.timeline_privacy==0){h=f.$holder=a(Handlebars.compile(f.htmlTmpl.replace("<!--premium-->",'<div class="item"><input type="checkbox" name="replurkable" value="no_replurk">'+_("Disable replurk")+"</div>"))())}else{h=f.$holder=a(Handlebars.compile(f.htmlTmpl)())}var g=createListHolder("auto_ta_holder","auto_ta_input");var d=g[0];var c=f.input=g[1];h.find(".td_ta").prepend(d);h.find("input[name=plurkto]").change(function(){var j=a(this).val();if(j=="only"){a(c).focus()}if(j=="everybody"){h.find("input[name=replurkable]").prop("checked",false).prop("disabled",false)}else{h.find("input[name=replurkable]").prop("checked",true).prop("disabled",true)}f.updatePlurkTo()});h.find("input[name=no_comment]").change(function(){if(a(this).prop("checked")){h.find("input[name=no_comment]").prop("checked",false);a(this).prop("checked",true)}f.updatePlurkTo()});c.onadd=function(){h.find("input[name=plurkto][value=only]").prop("checked",true);f.updatePlurkTo()};h.find("button.submit").click(function(){f.onSubmitClick()});f.popview.options({content:h[0]});var e=18;h.find(".holder").each(function(){e+=jQuery(this).width()});h.width(e);f.changePrivacy();f.reset();if(f.firsttimeCallback){f.firsttimeCallback();f.firsttimeCallback=undefined}a(c).focus()},fetchCompletion:function(){var c=this;if(c.fetching){return}c.fetching=true;var d=jQuery.Deferred();var b=jQuery.Deferred();a.when(d.promise(),b.promise()).done(function(){c.fetching=false;AmiComplete.init();buildFriendCollection(null,true);c.initOptionsView()});if(top.CLIQUES){d.resolve()}else{a.ajax({url:"/Cliques/get",dataType:"json"}).done(function(e){CLIQUES=e;d.resolve()})}if(top.COMPLETION){b.resolve()}else{a.post("/Users/getCompletion",{user_id:SiteState.getSessionUser().id},function(f){var e=Object.keys(f).map(function(h){return parseInt(h)});var g=[];c.expectedCompletionUIDs.forEach(function(h){if(e.indexOf(h)===-1&&h!==SiteState.getSessionUser().id){g.push(h)}});if(g.length>0){a.post("/Users/getAuxCompletion",{user_ids:g.join(",")},function(h){COMPLETION=f;a.extend(COMPLETION,h);b.resolve()},"json")}else{COMPLETION=f;b.resolve()}},"json")}},reset:function(){var f=this;if(!f.$holder){return}f.$holder.find(".auto_ta li.person").remove();if(f.$holder.find(".persistent_token").length==0){var c=SiteState.getSessionUser().nick_name;var b=new RegExp("^(.+) <"+c+">$","i");for(var e=0;e<collection.length;e++){var g=collection[e];var d=g.match(b);if(d){f.$holder.find("#auto_ta_holder ul").prepend(AmiComplete.createItem(d[1],c,true));break}}}f.input.onadd();f.$holder.find("input[name=plurkto][value=everybody]").prop("checked",true);f.$holder.find("input[name=no_comment]").prop("checked",false);f.$holder.find("input[name=replurkable]").prop("checked",false);f.updatePlurkTo()},updatePlurkTo:function(){if(!this.plurkTo){return}var d=a(this.plurkTo);var c="";var e=this.getLimitedTo();if(e==null){d.removeClass("private_to")}else{if(e=="only-friends"){c='<i class="pif-privacy"></i>'+_("this plurk will be viewable to")+" <b>"+this._getStrPrivacy(this.PR_ONLY_FRIENDS)+"</b>";d.addClass("private_to")}else{if(e.length){c='<i class="pif-privacy"></i>'+format(_("private plurk to %s plurkers"),"<b>"+e.length+"</b>");d.addClass("private_to")}else{d.removeClass("private_to")}}}var b=this.getNoComment();if(b==1){c+=(c.length?"<br />":"")+'<i class="pif-privacy"></i>'+_("Disable comments")}else{if(b==2){c+=(c.length?"<br />":"")+'<i class="pif-privacy"></i>'+_("Only friends can comment")}}d.html(c)},getLimitedTo:function(){if(!this.$holder){return null}var e=this;var g=e.$holder.find("input[name=plurkto]:checked").val();if(g=="self"){return"only-friends"}else{if(g=="only"){var d=function(j){var h=CLIQUES_DEFAULT_TRANS.indexOf(j);if(h>-1){j=CLIQUES_DEFAULT[h]}return a.grep(CLIQUES,function(l){return l.name==j})[0]};var c=function(h){var j=[];a.each(h.friends.replace(/\|\|/g,"|").split(/\|/),function(m,l){if(l!=""){j.push(parseInt(l))}});return j};var b=[];var f=e.$holder.find(".auto_ta li.person");a.each(f,function(l,m){if(m.nick_name=="CLIQUE"){var n=d(m.full_name);if(n){var h=c(n);a.each(h,function(o,p){if(SiteState.getUserById(p)||COMPLETION[p]){b.push(p)}})}}else{var j=SiteState.getUserByNick(m.nick_name);if(j){b.push(j.id)}}});return a.unique(b)}else{return null}}},getNoComment:function(){if(!this.$holder){return 0}var b=this.$holder.find("input[name=no_comment]:checked").val();if(b=="only_friends"){return 2}else{if(b=="no_cmt"){return 1}else{return 0}}},getReplurkable:function(){if(!this.$holder){return 1}var b=this.$holder.find("input[name=replurkable]:checked").val();if(b=="no_replurk"){return 0}else{return 1}}}})(jQuery);TimeShow={time:null,$div:null,on_plurk:null,cur_elm:null,init:function(){if(TimeShow.$div){return}TimeShow.$div=jQuery("<div id='time_show' class='morning'><span></span></div>").css({top:jQuery("#bottom_line").offset().top+1-42}).appendTo("#layout_content");TimeShow.time=TimeShow.$div.find("span").get(0)},hide:function(){if(!TimeShow.cur_elm){return}TimeShow.on_plurk=null;TimeShow.cur_elm=null;TimeShow.$div.removeClass("show")},displayTime:function(c){TimeShow.on_plurk=c||null;if(!TimeShow.on_plurk||!getPD(TimeShow.on_plurk)){TimeShow.hide();return}if(TimeShow.cur_elm==TimeShow.on_plurk){return}var b=new Date(getPD(TimeShow.on_plurk).obj.posted);b=Cal.convertToLocal(b,true);var a=Cal.formatMonthDate(b)+" "+Cal.formatHour(b.getHours(),b.getMinutes());if(a!=TimeShow.time.innerHTML){TimeShow.time.innerHTML=a}$timelineHolder=jQuery("#timeline_holder");TimeShow.$div.css({left:jQuery(TimeShow.on_plurk).offset().left,top:$timelineHolder.offset().top+$timelineHolder.height()}).addClass("show");TimeShow.cur_elm=TimeShow.on_plurk}};KeyManager={cur_sequence:"",init:function(){if(jQuery("body").hasClass("timeline")||jQuery("#timeline_holder").length){jQuery(document).keydown(KeyManager.onKeyDown)}},onKeyDown:function(c){var h=c.target;var b=c.which;try{if(KeyManager.cur_sequence.length>100){KeyManager.cur_sequence=""}KeyManager.cur_sequence+=b+",";if(KeyManager.cur_sequence.indexOf("38,38,40,40,37,39,37,39,66,65,")!=-1){KeyManager.cur_sequence="";KeyManager.konamicode()}if(KeyManager.cur_sequence.indexOf("38,38,40,40,37,37,39,39,65,66,")!=-1){KeyManager.cur_sequence="";KeyManager.gometro()}if(KeyManager.cur_sequence.indexOf("83,80,73,68,69,82,")!=-1){KeyManager.cur_sequence="";if(!jQuery("#input_big").is(":focus")&&!jQuery("#input_small").is(":focus")){TimeLine.showSpider()}}}catch(f){}if(c.charCode&&c.charCode==39){b=null}if(b==27){top.Plurks.removeCurrentOpen();if(Emoticons.shown){Emoticons.forceHide()}}var a=AJS.isIn(AJS.getNodeName(h),["input","textarea"]);if(!a||(a&&h.value==""&&b!=65&&b!=68)){var d=(b==37||b==65)?40:-40;switch(b){case 39:case 68:TimeShow.displayTime(null);TimeLine.slideBack(10,d,"right");top.Plurks.removeCurrentOpen();break;case 37:case 65:TimeShow.displayTime(null);TimeLine.slideBack(10,d,"left");top.Plurks.removeCurrentOpen();break;case 38:TimeShow.displayTime(null);TimeLine.moveToBlock("front");break}}if(!a){var g=Poll.mode;if(b==118||b==86){if(g=="new"){Poll._viewAll()}else{if(AJS.keys(Poll.current_data.unread_plurks).length>0){Poll._renderPlurks()}}}if(g=="new"&&(b==109||b==77)){Poll.markAllRead()}if(g!="new"&&(b==117||b==85)&&AJS.keys(Poll.current_data.new_plurks).length>0){Poll.update()}}}};KeyManager.konamicode=function(){var g=0,d=0.1,n=0.05,c=0.25,m=0.24,a=1.6,l=0.24,p=150,j=150,o=150,h=150;var f=AJS.$bytc("div","plurk");var b=f.length;function e(){var q=0;for(i=0;i-b;i++){var r=f[i].style;if(!AJS.$(f[i].id)){q++}r.position="absolute";r.left=(Math.sin(g*d+i*c+a)*p+o)+"px";r.top=(Math.cos(g*n+i*m+l)*j+h)+"px"}g++;if(q!=b){setTimeout(e,60)}}setTimeout(e,60)};KeyManager.gometro=function(){var a=Math.floor(Math.random()*19+1);jQuery("body").addClass("metro"+a);jQuery("<link rel='stylesheet' type='text/css'>").attr("href","//s.plurk.com/4f4ad86c8df617d0064d5b676c6d19a7.css").appendTo("head");jQuery("link[rel=stylesheet]").each(function(){$link=$(this);if($link.attr("href").indexOf("/Users/getCustomCss")>-1){$link.remove()}})};Plurk={friends_only:"|0|",isPrivate:function(a){return a.plurk_type==1||a.plurk_type==3},isResponded:function(a){return a.plurk_type==2||a.plurk_type==3||a.plurk_type==6},isAnonymous:function(a){return a.plurk_type==4||a.plurk_type==6},isPorn:function(a){return a.porn},isExpanded:function(a){if($dp.holder_shown){if(getPD($dp.current_div).obj.plurk_id==a){return true}}return false},updatePlurk:function(a,b){if(!a){return}AJS.update(a,b);if(Poll._backup_plurks){var c=Plurk.getById(a.id,AJS.values(Poll._backup_plurks));if(c){AJS.update(c,b)}}},getById:function(d,b,c){c=c||"id";b=b||TimeLine.plurks;if(b){var a=AJS.map(b,function(e){if(e[c]==d){return e}});return a||null}return null},markAsResponded:function(a){if(Plurk.isAnonymous(a)){a.plurk_type=6}else{if(Plurk.isPrivate(a)){a.plurk_type=3}else{a.plurk_type=2}}}};Responses={cur_plurkers:[],addToList:function(g){var b=AJS.$("m"+g.id);if(b){return}var f=AJS.$bytc("div","empty",$dp.list);if(f){AJS.removeElement(f[0])}if(AJS.isString(g.posted)){g.posted=new Date(g.posted)}g.posted=Cal.convertToLocal(g.posted);var a=getPD($dp.current_div);if(!a||!a.obj||!a.obj.id||(a.obj.id!=g.plurk_id)){return}var c=Plurks.renderPlurk(g,true);if(!c){return}AJS.removeClass(c,"display");AJS.ACN($dp.list,c);AJS.fx.highlight(getPD(c).cnt,{duration:2000});AJS.setHTML(AJS.$("input_small_cu"),_("140 characters left").replace("140","210"));var e=null;if(SiteState.getSessionUser()){e=SiteState.getSessionUser().id}if((g.user_id==e)||g.my_anonymous){Plurks.focusTrick(c)}else{Plurks.showNewResponse(c)}var d=AJS.$bytc("div","plurk",$dp.list).length;Plurk.updatePlurk(a.obj,{response_count:d,responses_seen:d});a.obj.response_count=d;a.obj.responses_seen=d;Responses._updateNewRespCount(a);AJS.setHTML(a.response_count,d);AJS.showElement(a.response_count);var h=SiteState.getUserById(g.user_id);if(h){Plurks.cur_plurkers.push(h)}ResponseCache.addToCache(g.plurk_id,g)},fetchItems:function(b){var h=$dp.current_div;var e=getPD(h).obj;var g=e.plurk_id;var d=SiteState.getSessionUser();var c=Plurks.cur_req=AJS.loadJSON("/Responses/get2");c.addCallback(function(n){ResponseCache.addToCache(g,n.responses);n.responses=ResponseCache.getFromCache(g);var j=getPD(h);if(n.friends){AJS.update(USERS,n.friends);Plurks.cur_plurkers=AJS.values(n.friends);Plurks.cur_plurkers.push(SiteState.getUserById(j.obj.owner_id))}var l=j.obj;var m=n.responses;if(n.responses_seen!=-1){l.responses_seen=n.responses_seen}if(n.response_count){l.response_count=n.response_count}var o=[];AJS.map(m,function(p){o.push(p.user_id)});PlurkAdder.fetchUsersIfNeeded(o,AJS.$p(Responses._renderList,b,m),"rfi")});c.addErrback(function(l,j){AJS.removeElement(AJS.$gc($dp.list,"div"));if(j.status==404){AJS.RCN($dp.list,AJS.DIV({c:"empty",s:"color: red"},_("This plurk seems to be deleted.")))}else{AJS.RCN($dp.list,AJS.DIV({c:"empty",s:"color: red"},_("An unknown error happened.")))}Plurks.poster.input.disabled=true});var a=0;var f=ResponseCache.getFromCache(g);if(f){a=f.length}c.sendReq({plurk_id:g,from_response:a})},_renderList:function(v,p){var H=Plurks;var C=$dp.list;var s=$dp.current_div;if(!s){return}var x=jQuery(v);var a=jQuery('<div class="list">')[0];var E=getPD(s);var D=E.obj;AJS.map(p,function(e){if(AJS.isString(e.posted)){e.posted=new Date(e.posted)}e.posted=Cal.convertToLocal(e.posted)});var A=D.responses_seen;var F=D.response_count=p.length;var g,y;var I={};AJS.map(p,function(e,K){if(I[e.id]){return}var J=Plurks.renderPlurk(e,true);if(!J){return}AJS.removeClass(J,"display");AJS.ACN(a,J);if(K==A){g=J}y=J;I[e.id]=true});var l=E.response_count;AJS.removeClass(s,"new");Responses._updateNewRespCount(D);jQuery(C).remove();jQuery(a).insertAfter(x.find(".replurk_count"));$dp.list=a;if(p.length==0&&!D.no_comments){AJS.ACN(a,AJS.DIV({c:"empty"},_("No responses - be the first :)")))}else{AJS.setHTML(l,p.length);AJS.showElement(l);D.response_count=D.responses_seen=p.length;if(y&&A){setTimeout(AJS.$p(Plurks.focusTrick,y,AJS.ACN),500)}if(g&&F!=A){setTimeout(function(){Plurks.focusTrick(g,AJS.ACN);AJS.fx.highlight(getPD(g).cnt,{duration:2000})},500)}}var b=x.find("div.list");var o=x.find("#resp_banner_ads");var n=jQuery(window).innerHeight();var z=140;var m=400;var r=60;var j=b.innerHeight();var f=b[0].scrollHeight;if(f==z){f=0;b.children("div.plurk").each(function(){f+=jQuery(this).outerHeight()});if(f==0){f=z}}if(f!=z){f+=20}var h=x.outerHeight()-j;var u=(o.length>0&&n>550)?r:0;var d=x.offset().top+h+f+u-n;var w;if(d<0){w=f;if(w<z){w-=d;if(w>z){w=z}}}else{w=f-d;if(w<r*1.75){w=f<m?f:m;u=0}}if(w){b.height(w)}try{var G=OpenX}catch(B){console.error(B);window.OpenX=undefined}if(u>0&&OpenX){var t=jQuery(s).data("pid");var q=function(){clearInterval(c);_gaq_push(["_trackEvent","ads","adblocker","respondo_possible"]);if(Responses.showedSadRoguso){return}else{Responses.showedSadRoguso=true;o.addClass("show");var e=jQuery("<div>&nbsp;&shy;&nbsp;</div>");e.addClass("adsbox");o.append(e);setTimeout(function(){if(e.height()===0){_gaq_push(["_trackEvent","ads","adblocker","respondo_shown"]);var J=jQuery("<div></div>");J.css({position:"relative",left:"-4px",width:"468px",height:"60px",backgroundImage:"url(//s.plurk.com/83e3f5f0f3209fc91fc026311265b0fe.png)",backgroundSize:"468px 60px"});e.remove();o.append(J)}else{e.remove();o.removeClass("show")}},100)}};o.data("abcb",q);OpenX.insertAds(o,t,Plurk.isPorn(D));var c=setInterval(function(){if(o.html().length>0){clearInterval(c);o.addClass("show")}},300)}try{Plurks.poster.input.disabled=false;if(jQuery(Plurks.poster.input).offset().top<n){Plurks.poster.input.focus();Plurks.poster.input.focus()}}catch(B){console.error("response focus: ",B)}},_updateNewRespCount:function(a){if(Plurks.poster){Poll.setPlurkRead(a.id,a.response_count)}},_renderLimitedTo:function(e,a,c,d){AJS.RCN(e,_("private plurk to")," ");var b=false;if(d.length==2&&d[0]==d[1]){d=[d[0]]}AJS.map(d,function(n,h){if(n==a.owner_id&&d.length!=1){return}var f=SiteState.getUserById(n);var m=SiteState.getSessionUser();if(parseInt(n)==m.uid){f=m}if(f){var l=AJS.A({href:f.nick_name,c:"name","data-uid":n},f.display_name||f.nick_name);var j=AJS.SPAN(l," ");if(b){AJS.hideElement(j)}AJS.ACN(e,j)}if(h==6&&c.length>7){var g;AJS.ACN(e,AJS.SPAN(Responses._moreUsers(c.length-d.length)));b=true}})},_moreUsers:function(a){if(a<10){return _("and some other plurkers")}else{if(a<20){return _("and over 10 other plurkers")}else{if(a<50){return _("and over 30 other plurkers")}}}return _("and over 50 other plurkers")},showLoading:function(c){if(c){var a=$dp.cur_loading=AJS.DIV({c:"loading"},AJS.IMG({src:"//s.plurk.com/37d72576e5db79da64d0bc318c3eef73.gif"}));var b=c.parentNode;AJS.setTop(a,b.offsetTop);AJS.setWidth(a,b.offsetWidth);AJS.RCN(c,a)}},deleteResponse:function(d,b){if(!confirm(_("Are you sure you want to delete this response?"))){return false}var a=getPD(d).obj;var c=AJS.getRequest("/Responses/deleteResponse");c.addCallback(function(){AJS.removeElement(d);Responses._responseMouseOut();ResponseCache.removeFromCache(a);var e=Plurk.getById(a.plurk_id);if(e){e.response_count--;var f=AJS.$("p"+e.plurk_id);AJS.setHTML(getPD(f).response_count,""+e.response_count)}});c.addErrback(function(f,e){if(f=="not-deleted"){alert(_("You can not delete this response"));return}});c.sendReq({id:a.id,plurk_id:a.plurk_id})},editResponse:function(h,d){var b=jQuery(h);var f=b.find(".td_cnt");var c=getPD(h).obj;var a=Plurk.getById(c.plurk_id);var g=c.content_raw;var e=new PlurkEditor(f,g,3);e.onSave=function(o){var j=jQuery.Deferred();var l=MaxChar.calculateContentLength(o,a.lang);if(l>210){var m=l-210;var n=format(_("Content is too long. Remove %s characters."),m);alert(n);j.reject("maxlen")}jQuery.ajax("/Responses/edit",{data:{plurk_id:a.id,response_id:c.id,content_raw:o},type:"POST",dataType:"json"}).done(function(p){if("content" in p){f.find(".text_holder").html(Utils.protocolRelative(p.content));Media.attach(f.find(".text_holder")[0],a.id);c.content=p.content;c.content_raw=p.content_raw;c.last_edited=p.last_edited;c.editability=p.editability;j.resolve()}else{j.reject()}});return j};e.onBeforeShow=function(){b.addClass("editing")};e.onAfterShow=function(){setTimeout(function(){var l=b.closest(".response_box");var j=b.position().top+b.height()-l.innerHeight();if(l.scrollTop()<j){l.scrollTop(j)}},1)};e.onAfterHide=function(){b.removeClass("editing")};e.show()},mouseTO:null,responseMouseOver:function(b){if(Responses.mouseTO){clearTimeout(Responses.mouseTO);Responses._responseMouseOut()}if(jQuery(b).hasClass("editing")){return false}var e=getPD(b).obj;var d=Plurk.getById(e.plurk_id);var f=e.posted;var g="@ "+Cal.formatMonthDate(f)+" - "+Cal.formatTime(f.getHours(),f.getMinutes());var h,p,c=null;var a=null;if(SiteState.getSessionUser()){a=SiteState.getSessionUser().id}var o=(e.user_id==a)||e.my_anonymous;var j=d.owner_id==a||d.my_anonymous;if(o||j){h=AJS.A({c:"resp_icon del_icon pif-cancel",title:_("delete this response")},_("delete"));AJS.AEV(h,"click",AJS.$p(Responses.deleteResponse,b,h))}if(e.editability===1){p=AJS.A({c:"resp_icon edit_icon pif-edit",title:_("edit this response")},_("edit"));AJS.AEV(p,"click",AJS.$p(function(r,q){AJS.removeElement(AJS.$bytc("div","response_time"));Responses.editResponse(r,q)},b,p))}else{if(e.editability===2){p=AJS.A({c:"resp_icon edit_icon disabled pif-edit",title:_("this response can't be edited because it contains a random emoticon")},_("edit"))}}if(!o){c=AJS.A({c:"reply_to pif-message",title:_("reply to this person")},_("reply"));AJS.AEV(c,"click",function(){var s=AJS.$("m"+e.id).getElementsByTagName("a")[0];var q=s.getAttribute("href",2).substring(1);var r=AJS.$("input_small").value;if(r&&r[r.length-1]!=" "){r+=" "}if(q=="anonymous"){q=s.innerHTML;r=r+q+": ~"}else{r=r+"@"+q+": ~"}AJS.$("input_small").value="";InputUtil.insertAtCursor(AJS.$("input_small"),r)})}var m=AJS.DIV({c:"response_time plurk_cnt"},AJS.DIV({c:"holder"},AJS.P(g),c,h,p));var n=AJS.absolutePosition(b);n.x+=$dp.holder.offsetWidth-6;var l=AJS.$gp(b,"div","response_box");n.y-=l&&l.scrollTop||0;AJS.setStyle(m,{top:n.y,left:n.x});AJS.ACN(AJS.$("layout_content"),m);AJS.AEV(m,"mouseover",function(){if(Responses.mouseTO){clearTimeout(Responses.mouseTO)}});return false},responseMouseOut:function(b){var a=Responses;if(a.mouseTO){clearTimeout(a.mouseTO)}a.mouseTO=setTimeout(a._responseMouseOut,600);return false},_responseMouseOut:function(){AJS.removeElement(AJS.$bytc("div","response_time"))}};ResponseCache={plurk_cache:{},addToCache:function(e,c){var d=ResponseCache[e];if(d){d=ResponseCache[e]=d.concat(c)}else{d=ResponseCache[e]=c}var b=[];var a={};AJS.map(d,function(f){if(f&&!a[f.id]){a[f.id]=true;b.push(f)}});ResponseCache[e]=b},getFromCache:function(b){var a=ResponseCache[b];if(a){return a}return null},removeFromCache:function(d){var c=d.plurk_id;var a=ResponseCache.getFromCache(c);if(a){var b=[];AJS.map(a,function(e){if(e.id!=d.id){b.push(e)}});ResponseCache[c]=b}}};(function(){var a=jQuery;var b=Handlebars.compile('<div class="plurk_editor2"><textarea name="content_raw" rows="{{rows}}"></textarea><div class="pe2_manager"><a href="#" class="cancel">{{cancelTxt}}</a><a href="#" class="save">{{saveTxt}}</a><a href="#" class="saving">{{savingTxt}}</a></div></div>');var c=function(e,f,d){this._$container=undefined;f=Formatter.realOwnLinks(f);this._init(e,f,d)};c.prototype={onSave:function(d){},onAfterHide:function(d){},onBeforeShow:function(d){},onAfterShow:function(d){},show:function(){this.onBeforeShow(this._$container);this._$container.css("display","block");this._$container.find("textarea").focus();this.onAfterShow(this._$container)},hideAndDestruct:function(){this._$container.remove();this.onAfterHide(this._$container);this._$container=null},_doSave:function(){this._$container.find("textarea").prop("disabled",true);this._$container.addClass("saving");var d=this.onSave(this._$container.find("textarea").val());var e=this;d.done(function(){e.hideAndDestruct()}).fail(function(f){if(f==="maxlen"){e._$container.removeClass("saving");e._$container.find("textarea").prop("disabled",false)}})},_onCancelClicked:function(d){this.hideAndDestruct();return false},_onSaveClicked:function(d){this._doSave();return false},_onKeyDown:function(d){if(d.which==13&&!d.shiftKey){this._doSave();return false}},_initEventListeners:function(){var d=this;this._$container.find(".cancel").click(function(f){return d._onCancelClicked(f)});this._$container.find(".save").click(function(f){return d._onSaveClicked(f)});this._$container.find("textarea").keydown(function(f){return d._onKeyDown(f)})},_init:function(e,f,d){this._$container=a(b({rows:d,cancelTxt:_("cancel"),saveTxt:_("save"),savingTxt:_("saving...")}));this._$container.css("display","none");e.append(this._$container);this._$container.find("textarea").val(f);this._initEventListeners()}};window.PlurkEditor=c}());$dp={};$plurks={};function getPD(c,b,a){return c?$plurks[c.id]:null}function outerHTML(a){return a.outerHTML||new XMLSerializer().serializeToString(a)}jQuery(document).ready(function(a){if(a("#timeline_holder").length){Plurks._attachTLClickEvent()}});Plurks={img_prefix:"small_",img_toggle:null,qual_toggle:null,show_expand:true,poster:null,cur_req:null,visit_timeline:false,divTmplStr:"<div class='plurk cboxAnchor {{div_cls}}' data-pid='{{plurk_id}}' data-rid='{{rid}}' data-uid='{{owner_id}}' data-type='{{type}}' data-respcount='{{resp_count}}'><table><tbody><tr>{{#unless mini}}<td class='td_img'><div class='p_img'><img src='{{img_src}}'></div></td>{{/unless}}<td><div id='plurk_cnt_{{plurk_id}}' class='plurk_cnt'><table><tbody><tr class='tr_cnt'><td class='td_qual'>{{{span_qual}}}</div></td><td class='td_cnt'>{{{div_cnt}}}</td></tr><tr class='tr_info' style='display: none;'><td class='td_info' colspan='2'></td></tr></tbody></table></div></td>{{#unless mini}}<td class='td_response_count'><a href='/p/{{pid36}}' target=_blank><span class='response_count'>{{response_count}}</span></a></td>{{/unless}}</tr></tbody></table></div>",divTmpl:null,divTmplNativeStr:"<div class='plurk cboxAnchor {{div_cls}}' data-pid='{{plurk_id}}' data-rid='{{rid}}' data-uid='{{owner_id}}' data-type='{{type}}' data-respcount='{{resp_count}}'><table><tbody><tr>{{#unless mini}}<td class='td_img'><div class='p_img' style='background:white'><img {{{logo_style}}}'></div></td>{{/unless}}<td><div id='plurk_cnt_{{plurk_id}}' class='plurk_cnt'><table><tbody><tr class='tr_cnt'><td class='td_qual'><span><a class='name'>{{client}}</a></span> &nbsp; </td><td class='td_cnt'>{{{div_cnt}}}</td></tr><tr class='tr_info' style='display: none;'><td class='td_info' colspan='2'></td></tr></tbody></table></div></td>{{#unless mini}}<td class='td_response_count'><span class='response_count' style='font-weight: normal'>Ad</span></td>{{/unless}}</tr></tbody></table></div>",divTmplNative:null,infoBoxTmplStr:"<div class='info_box controller'><div class='perma_link'><a title='"+_("Open in external window")+"' target='_blank' href='/p/{{pid36}}' class='pif-outlink'>"+_("link")+"</a></div><div class='report_link'><a href='/Abuse/report/plurk/{{pid36}}' class='pif-warning'>"+_("Report abuse")+"</a></div><div class='last_edited {{leClass}}' title='{{le}}'>"+_("(edited)")+"</div><div class='limited_box' style='display: none;'></div></div><div id='resp_banner_ads'></div>",infoBoxTmpl:null,init:function(){var c=Plurks;var e=jQuery("<div id='form_holder' class='plurk_box' style='display:none'>");var b=e.get(0);var a=SiteState.getSessionUser();if(a&&c.show_expand){var d=c._renderResponses(b);$dp.list=d;c._renderNewResponse(b);c._renderPost(b);c._createManager(b);c._renderSaver(b);c._renderCommentsDisabled(b);c._renderCommentsOnlyFriends(b)}else{var d=c._renderResponses(b);$dp.list=d;c._renderLogin(b)}$dp.holder=b;$dp.holder_shown=false;e.appendTo("#layout_content");$dp["$resp_box"]=jQuery(".response_box",e);MouseWheel.lockWheelInElement($dp["$resp_box"][0]);c._compileInfoBox()},removeCurrentOpen:function(){if($dp.holder_shown){Plurks._removeExpand(false)}if(Plurks.cur_req){Plurks.cur_req.abort()}var a=AJS.$("input_small");if(a){PlurkBoxExpand.init(a,"hide")}},cleanPlurk:function(b){var a=$plurks["p"+b];if(a){if(a.div){a.div.onmouseover=null;a.div.onmouseout=null}AJS.map(AJS.keys(a),function(c){delete a[c]});delete $plurks["p"+b]}},cleanData:function(){$dp.deleting=null;$dp.removing=null;$dp.current_div=null;$dp.td_close=null;$dp.holder_shown=null},__plurkDeleted:function(){var d=$dp.action_div;var b=$dp.holder;var c=getPD(d).block;var a=AJS.getIndex(getPD(d).obj,c.plurks);c.plurks.splice(a,1);a=AJS.getIndex(getPD(d).obj,TimeLine.plurks);TimeLine.plurks.splice(a,1);AJS.hideElement(b);discardElement(d);Plurks.cleanData();Plurks.poster.input.disabled=false},_deletePlurk:function(){if($dp.deleting){return}$dp.action_div=$dp.hover_div;if(!confirm(_("Are you sure you want to delete your plurk?"))){Plurks.noExapndOnAction();return false}var a=$dp.holder;$dp.deleting=true;$dp.removing=true;Responses.showLoading($dp.list);Plurks.poster.input.disabled=true;var b=AJS.getRequest("/TimeLine/deletePlurk");b.sendReq({plurk_id:getPD($dp.action_div).obj.plurk_id});setTimeout(Plurks.__plurkDeleted,50);return false},_giftPlurk:function(){Plurks.noExapndOnAction();$dp.action_div=$dp.hover_div;var b=getPD($dp.action_div).obj.plurk_id;var a=SiteState.getSessionUser();if(!a){return}if(a.id==getPD($dp.action_div).obj.owner_id||getPD($dp.action_div).obj.my_anonymous){return TopBar.showPremium("/Premium/log")}(new PopWindow({url:"/Premium/gift?plurk_id="+b,width:600,height:440})).show();return false},_editPlurk:function(){var e=$dp.hover_div;var c=$dp.holder;var d=Plurks;$dp.removing=true;AJS.ACN(getPD(e).td_cnt,$dp.saver);var b=$dp.edit_text_area;var a=getPD(e).td_cnt.offsetWidth-10;if(a<150){a=150}AJS.setWidth(b,a);b.value=Formatter.realOwnLinks(getPD(e).obj.content_raw);AJS.hideElement(getPD(e).div_cnt);AJS.appendToTop(getPD(e).td_cnt,b);AJS.hideElement($dp.manager);jQuery($dp.saver).data({hover_div:$dp.hover_div,holder:$dp.holder,current_div:$dp.current_div});AJS.showElement($dp.saver);b.focus();d.repositionCurrent();return false},_renderSaver:function(){var a=$dp.edit_text_area=AJS.TEXTAREA();a.rows=3;var c=$dp.cancel_link=Plurks.createLink(_("cancel"),"cancel",Plurks.__cancelOnClick);var b=$dp.save_link=Plurks.createLink(_("save"),"action",Plurks.__saveOnClick);$dp.saver=AJS.DIV({c:"manager"},c,b);jQuery(a).keydown(Plurks._taKeyPress)},_taKeyPress:function(a){if(a.which==13&&!a.shiftKey){Plurks.__saveOnClick();return false}},_createManager:function(a){$dp.manager=AJS.DIV({c:"manager"});$dp.manager_edit=Plurks.createLink("","pif-edit edit",Plurks._editPlurk);$dp.manager_del=Plurks.createLink("","pif-delete delete",Plurks._deletePlurk);$dp.fav_link=Plurks.createLink("","pif-like like-off",Plurks._favoritePlurk);$dp.mute_link=Plurks.createLink("","pif-volume mute-off",Plurks._mutePlurk);$dp.promo_link=Plurks.createLink("","pif-push promote",Plurks._showPromote);$dp.replurk_info=AJS.SPAN();$dp.replurk_link=Plurks.createLink("","pif-replurk replurk-off",Plurks._replurk);$dp.gift_link=Plurks.createLink("","pif-bone gift",Plurks._giftPlurk)},_renderMute:function(a){jQuery($dp.mute_link).attr("class",a.obj.is_unread==2?"pif-volume-mute mute-on":"pif-volume mute-off")},_renderManager:function(a){var e=SiteState.getSessionUser();if(!e){return}AJS.RCN($dp.manager,null);var c=[];if(a.owner_id==e.id||a.my_anonymous){c.push($dp.manager_del);c.push($dp.manager_edit);AddHoverToolTip($dp.gift_link,_("gift received"))}else{c.push($dp.mute_link);AddHoverToolTip($dp.gift_link,_("encourage this plurk"))}if(a.owner_id!=e.id&&a.replurkable&&typeof(a.my_anonymous)=="undefined"){c.push($dp.promo_link);c.push($dp.replurk_link)}c.push($dp.fav_link);c.push($dp.gift_link);var d=AJS.$p(AJS.ACN,$dp.manager);for(var b=0;b<c.length;b++){d(c[b])}AddHoverToolTip($dp.fav_link,function(){return jQuery($dp.fav_link).hasClass("like-on")?_("unlike"):_("like")});AddHoverToolTip($dp.replurk_link,function(){return jQuery($dp.replurk_link).hasClass("replurk-on")?_("unreplurk"):_("replurk")});AddHoverToolTip($dp.mute_link,function(){return jQuery($dp.mute_link).hasClass("mute-on")?_("unmute"):_("mute")});AddHoverToolTip($dp.promo_link,_("promote"));AddHoverToolTip($dp.manager_edit,_("edit"));AddHoverToolTip($dp.manager_del,_("delete"))},__cancelOnClick:function(){AJS.hideElement($dp.saver);AJS.removeElement($dp.edit_text_area);var a=jQuery($dp.saver).data("hover_div")||jQuery($dp.saver).data("current_div")||$dp.hover_div||$dp.current_div;AJS.showElement(getPD(a).div_cnt,$dp.manager);jQuery($dp.saver).removeData();Plurks.repositionCurrent();Plurks.noExapndOnAction()},__saveOnClick:function(){var h=Plurks;if($dp.saving_edit){return true}var f=$dp.save_link;var b=jQuery($dp.saver).data("hover_div");var n=getPD(b);var l=jQuery($dp.saver).data("holder");var e=$dp.edit_text_area;var m=e.value;var a=MaxChar.calculateContentLength(m,n.obj.lang);if(a>210){var d=a-210;var g=format(_("Content is too long. Remove %s characters."),d);alert(g);e.focus();return true}$dp.saving_edit=true;AJS.hideElement($dp.saver);var c;AJS.insertAfter(c=AJS.DIV({c:"manager"},_("saving...")),$dp.saver);$dp.edit_text_area.disabled=true;var j=AJS.loadJSON("/TimeLine/editPlurk");j.addCallback(function(p){e.disabled=false;n.obj.content_raw=p.content_raw;n.obj.content=p.content;n.obj.last_edited=p.last_edited;var o=jQuery(n.div_cnt);o.html(Utils.protocolRelative(p.content)).show(0);Media.attach(n.div_cnt,p.id);h.__cancelOnClick();AJS.removeElement(c);jQuery($dp.saver).removeData();h.repositionCurrent();delete $dp.saving_edit});j.sendReq({plurk_id:n.obj.plurk_id,content_raw:m})},_favoritePlurk:function(){var d=$dp.hover_div;var c=getPD(d);var a=c.obj;a.favorite=!a.favorite;var b=AJS.loadJSON("/Favorites/set");b.sendReq({plurk_id:a.plurk_id,favorite:a.favorite,token:SiteState.getToken()});if(a.favorite){if(a.favorers){a.favorers.push(SiteState.getSessionUser().id)}a.favorite_count=a.favorite_count+1}else{if(a.favorers){a.favorers.splice(AJS.getIndex(SiteState.getSessionUser().id,a.favorers),1)}a.favorite_count=a.favorite_count-1}Plurks._renderGift(c);Plurks._renderFav(c);Plurks._renderIcons(c);Plurks._renderReplurkCount(a);Plurks._renderFavoriteCount(a);TimeLineCache.purge("favorite");Plurks.noExapndOnAction();if(a.favorite){Signals.sendSignal("plurk_favorited",a)}else{Signals.sendSignal("plurk_unfavorited",a)}return false},_replurk:function(){var d=$dp.hover_div;var b=getPD(d);var a=b.obj;if(a.replurkable){var c=a.replurked?"unreplurk":"replurk";a.replurked=!a.replurked;if(Plurks.__replurkOp(a,c)){if(a.replurked){if(a.replurkers){a.replurkers.push(SiteState.getSessionUser().id)}a.replurkers_count=a.replurkers_count+1}else{if(a.replurkers){a.replurkers.splice(AJS.getIndex(SiteState.getSessionUser().id,a.replurkers),1)}a.replurkers_count=a.replurkers_count-1}Plurks._renderReplurk(b);Plurks._renderReplurkCount(a);Plurks._renderIcons(b);Signals.sendSignal("plurk_"+c+"ed",a)}}Plurks.noExapndOnAction();return false},__replurkOp:function(a,c){var b=AJS.loadJSON("/TimeLine/"+c);b.sendReq({plurk_id:a.plurk_id,uid:SiteState.getSessionUser().id,token:SiteState.getToken()});return true},_mutePlurk:function(){var c=0;if(!AJS.hasClass($dp.mute_link,"mute-on")){c=2}jQuery($dp.mute_link).attr("class",c?"pif-volume-mute mute-on":"pif-volume mute-off");if(c){AJS.addClass($dp.hover_div,"muted");if($dp.hover_div==$dp.current_div){AJS.addClass($dp.holder,"muted")}}else{AJS.removeClass($dp.hover_div,"muted");if($dp.hover_div==$dp.current_div){AJS.removeClass($dp.holder,"muted")}}var a=getPD($dp.hover_div).obj;a.is_unread=c;var b=AJS.loadJSON("/TimeLine/setMutePlurk");b.sendReq({plurk_id:a.plurk_id,value:""+c});if(c){AJS.removeClass($dp.hover_div,"new");Poll.setPlurkRead(a.id,a.response_count)}if(c==2){Signals.sendSignal("plurk_muted",a)}else{Signals.sendSignal("plurk_unmuted",a)}Plurks.noExapndOnAction();return false},_renderIcons:function(e,d){var c=e.obj;var a=e.div;var f=jQuery(a);if(!d){d=SiteState.getPlurkUser(c)}if(!Plurks.$icon_pri){Plurks.$icon_pri=jQuery("<div class='plurk_icon private pif-privacy-circle'>")}if(!Plurks.$icon_fav){Plurks.$icon_fav=jQuery("<div class='plurk_icon favorite_icon pif-like-circle'>")}if(!Plurks.$icon_replurk){Plurks.$icon_replurk=jQuery("<div class='plurk_icon private pif-replurk-circle'>")}if(!Plurks.$icon_birth){Plurks.$icon_birth=jQuery("<div class='plurk_icon bday'>").append("<img src='//s.plurk.com/095108068bb9c366ab82a362d84610aa.png' height='16' width='16'>")}if(!Plurks.$icon_coin){Plurks.$icon_coin=jQuery("<div class='plurk_icon coin'>").append("<img src='//s.plurk.com/1f0904fed0643a64b9b7edec29b6a562.png' height='16' width='16'>")}f.find("div.plurk_icon").remove();var g=15;if(c.limited_to){Plurks.$icon_pri.clone().css("left",g).appendTo(f);g+=17}if(c.favorite){Plurks.$icon_fav.clone().css("left",g).appendTo(f);g+=17}if(c.replurked){Plurks.$icon_replurk.clone().css("left",g).appendTo(f)}var h=false;var j=d.date_of_birth;if(j&&typeof(j)=="object"){var b=new Date();if((j.getUTCMonth()==b.getMonth())&&(j.getUTCDate()==b.getDate())){Plurks.$icon_birth.clone().appendTo(f);h=true}}if(c.has_gift&&!h){Plurks.$icon_coin.clone().appendTo(f)}},_renderGift:function(b){var a=b.obj;jQuery($dp.gift_link).html(a.has_gift?"<span>"+a.coins+"</span>":"")},_renderFav:function(b){var a=b.obj;jQuery($dp.fav_link).html(a.favorite_count?"<span>"+a.favorite_count+"</span>":"").attr("class","pif-like like-"+(a.favorite?"on":"off"));if(a.favorite){AJS.addClass(b.div,"favorite")}else{AJS.removeClass(b.div,"favorite")}},_renderReplurk:function(b){var a=b.obj;jQuery($dp.replurk_link).html(a.replurkers_count?"<span>"+a.replurkers_count+"</span>":"").attr("class","pif-replurk replurk-"+(a.replurked?"on":"off"))},_compileInfoBox:function(){if(!Plurks.infoBoxTmpl){Plurks.infoBoxTmpl=Handlebars.compile(Plurks.infoBoxTmplStr)}},noExapndOnAction:function(a){a=a||10;if($dp.edit_text_area){$dp.edit_text_area.value=""}$dp.removing=true;setTimeout(function(){$dp.removing=false},10)},expand:function(j){var B=Plurks;var l=$dp.holder;if($dp.removing){return true}if($dp.current_div&&$dp.current_div==j&&!$dp.hoverFlag){B._removeExpand(false);return true}$dp.hoverFlag=null;TinyEmoAdder.remove();Plurks.noExapndOnAction(100);if(InfoOverlay.info_view){InfoOverlay.hide()}var u=jQuery("#timeline_holder").offset().left+jQuery("#timeline_holder").width();var d=AJS.absolutePosition(j).x;var y=(u-d);if(y<460){$dp.div2=j;try{B._removeExpand(false);$dp.removing=true}catch(v){}var x=(730-y)/4;TimeLine.slideBack(4,-x,"left",function(){if(!$dp.div2){return}Plurks.expand($dp.div2);$dp.div2=null});return true}AJS.removeClass(j,"link_extend");var h=getPD(j);var f=h.obj;if(B.poster){var g=B.poster;if(B.visit_timeline){var a;var D=SiteState.getPlurkUser(f);var C=D.display_name&&D.display_name.length>0?D.display_name:D.nick_name;var r=format(_("Visit %s's timeline to respond"),C);var n=AJS.A({href:"/"+D.nick_name},r);AJS.swapDOM(g.table,a=AJS.DIV({s:"text-align: center;"},n));g.table=a}else{g.clear();g.load(PlurkAdder.typing_responses[f.plurk_id])}var p=SiteState.getSessionUser();var c=p&&p.id==f.owner_id;if(f.no_comments==1){AJS.hideElement($dp.post_holder);AJS.hideElement($dp.commets_only_friends);AJS.showElement($dp.commets_disabled)}else{if(f.no_comments==2){AJS.hideElement($dp.post_holder);AJS.hideElement($dp.commets_disabled);if(FRIEND_IDS.indexOf(f.owner_id)){AJS.showElement($dp.post_holder)}AJS.showElement($dp.commets_only_friends)}else{AJS.hideElement($dp.commets_only_friends);AJS.hideElement($dp.commets_disabled);AJS.showElement($dp.post_holder)}}if(c){AJS.showElement($dp.post_holder)}}B.removeCurrentOpen();PlurkBlock.toggleHighlight(j,1);$dp.current_div=j;AJS.addClass(j,"plurk_box");var z=SiteState.getSessionUser();if(B.show_expand&&z&&f.owner_id==z.uid){AJS.showElement($dp.manager);AJS.ACN(getPD(j).td_cnt,$dp.manager);$dp.save_link.innerHTML=_("save")}else{if(SiteState.canEdit()){jQuery($dp.mute_link).attr("class",f.is_unread==2?"pif-volume-mute mute-on":"pif-volume mute-off")}}if(f.is_unread==2){AJS.addClass(l,"muted")}else{AJS.removeClass(l,"muted")}var t=jQuery(l);var o="le_hidden",m="";if(f.last_edited){m=new Date(f.last_edited);m=Cal.convertToLocal(m);m="@ "+Cal.formatMonthDate(m)+" - "+Cal.formatTime(m.getHours(),m.getMinutes());m=_("Last edited %s").replace("%s",m);o=""}var w={pid36:f.plurk_id.toString(36),pid:f.plurk_id,leClass:o,le:m};var s=jQuery(Plurks.infoBoxTmpl(w));t.find(".info_box.controller").remove();t.find("#resp_banner_ads").remove();t.append(s);$dp.info_box=s.get(0);s.find(".report_link a").click(function(){(new PopWindow({url:this.href+"?overlay=1",width:650})).show();return false});if(z){Plurks._renderReplurkCount(f);Plurks._renderFavoriteCount(f)}var b=s.find(".limited_box");if(f.limited_to){b.show(0);var q=f.limited_to;if(q==Plurk.friends_only){b.text(_("private plurk to friends"))}else{if(q.replace){q=q.replace(/\|\|/g,"|").replace(/^\|/,"").replace(/\|$/,"").split(/\|/)}var A=q;if(q.length>8){A=q.slice(0,8)}PlurkAdder.fetchUsersIfNeeded(A,AJS.$p(Responses._renderLimitedTo,b.get(0),f,q,A),"lts")}}jQuery(document).on("click.expand",function(F){var E=jQuery(F.target);if(E.closest(".popView,#form_holder,.response_time,.plurk_cnt,#info_overlay,.pop-window,#colorbox").length){return}if($dp.holder_shown&&!t.is(F.target)&&t.has(F.target).length===0){Plurks.removeCurrentOpen()}});setTimeout(function(){var E=jQuery(j).find(".plurk_cnt:first");var e=/metro_c\d+/.exec(E[0].className);var F=jQuery(l);if(e){F.attr("class","plurk_box "+e[0])}else{F.attr("class","plurk_box")}F.find("div.list:first").attr("style","").end().show(0);$dp.holder_shown=true;Plurks.relayoutResponseBox();if(f.anonymous){F.addClass("anonymous")}else{F.removeClass("anonymous")}if(B.show_expand){Responses.showLoading($dp.list);Responses.fetchItems(l)}},0)},relayoutResponseBox:function(){var d=$dp.holder;if(d&&$dp.holder_shown){var b=jQuery($dp.current_div);var g=jQuery(d);var c=jQuery("#timeline_cnt").height()+200;var f=Math.min(c-(b.offset().top+b.height()-parseFloat(b.css("margin-top"))+340),0);if(f==0){f=""}b.css({"margin-top":f});var e=b.find(".plurk_cnt:first");var h=e.offset();var a=jQuery("#timeline_cnt").offset().top+8;if(h.top<a){f+=a-h.top;b.css({"margin-top":f});h=e.offset()}g.css({top:h.top+e.outerHeight(),left:h.left,width:e.outerWidth()});if(Plurks.poster){jQuery(Plurks.poster.input).trigger("propertychange")}}},_renderReplurkCount:function(a){if(!SiteState.getSessionUser()){return}var b=_("replurks");var c=a.replurkers_count;jQuery($dp.resbox).find(".replurk_count").css("display",c>0?"block":"none").html(c+" "+b.charAt(0).toUpperCase()+b.slice(1))},_renderFavoriteCount:function(a){if(!SiteState.getSessionUser()){return}var b=_("likes");var c=a.favorite_count;jQuery($dp.resbox).find(".favorite_count").css("display",c>0?"block":"none").html(c+" "+b.charAt(0).toUpperCase()+b.slice(1))},_showUserList:function(a){if(a){PlurkAdder.fetchUsersIfNeeded(a,function(){var c=jQuery("<div class='user_list'><ul>");var b=c.children("ul");var d=Profile._genericRenderListFull(a);jQuery.each(d,function(e,f){f.avatar_imgsrc=Users.getUserImgSrc(f,"medium");if(!f.display_name){f.display_name=f.nick_name}b.append('<li><a target="_blank" href="/'+f.nick_name+'"><img src="'+f.avatar_imgsrc+'" /><div>'+f.display_name+'<br><span class="nick_name">@'+f.nick_name+"</span></div></a></li>")});jQuery.colorbox({html:c[0],maxHeight:jQuery(window).innerHeight()*0.95,onClosed:function(){jQuery("body").removeClass("cboxOpen")},onComplete:function(){jQuery("body").addClass("cboxOpen")}})})}},repositionCurrent:function(a){var b=jQuery($dp.current_div).find(".plurk_cnt:first");jQuery($dp.holder).css("top",b.offset().top+b.outerHeight())},_removeExpand:function(a){var g=$dp.current_div;var e=jQuery($dp.holder);var f=e.find("div.list:first");e.hide(0).find("#resp_banner_ads").empty().removeClass("show");var d=f.children("div.plurk").length;f.empty();$dp.holder_shown=false;jQuery(document).off("click.expand");Emoticons.forceHideIfBoundToPlurkResponse();TinyEmoAdder.remove();jQuery("div.response_time:first").remove();Plurks.__cancelOnClick();if(a){Plurks.noExapndOnAction()}Plurks.cleanData();if(!g){return}jQuery(g).css({"margin-top":""});PlurkBlock.toggleHighlight(g,0);var c=jQuery(g);c.removeClass("plurk_box");c.find(".plurk_cnt:first").removeClass("new6 new5 new4 new3 new2 new1 new0");var b=getPD(g);if(!b){return}b.obj.response_count=d;if($dp.edit_text_area){AJS.showElement(b.div_cnt)}if(document.focus){document.focus()}},_renderClose:function(c){var b=AJS.IMG({src:"//s.plurk.com/7d18146c10c2fbafa789e79c49db7804.gif"});var a;AJS.ACN(c.tr_cnt,a=AJS.TD({c:"mini_close"},b));AJS.AEV(a,"click",AJS.$p(Plurks._removeExpand,true));return a},_renderPost:function(d){$dp.post_holder=jQuery("<div></div>").appendTo(d)[0];var a=jQuery('<div class="mini_form"></div>').appendTo($dp.post_holder);var b={type:"response",mode:"small",more_options:false,cookie:"default_qual_mini",extra_menu_class:"mini_menu",show_submit:false,input_id:"input_small",lang:GLOBAL.session_user.default_lang};var c=Plurks.poster=new PlurkPoster(b);c.onChange(function(f){if(!$dp.current_div){return}var e=getPD($dp.current_div).obj;PlurkAdder.addTypingResponse(e.plurk_id,f)});c.onSubmit(function(f){if(!$dp.current_div){return}var e=getPD($dp.current_div).obj;c.setPosting(true);jQuery.when(PlurkAdder.plurkRespAdd(e,f.content,f.qualifier)).done(function(g){c.clear();PlurkAdder.clearTypingResponse(e.plurk_id);c.setPosting(false)}).fail(function(h){var h=h.msg;var g=h.status;if(g==400){if(h){alert(h)}}else{if(g==404){AJS.RCN($dp.list,AJS.DIV({c:"empty",s:"color: red"},h))}else{if(g==403){AJS.RCN($dp.list,AJS.DIV({c:"empty",s:"color: red"},h,AJS.BR(),AJS.setHTML(AJS.SPAN(),text.substring(0,200))))}else{if(g==-1){AJS.RCN($dp.list,AJS.DIV({c:"empty",s:"color: red"},h))}else{AJS.setHTML(AJS.$("input_small_cu"),h)}}}}c.setPosting(false)})});a.append(c.table)},_renderLogin:function(a){var b;AJS.ACN(a,AJS.DIV({c:"login_to_see"},b=AJS.A({href:"/signup"},_("Register your Plurk account to respond to these plurks"))))},_renderCommentsDisabled:function(a){AJS.ACN(a,$dp.commets_disabled=AJS.setHTML(AJS.DIV({c:"info_box c_disabled"}),"("+_("Responses <b>disabled</b> for others than plurk poster")+")"));AJS.hideElement($dp.commets_disabled)},_renderCommentsOnlyFriends:function(a){AJS.ACN(a,$dp.commets_only_friends=AJS.setHTML(AJS.DIV({c:"info_box c_disabled"}),"("+_("Only plurker's <b>friends</b> can respond")+")"));AJS.hideElement($dp.commets_only_friends)},_renderResponses:function(c){var a=jQuery('<div class="response_box"><div class="favorite_count" style="display:none"></div><div class="replurk_count" style="display:none"></div>');var b=jQuery('<div class="list"></div>')[0];a.append(b);jQuery(c).append(a);$dp.resbox=a[0];a.find(".favorite_count").click(function(){var f=$dp.current_div;var e=getPD(f);var d=e.obj;if(d.anonymous){return}if(d.favorers){Plurks._showUserList(d.favorers)}});a.find(".replurk_count").click(function(){var f=$dp.current_div;var e=getPD(f);var d=e.obj;if(d.anonymous){return}if(d.replurkers){Plurks._showUserList(d.replurkers)}});return b},_renderNewResponse:function(a){$dp.new_resp_hint=jQuery('<div class="new_response_hint"></div>').html(_("New Response")).css({display:"none",opacity:0}).appendTo(a)},renderPlurk:function(l,n){var C=Plurks;var c=SiteState.getPlurkUser(l);if(!c){return null}if(!Plurks.divTmpl){Plurks.divTmpl=Handlebars.compile(Plurks.divTmplStr)}if(!Plurks.divTmplNative){Plurks.divTmplNative=Handlebars.compile(Plurks.divTmplNativeStr)}var h=Plurks.divTmpl;var u=Plurks.divTmplNative;var w=(!n)?"p"+l.id:"m"+l.id;if(n){if(jQuery("#"+w).length){return null}}var t=l.content.replace("<script","");t=Utils.protocolRelative(t);var a=null;var p=c;if(l.replurker_id){a=SiteState.getUserById(l.replurker_id)}if(n&&c.id==99999){var y=l.handle;var v=l.my_anonymous}else{var y=null;var v=false}var A=Qualifiers.format(c,l.qualifier,t,false,l.lang,l.id,(a!=null),y,v);var x=A[0];var q=A[1];if(a){p=a;var s=SiteState.getSessionUser();var E=a.display_name||a.nick_name;var D=(s&&s.default_lang)||"en";var g=Qualifiers._(a.gender,D,"replurks");var d="<span><a class='name' href='/"+a.nick_name+"' data-uid='"+a.id+"'>"+E+"</a><span class='qualifier q_replurks'>"+g+"</span></span>";q=jQuery("<div class='text_holder'>").append(x).append(q).get(0);x=jQuery("<span>").append(d).get(0)}var b;if(!n){b=Users.getUserImgSrc(p)}var B="";if(c.nick_name=="plurkbuddy"&&SiteState.canEdit()){B+="glow"}if(l.is_unread==2){B+=" muted"}if(SiteState.canEdit()&&(Poll.current_data.unread_plurks[l.id])){B+=" new"}if(n&&!y&&(getPD($dp.current_div).obj.owner_id==l.user_id)){B+=" highlight_owner"}var f=l.response_count;if(tl_native.enable&&l.is_y_native){B+=" ynative"}else{if(tl_banana.enable&&l.is_ad){B+=" banana_plurk display";if(jQuery.inArray(l.plurk_id.toString(),tl_banana.plurk[l.realId].impress)>-1){B+=" impress"}if(c.nick_name=="love"){l.response_count="告白";B+=" valentine"}else{l.response_count="贊助"}}}var r={plurk_id:l.plurk_id,pid36:l.plurk_id.toString(36),rid:(l.id!=l.plurk_id)?l.id:"",resp_count:f,user_id:l.user_id,owner_id:l.owner_id,span_qual:outerHTML(x),div_cnt:outerHTML(q),img_src:b,div_cls:B,response_count:l.response_count,mini:n,type:(n)?"response":"plurk"};var j;if(l.is_y_native){r.client=l.client;r.logo_style=l.logo_style;j=jQuery(u(r));j.click(function(F){tl_native.clickAds(l.plurk_id);return false})}else{j=jQuery(h(r))}if(tl_banana.enable&&l.is_ad){j.click(function(F){tl_banana.clickAds(this);return false})}var o=j.get(0);o.id=w;var m=$plurks[w]={obj:l,div:o,$div:j,image:j.find(".p_img:first").get(0),div_cnt:j.find(".text_holder:first").get(0),td_cnt:j.find(".td_cnt:first").get(0),cnt:j.find(".plurk_cnt:first").get(0),tr_cnt:j.find(".tr_cnt:first").removeAttr("class").get(0),tr_info:j.find(".tr_info:first").get(0),td_info:j.find(".td_info:first").get(0),tr:j.find("tr:first").get(0)};if(!n){Plurks._renderIcons(m,p);var e=j.find(".td_response_count:first");var z=getPD(o);z.td_resp_count=e.get(0);z.response_count=e.find(".response_count:first").get(0);if(l.response_count==0){z.response_count.style.display="none"}}if(!y||y=="ಠ_ಠ"){Plurks.applyNameColor(o,l)}if(window.Media){Media.attach(o)}if(window.annoplurk){annoplurk.attach(o)}return o},_attachTLClickEvent:function(){var b=Plurks;var a="";if(window.cbox){a=cbox.classList;a="."+a.join(", .");a+=", .emoticon_my, .name, .hashtag"}jQuery("#timeline_holder").on("mouseover mouseout click dblclick","div.plurk",function(d){switch(d.type){case"mouseover":if(jQuery(d.target).hasClass("emoticon_my")){return true}b._plurkMouseOver(this);return false;case"mouseout":if(jQuery(d.target).hasClass("emoticon_my")){return true}b._plurkMouseOut(this);return false;case"click":case"dblclick":var c=jQuery(d.target);if(a.length&&(c.is(a)||(c.parent(a).length))){return true}b.expand(this)}return true});jQuery("#form_holder").on("mouseover mouseout","div.plurk",function(c){switch(c.type){case"mouseover":if(jQuery(c.target).hasClass("emoticon_my")){return true}Responses.responseMouseOver(this);return false;case"mouseout":if(jQuery(c.target).hasClass("emoticon_my")){return true}Responses.responseMouseOut(this);return false}return true})},plurkMouseOutTO:null,_plurkMouseOut:function(b){var a=Plurks;if(Plurks.plurkMouseOutTO){clearTimeout(Plurks.plurkMouseOutTO)}a.plurkMouseOutTO=setTimeout(AJS.$p(a.__plurkMouseOut,b),500);return false},_plurkMouseOver:function(f){var c=jQuery(f);var a=getPD(f);var d=$dp.edit_text_area;if(Plurks.plurkMouseOutTO){clearTimeout(Plurks.plurkMouseOutTO)}if($dp.hover_div==f){return}else{var b=jQuery($dp.hover_div);b.removeClass("link_extend");if(SiteState.canEdit()){TinyEmoAdder.remove();if(!b.hasClass("plurk_box")){b.removeClass("display")}}}jQuery("div.display").each(function(){var g=jQuery(this);if(!g.hasClass("plurk_box")){g.removeClass("display")}});$dp.hover_div=f;c.addClass("display").addClass("link_extend");if((tl_banana.enable&&c.hasClass("banana_plurk"))||c.hasClass("ynative")){if($dp.holder_shown){Plurks.repositionCurrent()}TimeShow.displayTime(f);Plurks.fixBottomPlurk(f);return false}Plurks._renderManager(a.obj);Plurks._renderGift(a);var e=SiteState.getSessionUser();if(e){if(!d){jQuery($dp.manager).show(0)}Plurks._renderFav(a);Plurks._renderReplurk(a);Plurks._renderMute(a);jQuery(getPD(f).td_cnt).append($dp.manager)}if(SiteState.canEdit()){if(!jQuery($dp.current_div).hasClass("plurk_box")&&(d&&d.value=="")){$dp.current_div=f;$dp.hoverFlag=1;jQuery($dp.manager).show(0).appendTo(getPD(f).td_cnt);$dp.save_link.innerHTML=_("save")}}if($dp.holder_shown){Plurks.repositionCurrent()}TimeShow.displayTime(f);Plurks.fixBottomPlurk(f);return false},__plurkMouseOut:function(b){var a=getPD(b);if(a){if(SiteState.canEdit()){if(!$dp.holder_shown){if($dp.manager){AJS.hideElement($dp.manager)}}}AJS.removeClass(b,"link_extend")}TimeShow.displayTime(null);$dp.hover_div=null;Plurks.fixBottomPlurk(b,"mouseout")},fixBottomPlurk:function(c,a){var b=AJS.$("timeline_cnt");b.style.paddingBottom="0";b.style.overflow="hidden";if(c.offsetTop+c.clientHeight>386){b.style.overflow="visible"}},highlightPlurk:function(f,c){c=c||40000;var e=jQuery("#plurk_cnt_"+f);var a=Math.floor(f%19);e.addClass("metro_c"+a);var d=TimeLine.highlight_ids[f];if(d==true){e.addClass("new6");var b=5;var g=window.setInterval(function(){if(e.attr("class").indexOf("new")==-1){clearInterval(g);return}e.addClass("new"+b).removeClass("new"+(b+1));b-=1;if(b==-1){clearInterval(g);e.removeClass("new0");TimeLine.highlight_ids[f]=null}},c/6)}},_getPlurkCntDim:function(c){var b=c.cloneNode(true);b.style.position="absolute";AJS.setTop(b,500);AJS.setVisibility(b,false);AJS.ACN(AJS.getBody(),b);var d=b.offsetWidth;var a=b.offsetHeight;AJS.removeElement(b);b=null;return[d,a]},_showPromote:function(){Plurks.noExapndOnAction();var a=getPD($dp.hover_div).obj;var b="/PlurkTop/showAddPlurk/?from_plurk=1&plurk_url=/p/"+(a.plurk_id).toString(36);(new PopWindow({url:b,width:550})).show();return false},getShades:function(a){return AJS.fx._shades}};Plurks.createLink=function(e,a,b){var f=AJS.A({c:a,href:"javascript:void(0)"},e),d=b,c=e;if(b){f.onclick=function(){d();_gaq_push(["_trackEvent","Plurk_action","click",c])}}return f};Plurks.focusTrick=function(a){$dp.resbox.scrollTop=a.offsetTop};Plurks.new_resp_hint_timer=null;Plurks.showNewResponse=function(a){if($dp.resbox.scrollTop>a.offsetTop-jQuery($dp.resbox).height()-120){Plurks.focusTrick(a);return}var b=function(){if(Plurks.new_resp_hint_timer){clearTimeout(Plurks.new_resp_hint_timer)}};var c=function(){b();Plurks.new_resp_hint_timer=setTimeout(function(){$dp.new_resp_hint.animate({opacity:0},300,function(){$dp.new_resp_hint.css({display:"none"})})},3000)};$dp.new_resp_hint.off("click mouseover mouseout").on("click",function(){$dp.resbox.scrollTop=a.offsetTop;b();$dp.new_resp_hint.css({opacity:0,display:"none"})}).css({display:"block",opacity:0}).animate({opacity:1},300,function(){c()}).on("mouseover",function(){b()}).on("mouseout",function(){c()})};Plurks.applyNameColor=function(c,b){var a=SiteState.getPlurkUser(b);AJS.map(AJS.$bytc("a","name",c),function(d){if(a.name_color){d.style.color="#"+a.name_color}})};PlurkMetaData={responded:{},muted:{},annotate:function(a){var b=PlurkMetaData;var c=a.plurk_id;if(b.muted[c]){a.is_unread=2}if(b.responded[c]){if(Plurk.isAnonymous(a)){a.plurk_type=6}else{if(Plurk.isPrivate(a)){a.plurk_type=3}else{a.plurk_type=2}}}},load:function(){var a=PlurkMetaData;jQuery.getJSON("/Plurks/getPlurksMetaData.json").done(function(b){b.r.forEach(function(c){a.responded[c]=true});b.m.forEach(function(c){a.muted[c]=true})}).fail(function(){setTimeout(a.load,5000)})}};Signals.connect("plurk_muted",function(a){PlurkMetaData.muted[a.plurk_id]=true});Signals.connect("plurk_unmuted",function(a){if(PlurkMetaData.muted[a.plurk_id]){delete PlurkMetaData.muted[a.plurk_id]}});Signals.connect("response_added",function(a,b){PlurkMetaData.responded[a.plurk_id]=true});PrivatePlurking={renderPrivatePlurk:function(){var a=jQuery("#render_private_plurk a:first, .privplurk_req");if(a.length){var b=function(){PrivatePlurking.showPrivatePlurk(top.SiteState.getPageUser().id)};a.on("click",b)}},showPrivatePlurk:function(b){var a=jQuery('<div><img src="//s.plurk.com/3dffb16b3316e8f28df661fdf3952dfc.gif" style="padding: 8px 0; height:80px; display:block; margin:0 auto;" /></div>');var c=new PopWindow({content:a[0],width:640,height:0});c.show();jQuery.post("/Users/showSendPrivatePlurk",{to_user_id:b}).done(function(d){a.html(d);if(a.find("#private_poster").length){var f=SiteState.getSessionUser();var e={lang:(f&&f.default_lang)||"en",input_id:"input_big_private",cookie:null,more_options:false};var g=window.private_poster=new PlurkPoster(e);jQuery(g.table).find(".plurk_to").html('<i class="pif-privacy"></i>'+_("this plurk will be viewable to")+" <b>"+jQuery("#nick_name_sanitized",a).text()+"</b>");g.onChange(function(){c.layout()});g.onSubmit(function(h){g.setPosting(true);h.to_user_id=b;jQuery.when(PlurkAdder.addPlurk(h)).done(function(j){c.close()}).fail(function(j){if(j&&j.msg){alert(j.msg)}g.setPosting(false)})});a.find("#private_poster").append(g.table);jQuery(g.input).focus()}}).fail(function(){c.close()})}};TinyEmoAdder={popview:null,$attachedIMG:null,$panel:null,remove:function(){if(TinyEmoAdder.popview){TinyEmoAdder.popview.hide();TinyEmoAdder.popview=null}},newTmpl:Handlebars.compile('<div class="emo-tiny-adder"><div class="emo-tiny-add-tip">{{addTip}}</div><div class="emo-tiny-group"><img src="{{group1Thumbnail}}" class="emo-tiny-group-selected" /><span class="pif-add" id="emo-tiny-group-add" /></span></div><div class="emo-tiny-btns"><div class="emo-tiny-more-less pif-setting" title="More options..."></div><input id="emo-tiny-add-keyword" placeholder="{{kwTip}}" style="display: none;" /><div class="emo-tiny-add pif-add">{{addStr}}</div><img style="display: none;" src="/static/indicator_mini.gif" class="emo-tiny-indicator"></div><div class="emo-error-msg" style="display: none;" id="emo-tiny-add-error"></div></div>'),premOnlyTipTmpl:Handlebars.compile('<div class="premOnlyTip"><div class="msg">{{{msg}}}</div><a href="/coin" target="_blank" class="pif-bone button">{{detailTip}}</a></div>'),show:function(j,d,a,m,n,f,h,e,p){jQuery("div.list, div.cbox_response").on("scroll click",TinyEmoAdder.remove);TinyEmoAdder.remove();TinyEmoAdder.$attachedIMG=p;p.data("attachedTinyEmoAdder",true);p.css({border:"1px solid #c72626"});var o=jQuery(TinyEmoAdder.newTmpl({addTip:_("Add this emoticon to"),addStr:_("Add"),kwTip:_("Custom Keyword"),group1Thumbnail:"//s.plurk.com/abc64276d84b2ce45e5c5092ee61c017.png"}));EmoticonsMy.groupsMetaDeferred.done(function(q,r){var x=jQuery(".emo-tiny-group",o);x.data("selectedGroup",1);jQuery(jQuery("img",x)[0]).data("gid",1);jQuery("span",x).data("gid","n");for(var u=0;u<r.length;u++){var t=r[u];var w=q[t.toString()]||"//s.plurk.com/13151d0dcee088b8f5991aaee4f57532.png";var s=jQuery("<img />").attr("src",w).data("gid",t);jQuery("#emo-tiny-group-add",x).before(s)}var v=function(y){var z=jQuery(this);jQuery(".emo-tiny-group-selected",x).removeClass("emo-tiny-group-selected");z.addClass("emo-tiny-group-selected");x.data("selectedGroup",z.data("gid"));y.stopPropagation()};if(!top.SiteState.getSessionUser().premium){x.on("click","img:first-child",v);x.on("mouseenter","img:not(:first-child),span",function(z){var A=window.LANG&&window.LANG.indexOf("zh_")!=-1;var y=jQuery(TinyEmoAdder.premOnlyTipTmpl({msg:A?"只要擁有噗幣，就可以擁有超級大的表情包包跟群組功能！":"Get Plurk Coins to expand your emoticon pack capacity and use emoticon groups!",detailTip:A?"查看更多關於噗幣的事":"More about Plurk Coin"}));HoverPopView(this,true,{content:y,ex_class:"popTooltip",direction:"bottom"});z.stopPropagation()})}else{x.on("click","img,span",v)}});var l=jQuery(".emo-tiny-add",o);var g=jQuery(".emo-tiny-indicator",o);var c=jQuery("#emo-tiny-add-keyword",o);var b=jQuery(".emo-error-msg",o);jQuery(".emo-tiny-more-less",o).click(function(){jQuery("#emo-tiny-add-keyword",o).css({display:""});jQuery(this).remove()});c.keydown(function(q){if(q.which==13){l.click()}});l.click(function(){b.css({display:"none"}).html(" ");l.attr({disabled:"disabled"}).css({visibility:"hidden"});g.css({display:""});_gaq_push(["_trackEvent","custom_emos","add",h]);var r=jQuery.Deferred();var s;if(jQuery(".emo-tiny-group",o).length>0){s=jQuery(".emo-tiny-group",o).data("selectedGroup");if(s==="n"){jQuery.ajax("/EmoticonManager2/newGroup",{data:{form_token:GLOBAL.session_user.token},type:"POST",dataType:"json"}).done(function(t){if(!t.ok){r.reject()}else{r.resolve(t.g)}}).fail(function(){r.reject()})}else{r.resolve(s)}}else{r.resolve("1")}var q=function(t){g.css({display:"none"});l.removeAttr("disabled").css({visibility:""});b.css({display:""});b.html(t)};r.done(function(t){jQuery.ajax("/EmoticonDiscovery/addEmoticon",{data:{form_token:GLOBAL.session_user.token,hash_id:m,keyword:c.val(),group_id:t},type:"POST",dataType:"json"}).done(function(v){g.css({display:"none"});if(!v.ok){if(v.message&&v.message=="maximum emoticons reached"){if(GLOBAL.session_user.premium){q(_("Maximum emoticons reached (%s emoticons). Please remove not used emoticons.").replace("%s",800))}else{var u=window.LANG&&window.LANG.indexOf("zh_")!=-1;o.html(TinyEmoAdder.premOnlyTipTmpl({msg:u?"已達到儲存上限60個了，需要更大的表情包包嗎？<br />只要擁有噗幣，就可以擁有超級大的表情包包跟群組功能！":"You have hit the quota limit of 60 emoticons. Want a larger emoticon pack?<br />Get Plurk Coins to expand your emoticon pack capacity and use emoticon groups!",detailTip:u?"查看更多關於噗幣的事":"More about Plurk Coin"}));o.off("click")}}else{q(v.message?v.message:_("Something went wrong :("))}}else{if(n){n(f)}if(s==="n"){EmoticonsMy.reloadEverything()}else{EmoticonsMy.reloadSingle(parseInt(t))}o.empty().append($addSuccessMsg=jQuery("<div></div>").addClass("emo-success-msg").html(_("The emoticon has successfully been added.")));setTimeout(function(){if(TinyEmoAdder.$attachedIMG==p){TinyEmoAdder.remove()}},1000)}}).fail(function(){q(_("Something went wrong :("))})}).fail(function(){q(_("Something went wrong :("))});return false});o.click(function(){return false});TinyEmoAdder.$panel=o;TinyEmoAdder.popview=new PopView({content:o,ex_class:"popTooltip",direction:"bottom",keep:false,hoverArea:true,onHide:function(){if(TinyEmoAdder.$panel){jQuery("div.list, div.cbox_response").off("scroll click",TinyEmoAdder.remove);TinyEmoAdder.$panel=null}if(TinyEmoAdder.$attachedIMG){TinyEmoAdder.$attachedIMG.removeData("attachedTinyEmoAdder");TinyEmoAdder.$attachedIMG.css({border:""});TinyEmoAdder.$attachedIMG=null}}});TinyEmoAdder.popview.showFrom(p)}};EmoAddHelper={tipTimeout:null,$addIcon:null,$attachedTimelineIMG:null,attachAddOverlayTimeline:function(a){if(!a.parent().hasClass("emoticon_my_wrapper")){a.wrap(jQuery("<span></span>").addClass("emoticon_my_wrapper").mouseleave(EmoAddHelper.removeAddOverlayTimeline).click(function(){if(EmoAddHelper.tipTimeout){clearTimeout(EmoAddHelper.tipTimeout);EmoAddHelper.tipTimeout=null}_gaq_push(["_trackEvent","custom_emos","emotiland","timelineEmoticonClicked"]);var b=/\/\/emos\.plurk\.com\/([a-f0-9]+)_w/.exec(a.attr("src"))[1];EmoAddHelper.removeAddOverlayTimeline();TinyEmoAdder.show(a,jQuery("body"),a.attr("src"),b,null,null,"fromTimeline",null,a);return false}))}EmoAddHelper.$attachedTimelineIMG=a},removeAddOverlayTimeline:function(){if(EmoAddHelper.$attachedTimelineIMG){EmoAddHelper.$attachedTimelineIMG.unwrap()}EmoAddHelper.$attachedTimelineIMG=null},attachAddOverlayEmotiland:function(a){a.append(EmoAddHelper.$addIcon.css({top:"0px",right:"1px",left:""}));a.css({border:"1px dashed #c72626"})},removeAddOverlayEmotiland:function(a){a.css({border:""});EmoAddHelper.$addIcon.remove()},timeoutFuncOnTimelineHover:function(a){EmoAddHelper.tipTimeout=null;EmoAddHelper.attachAddOverlayTimeline(a)},shouldIgnoreCustomEmoticonClickOnTimeline:false};jQuery(document).ready(function(){if(FeatureManager.isAvailable("EmoticonManager")){EmoAddHelper.shouldIgnoreCustomEmoticonClickOnTimeline=true;jQuery(document).on("mouseenter","img.emoticon_my",function(){if(TinyEmoAdder.$attachedIMG&&TinyEmoAdder.$attachedIMG[0]==this){return}var a=jQuery(this);if(!EmoAddHelper.tipTimeout){EmoAddHelper.tipTimeout=setTimeout(function(){EmoAddHelper.timeoutFuncOnTimelineHover(a)},150)}a.mouseleave(function(){if(EmoAddHelper.tipTimeout){clearTimeout(EmoAddHelper.tipTimeout);EmoAddHelper.tipTimeout=null}})});EmoAddHelper.$addIcon=jQuery("<img />").attr({id:"timeline-add-emo-icon",src:"//s.plurk.com/b4c13c8006f3af07156a218d913b8eb5.png"});EmoAddHelper.$addIcon.css({position:"absolute","z-index":"4001"})}});(function(b){var e=null;var c=Handlebars.compile('<img src="{{avatar}}" class="profile_pic"><div class="full_name"><div class="display_name">{{display_name}}</div><div class="nick_name">@{{nick_name}}</div></div><div class="info">{{#if year}}<span class="year">{{year}}</span>{{/if}}<span class="gender">{{gender}}, </span><span class="karma">Karma {{karma}}</span>{{#if location}}<br><span class="location">{{location}}</span>{{/if}}</div>');InfoOverlay=function(f){this._init(f)};InfoOverlay.prototype={_init:function(f){this.user_id=f},showFrom:function(j,g){var h=this;g=b.extend({hover:true},g);if(e){e.hide()}e=h;h.target=j;h.view=b('<div class="info_menu"><div class="user_info">...( ﾟ∀ ﾟ)</div><ul class="menu" class="display:none"></ul><div class="more_option" class="display:none"></div></div>')[0];var f=function(){e=null;if(g.onHide){g.onHide()}};if(g.hover){h.pop_view=HoverPopView(j,true,{content:h.view,direction:"bottom",onHide:f})}else{h.pop_view=new PopView({content:h.view,direction:"bottom",onHide:f});h.pop_view.toggleFrom(j)}h.loadUser()},hide:function(){if(this.pop_view){this.pop_view.hide()}},loadUser:function(){var f=this;if(top.USERS&&top.USERS[f.user_id]){f.user=top.USERS[f.user_id];f.updateInfo();return}b.post("/Users/fetchUserInfo",{user_id:f.user_id,as_json:true}).done(function(h){var g=JSON.parse(h);if(!top.USERS){top.USERS={}}top.USERS[g.id]=g;f.user=g;if(f.pop_view){f.updateInfo()}}).fail(function(){if(f.pop_view){b(f.view).find(".user_info").html("(! ﾟдﾟ) Errorrrrr")}})},updateInfo:function(){var l=this;var f=l.user;var o=b(l.view);var n=o.find(".user_info");n.html(c({avatar:Users.getUserImgSrc(f,"medium"),display_name:f.display_name,nick_name:f.nick_name,year:Utils.getYears(f.date_of_birth)||"",gender:Users.getGender(f),karma:f.karma&&f.karma.toFixed(1)||0,location:Users.getLocation(f)}));if(f.premium){n.find(".display_name").append('<img src="//s.plurk.com/52103266944dabda5188c4a47b3a6b50.png" class="premium-small">')}if(f.verified_account){n.find(".display_name").append('<img src="//s.plurk.com/40ace976cd8bd56aad6271956d8ac25b.png" class="verified-account-small" title="'+_("This user is verified as authentic identity.")+'">')}if(window.SiteState&&SiteState.getSessionUser()&&GLOBAL.session_user.uid!=f.id){var h=o.find(".menu");if(window.Plurks&&$dp.holder_shown){b('<li class="pif-message"></li>').html(_("Reply to")).click(function(){l.sendReply()}).appendTo(h)}b('<li class="pif-message-private"></li>').html(_("Send private plurk")).click(function(){l.sendPrivatePlurk()}).appendTo(h);var m=f.date_of_birth?(new Date(f.date_of_birth)):null;var g=new Date();if(m&&typeof(m)=="object"&&m.getUTCMonth()==g.getMonth()&&m.getUTCDate()==g.getDate()){b('<li class="pif-bone"></li>').html(_("Send birthday gift")).click(function(){l.sendGift(true)}).appendTo(h)}else{b('<li class="pif-bone"></li>').html(_("Send gift")).click(function(){l.sendGift()}).appendTo(h)}var j=o.find(".more_option");$report=b('<span class="report"><i class="fa fa-exclamation-triangle"></i></span>').click(function(){l.showReport()}).appendTo(j);AddHoverToolTip($report,_("Report user"));$block=b('<span class="block"><i class="fa fa-ban"></i></span>').click(function(){l.showBlock()}).appendTo(j);AddHoverToolTip($block,_("Block user"));o.find(".menu, .more_option").css("display","block")}if(f.nick_name=="plurkbuddy"){n.find(".full_name").html(_("Hi! I am Plurk Buddy and I am here to help make your Plurk experience great."));n.find(".info").remove();h.remove()}else{if(f.user_id==99999){n.find(".full_name").html(_("This is an anonymous plurk posted by one of your friends"));n.find(".info").remove();h.remove()}}},sendReply:function(){var f=this.user;var h=b("input_small");var g="@"+f.nick_name+": ";InputUtil.insertAtCursor(AJS.$("input_small"),g);this.hide()},sendPrivatePlurk:function(){top.PrivatePlurking.showPrivatePlurk(this.user_id);this.hide()},sendGift:function(f){var f=f||false;SendGift.showSendGift(this.user_id,f);this.hide()},showBlock:function(){var h=this;var f=format(_("Are you sure you want to block %s?"),this.user.nick_name);if(confirm(f)){var g="/Friends/blockUser?block_uid="+this.user_id+"&reload=0";(new PopWindow({url:g,width:650,onLoad:function(){if(GLOBAL.page_user&&GLOBAL.page_user.id==h.user_id){GLOBAL.page_user.has_block=true}}})).show()}this.hide()},showReport:function(){var j=this;var f=b(j.target).parents(".plurk");var g="/Abuse/report/user/"+j.user_id;if(f.length){var h=f.data("type");if(h=="plurk"){g+="?plurk_id="+f.data("pid")}else{if(h=="response"){g+="?plurk_id="+f.data("pid")+"&response_id="+f.data("rid")}}}(new PopWindow({url:g,width:650})).show();j.hide()}};var d=null;var a=null;b(document).ready(function(){b(document).on("mousemove","a.name, a[data-uid]",function(f){if(a!=this&&(!e||e.target!=this)&&b(this).attr("data-uid")!==undefined){var g=b(this);clearTimeout(d);a=this;d=setTimeout(function(){(new InfoOverlay(g.attr("data-uid"))).showFrom(a)},400);g.on("mouseout.infoOverlay",function(){g.off("mouseout.infoOverlay");a=null})}})})})(jQuery);B_ID=1;B_DATA={};getBD=function(a){return B_DATA[a.id]};PlurkBlock=AJS.Class({init:function(a){AJS.update(this,a);this.is_rendered=false;this.id=B_ID++;B_DATA[this.id]={}},removeRender:function(){this.is_rendered=false;jQuery(getBD(this).div_cnt).remove();jQuery(getBD(this).div_bg).remove();getBD(this).div_cnt=null;getBD(this).div_bg=null;if(this.plurks){try{Tracks.removePlurksFromTracks(this.plurks)}catch(a){}AJS.map(this.plurks,function(b){Plurks.cleanPlurk(b.id)})}},_renderBlock:function(){var d=AJS.DIV({c:"div_one_line"});var a,c;var b=AJS.DIV(a=AJS.DIV({c:"div_inner"}),c=AJS.DIV({c:"div_bottom"}));return[d,b,c]},renderBlock:function(d,a){this._render(a);var c=getBD(this).div_bg;var b=getBD(this).div_cnt;if(a){c.style.visibility="hidden";b.style.visibility="hidden"}AJS.ACN(T_cnt,b);AJS.ACN(T_bg,c);this.setLeft(d);this.l_offset=d},_render:function(){var c=this._renderBlock();var g=this._renderBlock();var d=this.type;if(this.plurks&&this.is_small&&this.plurks.length<=2){d+=" small_hh"}var a=B_DATA[this.id].div_bg=AJS.DIV({c:"block_bg "+d});var b=B_DATA[this.id].div_cnt=AJS.DIV({c:"block_cnt "+d});AJS.ACN(a,c[0],c[1]);AJS.ACN(b,g[0],g[1]);var e=c[2];this.is_rendered=true;if(AJS.isIn(this.type,["day","day_start"])){AJS.ACN(e,AJS.SPAN({c:"bottom_start",s:"left:0;"},this.bottom_start));AJS.addClass(c[1],"day_bg");var f=46;if(this.bottom_start.indexOf("ago")!=-1||(_("Yesterday")==this.bottom_start)){f=70}AJS.setWidth(c[0],f);AJS.setWidth(c[1],f)}AJS.addClass(g[1],"div_holder");AJS.addClass(c[1],"div_holder")},_rankPlurks:function(f,d){var h=f.response_count!=f.responses_seen;var e=d.response_count!=d.responses_seen;if(h&&!e){return -1}else{if(!h&&e){return 1}}if(Plurk.isPrivate(f)&&!Plurk.isPrivate(d)){return -1}if(Plurk.isResponded(f)&&!Plurk.isResponded(d)){return -1}var c=f.response_count;var g=d.response_count;if(c>g){return -1}else{if(c<g){return 1}}return 0},renderPlurks:function(o,l){if(!this.plurks){return}var m=this;var n=getBD(this).div_cnt;var e=jQuery(getBD(this).div_bg).find(".div_bottom");var p=n.offsetWidth/this.interval;var f=this.date_start;var q=this.date_end;this.plurks.sort(this._rankPlurks);for(var g=0;g<this.plurks.length;g++){var d=this.plurks[g];if(PlurkBlock.isWithinBounds(d,f,q)){var a=Plurks.renderPlurk(d,false);if(a==null){continue}a.style.visibility="hidden";AJS.ACN(n,a);getPD(a).block=m;var s=(Math.abs(d.posted.getTime()-f.getTime()))/60/1000;var j=(s*p);AJS.setLeft(a,j);var h=l+j;var b=Tracks.findTrack(h,d,n);var c=Tracks.getTopOffset(n,b);jQuery(a).css("top",c+"%");a.style.visibility="visible";if(o){Tracks.tracks[b].splice(0,0,a)}else{Tracks.tracks[b].push(a)}Tracks.plurks[d.id]=b;Plurks.highlightPlurk(d.id);var r=Cal.convertToLocal(d.posted);e.append('<div class="bottom_start" style="left:'+j+'px;">'+Cal.formatHour(r.getHours(),r.getMinutes())+"</div>")}}},setLeft:function(a){this.l_offset=a;AJS.setLeft(getBD(this).div_cnt,getBD(this).div_bg,a)},incLeft:function(b,c){var e=b;var a=e.div_cnt.offsetLeft+c+"px";e.div_cnt.style.left=a;e.div_bg.style.left=a;return a},setVisibility:function(a){if(a){a="visible"}else{a="hidden"}getBD(this).div_bg.style.visibility=a;getBD(this).div_cnt.style.visibility=a},setTop:function(a){if(a>0){a=0}jQuery(getDB(this).div_cnt).css("top",a+"%")}});PlurkBlock.zIndex=1000;PlurkBlock.isWithinBounds=function(a,c,b){return a.posted.getTime()>=b.getTime()&&a.posted.getTime()<=c.getTime()};PlurkBlock.toggleHighlight=function(b,a){if(AJS.isIe()){var d=a==1&&500||-500;var c=AJS.getParentBytc(b,"div","block_cnt");c.style.zIndex+=d}};BlockGenerator={generate:function(c,e){var d=this;var g=[];var h=[];var f=null;var b=null;AJS.map(c,function(j){var m=new Date(j.posted);m.setHours(23);m.setMinutes(59);m.setSeconds(59);var l=new Date(m);l.setHours(0);l.setMinutes(0);l.setSeconds(0);if(!Cal.sameDate(f,m)){b={date_start:m,date_end:l,plurks:[]};f=m;h.push(b)}b.plurks.push(j)});AJS.map(h,function(n){var o="day_start";if(n.plurks.length>0){var m=Cal.formatMonthDate(n.date_start);if(e){block=new PlurkBlock({type:o,bottom_start:m,plurks:n.plurks,date_start:n.date_start,date_end:n.date_end,interval:1440});block.plurks=null;g.push(block)}else{e=true}var l=[];AJS.map(n.plurks,function(p){var q=p.posted.getHours();if(!l[q]){l[q]=[]}l[q].push(p)});var j=false;if(n.plurks.length<=3){j=true}AJS.rmap(l,function(r,p){if(!r){return}var t;var s=new Date(r[0].posted);s.setMinutes(59);s.setSeconds(59);s.setMilliseconds(59);var u=new Date(r[0].posted);u.setMinutes(0);u.setSeconds(0);u.setMilliseconds(0);if(r.length<=2){var q=Cal.convertToLocal(s);t=new PlurkBlock({type:"hh_mm",bottom_start:Cal.formatHour(q.getHours()+1),bottom_end:Cal.formatHour(q.getHours()),plurks:r,interval:60,date_start:s,date_end:u,is_small:j});g.push(t)}else{t=d.generateMinuteBlocks(s,r,j);g=g.concat(t)}})}});var a=null;AJS.map(g,function(j){if(a){if(a.bottom_end==j.bottom_start){a.bottom_end=""}}a=j});return g},max_hour_count:3,max_ss_count:4,_generateOptimalBlocks:function(o,b,q,p,s,t){var r=[];var f=true;var j=this.max_ss_count;var l=this.max_hour_count;var a=function(x){var u=[];AJS.map(p,function(z){if(PlurkBlock.isWithinBounds(z,o,b)){u.push(z)}});var y=new PlurkBlock({type:x,interval:q,plurks:u,date_start:new Date(o),date_end:new Date(b),is_small:s});if(t){y.bottom_start="";y.bottom_end=""}else{var v=Cal.convertToLocal(o);var w=Cal.convertToLocal(b);y.bottom_start=Cal.formatHour(v.getHours(),v.getMinutes());y.bottom_end=Cal.formatHour(w.getHours(),w.getMinutes())}return y};var e=this.intervalCount(p,o,b);if(e>0&&e<=l){r.push(a("hh_mm"))}else{if(t&&e>0&&e<=j){var c="ss";r.push(a(c))}else{if(e>0&&e<=l&&q<=1){var c="mm";r.push(a(c))}else{if(t&&e>0&&q<=1){var c="ss";r.push(a(c))}else{if(e>0){var h=q/2;var g=2;if(h==2.5){g=5;h=1}else{if(h==0.5){g=3;h=20;t=true}}var n=new Date(o);for(var m=0;m<g;m++){var d=new Date(n);this._incInterval(d,h,t);r=r.concat(this._generateOptimalBlocks(new Date(n),new Date(d),h,p,s,t));n=d}if(t&&h==20){AJS.map(r,function(x,w){if(w==0){var u=Cal.convertToLocal(x.date_start);x.bottom_start=Cal.formatHour(u.getHours(),u.getMinutes())}else{if(w==r.length-1){var v=Cal.convertToLocal(b);x.bottom_end=Cal.formatHour(v.getHours(),v.getMinutes())}else{x.bottom_end=""}}})}}}}}}return r},_incInterval:function(b,a,c){if(c){b.setSeconds(b.getSeconds()-a)}else{b.setMinutes(b.getMinutes()-a)}return b},generateMinuteBlocks:function(e,d,a){var g=[];var f=new Date(e);for(var c=0;c<3;c++){f=new Date(f);var b=new Date(f);b.setMinutes(b.getMinutes()-20);g=g.concat(this._generateOptimalBlocks(f,b,20,d,a,false));f.setMinutes(f.getMinutes()-20)}return g},intervalCount:function(c,d,b){var a=0;AJS.map(c,function(e){if(PlurkBlock.isWithinBounds(e,d,b)){a++}});return a}};function cometNewPlurksCallback(a,b){jQuery.each(b,function(d,c){if(c.plurk_type>=4&&!GLOBAL.session_user.post_anonymous_plurks){return}PlurkMetaData.annotate(c);c.user_id=SiteState.getSessionUser().id});Poll.fetchedPlurks(b)}function cometNewResponsesCallback(b,a){jQuery.each(a,function(g,h){Utils.arrayUpdate(USERS,h.user);var f=h.response;var d=h.plurk;var j=h.plurk_id;if(d.plurk_type>=4&&!GLOBAL.session_user.post_anonymous_plurks){return}PlurkMetaData.annotate(d);TimeLineCache.addPlurk(d);if(d.is_unread==2){return}Plurk.updatePlurk(d,{is_unread:1});var e=ChatPoll.chatResponse(f,d,user);if(!e){var c=ResponseCache.getFromCache(j);if(c){ResponseCache.addToCache(j,[f])}Poll.fetchedResponses([d])}})}Tracks={offset_top:5.5,offset_plurks:11.6883,max_tracks:8,init:function(){var a=Tracks.tracks=[];for(var b=0;b<Tracks.max_tracks;b++){a[b]=[]}Tracks.plurks={};if(!SiteState.canEdit()){Tracks.offset_top=5.5}},removePlurksFromTracks:function(a){if(!a){return true}var b=this;AJS.map(a,function(d){var f=b.plurks[d.id];var c=b.tracks[f];if(c){var g=d.id;var e=AJS.getIndex(d.id,c,function(h){if(g==getPD(h).obj.id){return true}return false});c.splice(e,1)}})},getTopOffset:function(b,a){return(b.offsetTop+this.offset_top)+(a*this.offset_plurks)},findTrack:function(g,d,j){var h=this;var e=this.plurks[d.id];if(e!=undefined){return e}var l=(d.content).match(/ex_link/ig);var a=(d.content).match(/meta/ig);l=(l)?l.length:0;a=(a)?a.length:0;if(d.response_count>9||l>1||a>0){if(this.canBeInserted(this.tracks[0],g)){return 0}if(this.canBeInserted(this.tracks[2],g)){return 2}}for(var f=0;f<this.tracks.length-1;f+=2){if(f==0&&Math.random()<0.6){continue}var c=this.tracks[f];if(c.length==0||this.canBeInserted(c,g)){return f}}for(var f=1;f<this.tracks.length-2;f+=2){var c=this.tracks[f];if(c.length==0||this.canBeInserted(c,g)){return f}}var b=Math.floor(Math.random()*(this.tracks.length-1));return b},canBeInserted:function(a,c){var d=AJS.getLast(a);try{var b=d.offsetWidth+AJS.absolutePosition(d).x+20}catch(f){return true}if(navigator.userAgent.toLowerCase().indexOf("khtml")!=-1){b+=25}if(b<c){return true}return false}};Cal={am_pm:true,ms_per_day:24*60*60*1000,monthShort:{1:_("Jan"),2:_("Feb"),3:_("Mar"),4:_("Apr"),5:_("May"),6:_("Jun"),7:_("Jul"),8:_("Aug"),9:_("Sep"),10:_("Oct"),11:_("Nov"),12:_("Dec")},leadingZero:function(a){if(a<10){a="0"+a}return a},sameDate:function(b,a){if(!b||!a){return false}if(b.getDate()==a.getDate()&&b.getMonth()==a.getMonth()&&b.getYear()==a.getYear()){return true}return false},dayDiff:function(e){var d=new Date();var c=new Date(e);d.setHours(0);d.setMinutes(0);c.setHours(0);c.setMinutes(0);var b=c.getTime()-d.getTime();var a=Math.round(b/this.ms_per_day);if(a==-1&&d.getDate()==c.getDate()){return 0}return a},addToDate:function(b,a,c){var d=b.getTime();var f=b.getTimezoneOffset()*60*1000;var e=d+f;if(a){e+=a*60*60*1000}if(c){e+=c*60*1000}return new Date(e)},convertToLocal:function(c,b){var a=SiteState.getPageUser();if(!a){a=SiteState.getSessionUser()}if(!a||!a.timezone_hh){return c}return Cal.addToDate(c,a.timezone_hh,a.timezone_mm)},formatMonthDate:function(c){var b=this.dayDiff(c);if(b==0){return _("Today")}else{if(b==-1){return _("Yesterday")}else{if(b<0&&b>=-2){return Math.abs(b)+" "+_("days ago")}}}var d=c.getYear();var e=c.getMonth()+1;var a=c.getDate();if((new Date()).getYear()==d){if(window.LANG&&(window.LANG.indexOf("zh_")==0||window.LANG=="ja")){return e+"月"+a+"日"}else{return this.monthShort[e]+" "+a}}else{d+=1900;if(window.LANG&&(window.LANG.indexOf("zh_")==0||window.LANG=="ja")){return d+"年"+e+"月"+a+"日"}else{return this.monthShort[e]+" "+a+", "+d}}},formatYearMonth:function(a,b){if(window.LANG&&(window.LANG.indexOf("zh_")==0||window.LANG=="ja")){return a+"年"+b+"月"}else{return this.monthShort[b]+", "+a}},formatYear:function(a){if(window.LANG&&(window.LANG.indexOf("zh_")==0||window.LANG=="ja")){return a+"年"}else{return a}},formatMonth:function(a){if(window.LANG&&(window.LANG.indexOf("zh_")==0||window.LANG=="ja")){return a+"月"}else{return this.monthShort[a]}},formatHour:function(a,b){if(!b){b=0}if(a==-1){a=23}return this.formatTime(a,b)},formatTime:function(c,e){var a=true;if(SiteState.getSessionUser()&&SiteState.getSessionUser().timeformat==0){a=false}if(!a){if(c==24){c="00"}return this.leadingZero(c)+":"+this.leadingZero(e)}else{var b="am";if(c==12){b="pm"}if(c>12){c-=12;b="pm"}if(c==0&&b=="am"){c=12}var d="";if(e){d=":"+this.leadingZero(e)}return c+d+b}},formatPrettyDate:function(c){var d=c.getFullYear();var b=c.getDate();var a=this.monthShort[c.getMonth()+1]+" "+b+", "+d;return a}};var T_cnt;var T_bg;var T_user_stylesheet;TimeLine={init:function(a){this.blocks=[];this.plurks=[];this.active_blocks=[];this.getting_plurks=false;this.move_tl=false;if(!this.mode){this.mode="all"}if(!a){this.offset=0;this.real_end_offsets={};this.fetch_count={};this.highlight_ids={}}this.$timeline_holder=jQuery("#timeline_holder");this.content_inner=this.$timeline_holder.get(0);AJS.RCN(this.content_inner,null);this.top=AJS.$("top_bar");this.renderTLContent();this.renderTLBackground();this.setCreature(SiteState.getPageUser()&&SiteState.getPageUser().creature||1);this.renderBottomLine();this.renderDynamicLogo();var b=AJS.$b(this.resize,this);b();if(!this.inited){AJS.AEV(window,"resize",b);AJS.AEV(document,"mousedown",this.moveTimeline);var c=function(){TimeLine.move_tl=false;if(!TimeLine.sliding_tl){TimeLine.showBigMedia()}};AJS.AEV(document,"mouseup",c);jQuery(window).ready(function(){TimeLine.resize()})}TimeShow.init();jQuery(T_cnt).on("mousedown",this._initMove);jQuery(T_cnt).on("mousemove",this.moveTimeline);this.setExpandFully(!SiteState.canEdit());this.str_private_timeline=_("This timeline is set to private.");if(InfoOverlay.info_view){InfoOverlay.hide()}this.inited=true;this.showButton("right",true)},santa_redlight:function(b){var a=TimeLine;clearTimeout(window.santa_tm);if(window.santa_run){a.santa_run(false);window.santa_tm=setTimeout(function(){a.santa_run()},10000)}},santa_run:function(b){var a=this;if(!window.$santa){window.$santa=jQuery("#dynamic_logo");window.santa_repeat=true}if(window.santa_int){window.$santa.removeClass("run");clearInterval(window.santa_int)}if(b===false){return}window.$santa.addClass("run");window.santa_int=setInterval(function(){if(!window.santa_run){a.santa_run(false);return}var c=window.$santa;var d=Math.round(c.css("right").slice(0,-2)*1)+10;if(d>window.document.body.scrollWidth+390){a.santa_redlight();d=-300;window.santa_repeat=false}if(!window.santa_repeat&&d>10){window.santa_run=false}c.attr("style","right:"+d+"px !important")},1000)},setCreature:function(h,b){var e=jQuery("#creature");if(!e){return}var j=this;var a=new Date();var l=a.getYear()+1900;var f=a.getMonth()+1;var m=a.getDate();var d=a.getHours();var c=a.getMinutes();if(f==12&&m>=23&&m<=26){if(Math.floor(Math.random()*100)<5){e.attr("src","//s.plurk.com/0e89797a0a1c524c47c602031a49f99d.png").attr("height",180)}else{e.attr("src","//s.plurk.com/035601f3e4328e938b505dab3cd7743e.gif").attr("height",180)}if(m==24&&document.cookie.indexOf("psnow")<0){setTimeout(function(){jQuery(".snowflake:first").click()},5000)}return}if(f==12&&((m==9&&d>=17)||(m==10))&&OpenX&&OpenX.country_code=="TW"){e.attr("src","//s.plurk.com/5bf9d9a9ab773bbd0ef10de64b7fa2b0.png").attr("height",200);return}var g=GLOBAL.session_user?GLOBAL.session_user.creature:null;if(g){e.attr("src",g.src);if(g.h){e.height=g.h}}else{if(!this._creature_widths[h]){h=8}e.attr("src",$static_path("/static/creatures/big/"+h+".png"))}},showSpider:function(){var b=jQuery("#timeline_holder");var c='<div id="spider_cnt"><div id="spider_left"></div><div id="spider_right"></div><div id="spider_billboard"><span>{{billboardText}}</span>';"</div></div>";var a=jQuery(Handlebars.compile(c)({billboardText:_("Come back to clean up the spider webs!")}));if(TimeLine.error=="NoReadPermissionError"){a.find("#spider_billboard").remove()}b.append(a)},setExpandFully:function(a){TimeLine.expand_fully=false;BlockGenerator.max_hour_count=2;BlockGenerator.max_ss_count=2},_initMove:function(a){var b=AJS.getEventElm(a);window.focus();if(AJS.getParentBytc(b,"div","plurk")||AJS.getParentBytc(b,"div","plurk_box")){return true}if(TimeLine.move_disabled){return false}if($dp.holder_shown){Plurks.removeCurrentOpen()}TimeLine.move_tl=true;TimeLine.last_mouse_pos=AJS.getMousePos(a);TimeLine.content_inner.focus();TimeLine.hideBigMedia();if(jQuery("body").hasClass("timeline")&&window.scrollTop!=0){window.scrollTo(0,0)}},showBigMedia:function(){AJS.map(AJS.$bytc("img","big_image",AJS.$("timeline_holder")),function(a){AJS.setVisibility(a,true);AJS.removeClass(a.parentNode,"big_image_border")});TimeLine.big_media_hidden=false},hideBigMedia:function(){AJS.map(AJS.$bytc("img","big_image",AJS.$("timeline_holder")),function(a){AJS.setVisibility(a,false);AJS.addClass(a.parentNode,"big_image_border")});TimeLine.big_media_hidden=true},_prefetch_check:null,moveTimeline:function(f){var d=TimeLine;if(d.blocks.length==0){return}var b=AJS.getMousePos(f);if(f.buttons===0||f.which===0){d.move_tl=false}if(d.move_tl){d.santa_redlight();var a=d.last_mouse_pos;if(b.x!=a.x){var c=(b.x-a.x);d.scrollBack(c);AJS.setSingleTimeout("prefetchCheck",d.prefetchCheck,150);d.last_mouse_pos=b}}else{if(b.x<75&&b.y>22){d.showButton("left",true)}else{d.showButton("left",false)}}},scrollBack:function(l){var j=TimeLine;if(tl_banana.enable&&(!tl_banana.tID)){tl_banana.tID=window.setTimeout(tl_banana.checkImpress,300)}if(InfoOverlay.info_view){InfoOverlay.hide()}var f=AJS.getFirst(j.active_blocks);var e=AJS.getFirst(j.blocks);var h=AJS.getLast(j.active_blocks);var g=AJS.getLast(j.blocks);if(f==e&&l>0){var b=AJS.absolutePosition(getBD(f).div_bg).x;if(b+l>25){l=25-b}}if(h==g&&l<0){var a=AJS.absolutePosition(getBD(g).div_bg).x;if(a+l<-50){l=-50-a}}if(l==0){return false}for(var d=0;d<j.active_blocks.length;d++){var c=j.active_blocks[d];var m=getBD(c);if(getBD(c).div_bg){c.incLeft(m,l)}}if(j.active_blocks.length>0){j.startChecks();j.endChecks()}},moveToBlock:function(d){if($dp.holder_shown){Plurks.removeCurrentOpen()}var l=TimeLine;l.move_disabled=true;AJS.map(l.active_blocks,function(n){n.removeRender()});l.showLoading();l.active_blocks=[];var h=10;var a=l.blocks;var m=[];if(d=="back"){var f=a.length;var j=f-9;if(j<0){j=0}m=a.slice(j,f)}else{m=a.slice(0,10)}AJS.map(m,function(n){l.active_blocks.push(n);n.renderBlock(h);n.renderPlurks(false,h);h+=getBD(n).div_bg.offsetWidth});l.hideLoading();if(d=="back"&&l.blocks.length>5){var b=getBD(AJS.getLast(l.blocks));var g=AJS.getWindowSize().w;for(var e=0;e<=10;e++){if(b.div_cnt){var c=b.div_cnt.offsetLeft+b.div_cnt.offsetWidth+150;if(c<g){break}}l.scrollBack(-100)}}l.move_disabled=false},slideBack:function(c,b,d,a){if(c==10){if($dp.holder_shown){Plurks.removeCurrentOpen()}TimeLine.hideBigMedia();TimeLine.sliding_tl=true;if(TinyEmoAdder.$panel){TinyEmoAdder.remove()}if(EmoAddHelper.$attachedTimelineJQIMG){EmoAddHelper.removeAddOverlayTimeline()}}c--;if(c==0){TimeLine.sliding_tl=false;TimeLine.showBigMedia()}if(c!=0){TimeLine.scrollBack(b);AJS.setSingleTimeout("slideBack",AJS.$p(TimeLine.slideBack,c,b,d,a),2);return}if(d=="right"){TimeLine.prefetchCheck()}if(AJS.isFunction(a)){a()}},showButton:function(h,b){var e=TimeLine;if(!e["btn_"+h]){var f=h=="left"&&40||-40;var c="cmp_arrow_"+h+" pif-arrow-"+h;var c=AJS.DIV({c:c});var g=e["btn_"+h]=AJS.DIV({c:"browse_button"},c);AJS.AEV(c,"mousedown",AJS.$p(this.slideBack,10,f,h));var d;AJS.ACN(g,d=jQuery('<div class="cmp_back_to_today pif-arrow-left">Begin</div>')[0]);AJS.AEV(d,"click",AJS.$p(this.moveToBlock,"front"));AJS.ACN(AJS.$("layout_content"),g);var a=AJS.$("creature");if(a.height>120){AJS.setTop(g,220)}if(h=="right"){AJS.setRight(g,10)}else{AJS.setLeft(g,10)}}if(b){if(e.active_blocks.length>0){AJS.showElement(e["btn_"+h])}}else{if(!b){if(!SiteState.canEdit()&&h=="right"){return false}AJS.hideElement(e["btn_"+h])}}},prefetchCheck:function(){var c=TimeLine;if(Poll.getting_plurks||Poll.mode=="new"){return}if(c.blocks.length>1){var b=AJS.getLast(c.blocks);if(b.is_rendered){var a=getBD(b).div_cnt;if((a.offsetLeft-100)<AJS.getWindowSize().w){AJS.setSingleTimeout("getPlurks",c.getPlurks,300)}}}},end_offset:25,endChecks:function(){var g=TimeLine;var l=g.active_blocks;var d=g.active_blocks.length-1;var a,j,c;var f=g.getCurActive(d);if(!f){return}a=f[0];j=f[1];c=f[2];if(!j){return}var b=T_cnt.offsetWidth+this.end_offset;if(j.offsetLeft>b){if(g.active_blocks.length<2){return true}a.removeRender();g.active_blocks.splice(d,1)}else{if(j.offsetWidth+j.offsetLeft<b){if(c!=(this.blocks.length-1)){var h=this.blocks[c+1];j=getBD(this.active_blocks[this.active_blocks.length-1]).div_bg;this.active_blocks.push(h);if(!h.is_rendered){h.renderBlock(0);var e=j.offsetLeft+j.offsetWidth;h.setLeft(e);h.renderPlurks(false,e);h.setVisibility(true)}}}}},start_offset:-25,startChecks:function(){var f=this;var d,h,g;var c=f.getCurActive();d=c[0];h=c[1];g=c[2];if(!h){return}if((h.offsetLeft+h.offsetWidth)<this.start_offset){if(f.active_blocks.length<2){return true}d.removeRender();f.active_blocks.splice(0,1)}else{if(h.offsetLeft>this.start_offset){if(g!=0){var e=this.blocks[g-1];h=getBD(this.active_blocks[0]).div_bg;if(e){this.active_blocks.splice(0,0,e);if(!e.is_rendered){e.renderBlock(0,true);var a=getBD(e).div_bg;var b=h.offsetLeft-a.offsetWidth;e.setLeft(b);e.renderPlurks(true,b);e.setVisibility(true)}}}}}},getCurActive:function(a){var a=a||0;var b=TimeLine.active_blocks[a];if(!b){return null}return[b,getBD(b).div_bg,AJS.getIndex(b,TimeLine.blocks)]},renderTLContent:function(){AJS.ACN(this.content_inner,T_cnt=AJS.DIV({id:"timeline_cnt"}));MouseWheel.attachTLScroll(T_cnt);TouchEvent.attachTLScroll(T_cnt)},renderTLBackground:function(){AJS.ACN(this.content_inner,T_bg=AJS.DIV({id:"timeline_bg"}));AJS.ACN(T_bg,AJS.DIV({id:"bottom_line"}))},check_offsets:true,renderBlocks:function(o){var h=this;var c=AJS.getLast(h.blocks);var b=true;if(c){var e=c.date_start;var n=c.date_end;var f=AJS.getFirst(o);if(f&&Cal.sameDate(f.posted,n)){b=false}var l=[];AJS.map(o,function(p){if(PlurkBlock.isWithinBounds(p,e,n)){l.push(p)}});if(l.length>0){o=c.plurks.concat(o);this.blocks.pop();if(c.is_rendered){this.active_blocks.pop()}AJS.map(c.plurks,function(p){Tracks.plurks[p.id]=null});c.removeRender()}}c=AJS.getLast(this.blocks);var a=BlockGenerator.generate(o,b);this.blocks=this.blocks.concat(a);var g=10;var d=c&&c.is_rendered;if(d){var j=getBD(c).div_bg;g=j.offsetLeft+j.offsetWidth}var m=h.active_blocks.length;if(m==0||(m<10&&(!c||c&&d))){AJS.map(a,function(q,p){if(p==10){return true}h.active_blocks.push(q);q.renderBlock(g);q.renderPlurks(false,g);g+=getBD(q).div_bg.offsetWidth})}},_sortPlurks:function(d,c){var f=d.posted.getTime();var e=c.posted.getTime();if(f<e){return 1}else{if(f==e){return 0}else{return -1}}},addPlurks:function(b){AJS.map(b,function(c){TimeLine.setHightlight(c.id)});var a=b.concat(TimeLine.plurks);TimeLine.reset(true);TimeLine.plurks=a;TimeLine.renderBlocks(a);DisplayOptions.show()},renderEmpty:function(){var c=TimeLine;var a;if(SiteState.canEdit()&&!Poll.mode=="unread"){a=_("You can start plurking by using the input field below.<br /><br/>Happy plurking!")}else{if(TimeLine.error=="NoReadPermissionError"){a=this.str_private_timeline;a+='<br /><img width=250 src="//s.plurk.com/cd5301b20c89a26adefd95c4bf5efa20.png">';jQuery("#spider_billboard").remove()}else{a=_("This timeline is empty.");if(Poll.mode=="new"){var b='<a href="javascript:void(0)" onclick="return Poll._viewAll()">'+_("View all plurks")+"</a>";a+="<br />"+b}}}c.renderText(a)},renderText:function(a){AJS.ACN(T_cnt,AJS.setHTML(AJS.DIV({id:"empty_timeline_bg"}),a));AJS.ACN(T_cnt,AJS.setHTML(AJS.DIV({id:"empty_timeline_fg"}),a))},removeEmpty:function(){AJS.removeElement("empty_timeline_bg");AJS.removeElement("empty_timeline_fg")},renderBottomLine:function(){},_creature_widths:{1:117,2:85,3:124,4:180,5:110,6:103,7:98,8:95,9:75,10:100,11:83,12:95},renderDynamicLogo:function(){var c=AJS.DIV({id:"dynamic_logo"});var a=SiteState.getPageUser()&&SiteState.getPageUser().creature||1;var b=PNGIMG({id:"creature"});AJS.ACN(c,b);AJS.ACN(this.content_inner,c);this.setCreature(a)},resize:function(){var a=GLOBAL.session_user;var c=GLOBAL.page_user;var b=386;if(a&&c&&a.uid===c.uid){var f=jQuery(window).height();b=f-149-44;if(b<386){b=386}else{if(b>820){b=820}}}jQuery("#timeline_holder").css("height",b);b=jQuery("#timeline_holder").height();jQuery("#timeline_resize_css").remove();jQuery("head").append('<style id="timeline_resize_css">#timeline_cnt .plurk .text_holder {max-height:'+b*0.0829+"px;}</style>");if(AJS.getWindowSize().h<600){AJS.hideElement(AJS.$bytc("div","time"))}else{AJS.showElement(AJS.$bytc("div","time"))}Plurks.relayoutResponseBox();var e=jQuery("#plurk-dashboard");var d=e.width();if(d<750){e.addClass("narrow")}else{e.removeClass("narrow")}},insertPlurks:function(b){var c=TimeLine;var a=[];AJS.map(b,function(d){if(SiteState.getPlurkUser(d)){a.push(d)}if(AJS.isString(d.posted)){d.posted=new Date(d.posted)}});a.sort(c._sortPlurks);c.plurks=c.plurks.concat(a);c.plurks.sort(c._sortPlurks);c.renderBlocks(a);if(c.plurks.length==0){c.renderEmpty()}else{c.removeEmpty()}AJS.setSingleTimeout("endChecks",c.endChecks,100);c.resize()},_plurksFetched:function(c,d){var a=[];AJS.map(c,function(e){a.push(e.owner_id)});a.push(13767068);var b=function(){TimeLine.__plurksFetched(c,d)};PlurkAdder.fetchUsersIfNeeded(a,b,"gp")},__plurksFetched:function(b,c){var a=TimeLine;AJS.map(b,function(d){if(AJS.isString(d.posted)){d.posted=new Date(d.posted)}Poll.setLastPlurk(d.posted)});if(b.length==0){a.offset=null}else{if(!b.error){if(b.length>0){a.offset=AJS.getLast(b).posted}else{a.offset=null}a.insertPlurks(b)}else{TimeLine.error=b.error}}a.getting_plurks=false;a.fetched_plurks=true;AJS.setSingleTimeout("prefetchCheck",a.prefetchCheck,150);if(a.plurks.length==0){a.renderEmpty()}if(AJS.isFunction(c)){c()}a.hideLoading()},insertAds:function(c){var h=c.length;if(h<5){if(SiteState.getSessionUser()&&SiteState.getSessionUser().beta&&console){console.log("[native] ads not inserted (plurks count: "+h+" < 5)")}return}var f;for(f=0;f<Math.min(15,h);f++){if(c[f].is_ad){return}}var m=Math.floor(Math.random()*h);if(m<2){m=2}var b=null;if(tl_banana&&tl_banana.enable&&Math.random()<0.5){var d=Math.random();var g;for(g in tl_banana.plurk){if(d<tl_banana.plurk[g].prob){break}}var e=tl_banana.plurk[g].data;e.id=e.plurk_id=e.plurk_id+1;if(SiteState.getSessionUser()&&SiteState.getSessionUser().beta&&console){console.log("[ads] prepared",g,"data",e)}b=tl_banana.clone(e)}else{if(tl_native&&tl_native.enable){var n=180;var j=Math.floor(new Date().getTime()/1000);var a=0;var l;for(l in tl_native.ads){if(tl_native.ads[l].impression+n<j){if(SiteState.getSessionUser()&&SiteState.getSessionUser().beta&&console){console.log("[native] ads inserted at pos "+m+": "+tl_native.ads[l].plurk.client)}tl_native.ads[l].impression=j;var e=tl_native.ads[l].plurk;e.id=e.plurk_id;b=tl_banana.clone(e);_gaq_push(["_trackEvent","TimelineNativeAds","impression",tl_native.ads[l].plurk.client]);break}if(a==0||tl_native.ads[l].impression<a){a=tl_native.ads[l].impression}}if(b==null){tl_native.shuffle(j);if(SiteState.getSessionUser()&&SiteState.getSessionUser().beta&&console){console.log("[native] no available ads for insertion, need "+(n+a-j)+"s to resume delivery")}}}}if(b){if(typeof(c[m].posted)=="string"){c[m].posted=new Date(c[m].posted)}b.posted=new Date(c[m].posted.getTime()+10000);c.splice(m,0,b)}},getPlurks:function(e){var c=TimeLine;if(c.getting_plurks||c.offset==null){return false}c.getting_plurks=true;if(c.plurks.length>0){c.showLoadingBlock()}var f=function(g){if(!(g.constructor==Array)&&g.plurks){g=g.plurks}if(d.error){return c._plurksFetched(d)}c.insertAds(g);c._plurksFetched(g,e)};var d={user_id:SiteState.getPageUser().uid};if(c.offset){d.offset=c.offset.toISOString()}if(c.user_ids){d.user_ids=JSON.stringify(c.user_ids)}if(c.private_only){d.only_private=1}if(c.favorite_only){d.only_favorite=1}if(c.replurked_only){d.only_replurked=1}if(c.responded_only){d.only_responded=1}if(c.mentioned_only){d.only_mentioned=1}if(TimeLineCache.inCache(d)){setTimeout(function(){return f(TimeLineCache.get(d))},30);return false}var b=AJS.loadJSON("/TimeLine/getPlurks");if(c.plurks.length>0){b.addCallback(c.removeLoadingBlock)}b.addCallback(function(g){if(!g.error){if(g.constructor==Array){TimeLineCache.set(d,g)}else{AJS.update(USERS,g.replurkers);TimeLineCache.set(d,g.plurks)}}});b.addCallback(f);var a=SiteState.getPageUser();if(a&&a.public_view){d.public_view=1}b.sendReq(d)},excludeUser:function(a){return false},loading_img:jQuery('<img src="//s.plurk.com/37d72576e5db79da64d0bc318c3eef73.gif" style="margin:0 auto;">')[0],showLoadingBlock:function(){var c=TimeLine;var b=AJS.getLast(c.active_blocks);if(b){var a=getBD(b).div_bg;c.loading_div=AJS.DIV({c:"loading_div"},c.loading_img);AJS.ACN(a,c.loading_div)}},removeLoadingBlock:function(){var a=TimeLine;if(a.loading_div){AJS.removeElement(a.loading_div)}},showLoading:function(a){if(a==undefined){a=true}var d=TimeLine;var b=AJS.DIV({id:"div_loading"});if(a){AJS.ACN(b,AJS.DIV({c:"cnt"},d.loading_img))}var c=AJS.$("timeline_holder");AJS.setHeight(b,c.offsetHeight);AJS.appendToTop(c,b);TimeShow.displayTime(null);jQuery("#timeline_bg *").css("display","none");jQuery("#bottom_line").css("display","block");AJS.map(AJS.$bytc("div","plurk"),function(e){AJS.setVisibility(e,false)})},hideLoading:function(){var a=AJS.$("div_loading");jQuery("#timeline_bg *").css("display","block");AJS.map(AJS.$bytc("div","plurk"),function(b){AJS.setVisibility(b,true)});DisplayOptions.show();AJS.removeElement(a);TimeLine.removeLoadingBlock()},setHightlight:function(a){this.highlight_ids[a]=true},getHighestId:function(){var a=0;if(TimeLine.plurks){AJS.map(TimeLine.plurks,function(b){if(b.id>a){a=b.id}})}return a},rerender:function(){TimeLine.showLoading();var a=[];a=a.concat(TimeLine.plurks);TimeLine.reset(true);TimeLine.insertPlurks(a)},reset:function(a){Plurks.removeCurrentOpen();AJS.map(this.active_blocks,function(c){c.removeRender()});var b=AJS.$("display_options_holder");if(b){AJS.hideElement(b);AJS.ACN(AJS.getBody(),b)}discardElement(AJS.$("timeline_cnt"));discardElement(T_bg);AJS.ACN(T_bg,AJS.DIV({id:"bottom_line"}));TimeLine.init(a);Tracks.init();if(b){AJS.ACN(AJS.$("timeline_cnt"),b);AJS.showElement(b)}},hideTab:function(a){AJS.removeElement(AJS.$bytc("li",a));var b=AJS.getRequest("/TimeLine/hideTab");b.sendReq({tab:a})}};TimeLineCache={cache:{},inCache:function(a){return this.cache[this.cacheKey(a)]!=undefined},get:function(a){return this.cache[this.cacheKey(a)]},set:function(c,b){var a=this.cacheKey(c);this.cache[a]=b},addToCache:function(c,a){var d=this.cache[c];if(d){var b=AJS.map(d,function(e){if(e.plurk_id==a.plurk_id){return true}});if(!b){d.splice(0,0,a)}}},addPlurk:function(a){this.addToCache("all",a);if(Plurk.isPrivate(a)){this.addToCache("private",a)}if(a.favorite){this.addToCache("favorite",a)}if(a.replurked){this.addToCache("replurked",a)}if(Plurk.isResponded(a)){this.addToCache("responded",a)}if(a.mentioned){this.addToCache("mentioned",a)}if(SiteState.getSessionUser().id==a.owner_id){this.addToCache("own",a)}},purge:function(a){for(k in this.cache){if(k.indexOf(a)!=-1){delete this.cache[k]}}},cacheKey:function(b){var a=[];if(b.offset){a.push(b.offset)}if(b.only_favorite){a.push("favorite")}else{if(b.only_replurked){a.push("replurked")}else{if(b.only_private){a.push("private")}else{if(b.only_responded){a.push("responded")}else{if(b.only_mentioned){a.push("mentioned")}else{if(b.user_ids){a.push("own")}else{a.push("all")}}}}}}return a.join("-")}};AJS.preloadImages("//s.plurk.com/37d72576e5db79da64d0bc318c3eef73.gif","//s.plurk.com/d5b4ebc3ad8b8ce12e80d15b69521d01.gif");Poll={last_plurk:0,disabled:false,current_data:{new_plurks:{},unread_plurks:{}},_backup_plurks:null,_backup_blocks:null,_backup_tracks:null,init:function(){var a;var d=AJS.DIV({id:"noti_np",c:"item"},a=AJS.A({href:"javascript:void(0)"},AJS.I({c:"pif-message-new"}),AJS.SPAN({id:"noti_np_text"},_("New plurks")),AJS.SPAN({id:"noti_np_count",c:"unread_generic"})));AJS.onEvent(a,"click",Poll.update);var c,b;var f=AJS.DIV({c:"item",id:"noti_re_actions"},c=AJS.A({href:"javascript:void(0)",c:"updater_link",id:"mark_all_link"},AJS.I({c:"pif-check"}),Poll._markFirst(_("Mark all as read"))),b=AJS.A({href:"javascript:void(0)",c:"updater_link"},AJS.I({c:"pif-cancel"}),Poll._markFirst(_("View all plurks"))));AJS.onEvent(b,"click",Poll._viewAll);AJS.onEvent(c,"click",Poll.markAllRead);AJS.hideElement(f);var j;var e=AJS.DIV({id:"noti_re_view",c:"item"},j=AJS.A({href:"javascript:void(0)"},AJS.I({c:"pif-message-new"}),AJS.SPAN({id:"noti_re_text"},_("View unread plurks")),AJS.SPAN({id:"noti_re_count",c:"unread_generic"})));AJS.onEvent(j,"click",Poll._renderPlurks);var g=AJS.DIV({id:"noti_re",c:"item"},e,f);var h=AJS.DIV({id:"updater"},d,g);AJS.hideElement(h);jQuery("#timeline_control_holder").append(h);if(window.TimeShow){AJS.AEV(h,"mousemove",function(){TimeShow.displayTime(null)})}},initUnreadPlurks:function(a){AJS.map(a,function(b){Poll.current_data.unread_plurks[b.id]=b});Poll.showUpdates();Poll.markRenderedUnreadPlurks(a)},markAllRead:function(){var f=false;var d=TimeLine.plurks.length;var b=Poll.counts;if(b){if(b.my>0||b.priv>0){f=true}}if(f){var a=format(_("You have private or own unread plurks. Are you sure you want to mark all as read?"),d);if(!confirm(a)){return}}var e=[];var g=[];AJS.map(TimeLine.plurks,function(h){e.push(h.plurk_id);g.push(h.id)});if(e.length>0){Poll.disabled=true;var c=AJS.getRequest("/Responses/markAllRead");c.addCallback(function(){Poll.disabled=false});c.sendReq({ids:AJS.serializeJSON(e)});AJS.map(g,function(h){Poll.setPlurkRead(h)})}Poll._viewAll();return false},setPlurkRead:function(a){if(Poll.current_data.unread_plurks[a]){delete Poll.current_data.unread_plurks[a]}Poll.showUpdates()},update:function(){Plurks.removeCurrentOpen();var b=AJS.values(Poll.current_data.new_plurks);AJS.map(b,function(c){TimeLine.setHightlight(c.id)});var a=TimeLine.plurks.concat(b);TimeLine.reset(true);TimeLine.showLoading();TimeLine.insertAds(a);setTimeout(function(){Poll.current_data.new_plurks={};TimeLine.insertPlurks(a);Poll.showUpdates();TimeLine.hideLoading()},20);return false},getUnreadCounts:function(){var a={my:0,priv:0,favorite:0,replurked:0,responded:0,mentioned:0,all:0};var b=Poll.getUnreadPlurks();AJS.map(b,function(c){if(Plurk.isPrivate(c)){a.priv+=1}if(c.favorite){a.favorite+=1}if(c.replurked){a.replurked+=1}if(c.owner_id==SiteState.getSessionUser().id){a.my+=1}if(Plurk.isResponded(c)){a.responded+=1}if(c.mentioned){a.mentioned+=1}a.all+=1});return a},getUnreadPlurks:function(){var a=Poll.current_data;var b=[];AJS.map(AJS.values(a.unread_plurks),function(c){if(a.new_plurks[c.id]){return}b.push(c)});return b},showUpdates:function(d){var a=Poll.current_data;var e=AJS.keys(a.new_plurks).length;var c=Poll.getUnreadPlurks().length;var b=e+c;if(window.fluid){if(b==0){window.fluid.dockBadge=""}else{window.fluid.dockBadge=""+b}}AJS.showElement(AJS.$("updater"));AJS.setVisibility(AJS.$("updater"),true);if(b==0&&Poll.mode!="new"){AJS.hideElement(AJS.$("updater"))}if(c>0||Poll.mode=="new"){jQuery("#noti_re_count").html(c);AJS.showElement(AJS.$("noti_re"))}else{AJS.hideElement(AJS.$("noti_re"))}if(e>0&&Poll.mode!="new"){jQuery("#noti_np_count").html(e);AJS.showElement(AJS.$("noti_np"))}else{AJS.hideElement(AJS.$("noti_np"))}Poll.updateCounters()},updateCounters:function(){if(Poll.mode=="new"){var a=Poll.counts=Poll.getUnreadCounts()}else{var a=Poll.counts={all:0,priv:0,favorite:0,replurked:0,responded:0,mentioned:0,my:0}}var b=function(e,c){$elm=jQuery(e);if($elm.length){$elm.html(c>0?'<span class="unread_generic">'+c+"</span>":"");var d=$elm.parent();d.removeClass("has_unread no_unread");if(c>0){d.addClass("has_unread")}else{if(Poll.mode==="new"){d.addClass("no_unread")}}}};b("#count_all_plurk",a.all);b("#count_my_plurks",a.my);b("#count_private_plurks",a.priv);b("#count_favorite_plurks",a.favorite);b("#count_replurked_plurks",a.replurked);b("#count_responded_plurks",a.responded);b("#count_mentioned_plurks",a.mentioned);Users.updateTitle()},_markFirst:function(a){if(a.substring(1,2)===" "){a=a.substring(2)}else{a="<b>"+a.substring(0,1)+"</b>"+a.substring(1)}var b=AJS.setHTML(AJS.SPAN(),a);return b},_viewAll:function(){AJS.hideElement(AJS.$("updater"));Poll.mode=null;TimeLine.reset();Tracks.init();AJS.showElement(AJS.$("noti_re_view"));AJS.hideElement(AJS.$("noti_re_actions"));TimeLine.showLoading();TimeLine.getPlurks(function(){Poll.showUpdates()});window.scrollTo(0,0);return false},__viewAll:function(){Plurks.removeCurrentOpen();TimeLine.showLoading();TimeLine.reset(true);Poll.mode="";Tracks.plurks=Poll._backup_tracks;TimeLine.blocks=Poll._backup_blocks[0];TimeLine.active_blocks=Poll._backup_blocks[1];TimeLine.plurks=Poll._backup_plurks;Poll._backup_plurks=null;Poll._backup_tracks=null;var a=Poll._backup_blocks[2];AJS.map(TimeLine.active_blocks,function(b){b.renderBlock(a);b.renderPlurks(false,a);a+=getBD(b).div_bg.offsetWidth});Poll._backup_blocks=null;AJS.showElement(AJS.$("noti_re_view"));AJS.hideElement(AJS.$("noti_re_actions"));Poll.showUpdates();TimeLine.hideLoading()},_renderPlurks:function(){window.scrollTo(0,0);TimeLine.showLoading();_gaq_push(["_trackEvent","Timeline_tabs","unread"]);var b=Poll.getUnreadPlurks();var a={};AJS.map(b,function(d){a[d.owner_id]=true});Poll._backup_plurks=TimeLine.plurks;Poll._backup_tracks=Tracks.plurks;var c=AJS.getFirst(TimeLine.active_blocks);Poll._backup_blocks=[TimeLine.blocks,TimeLine.active_blocks,c&&getBD(c).div_bg.offsetLeft||0];TimeLine.reset(true);Poll.mode="new";TimeLine.plurks=[];PlurkAdder.fetchUsersIfNeeded(AJS.keys(a),function(){var d=[];AJS.map(b,function(f){if(!SiteState.getPlurkUser(f)){d.push(f.plurk_id);delete Poll.current_data.unread_plurks[f.id]}});if(d.length>0){var e=AJS.getRequest("/Responses/markAllRead");e.sendReq({ids:AJS.serializeJSON(d)})}TimeLine.insertAds(b);TimeLine.insertPlurks(b);DisplayOptions._filterByPoll(function(){Poll.showUpdates(true);TimeLine.hideLoading();var f=false;if(TimeLine.private_only&&Poll.counts.priv==0||TimeLine.responded_only&&Poll.counts.responded==0||TimeLine.mentioned_only&&Poll.counts.mentioned==0||TimeLine.favorite_only&&Poll.counts.favorite==0||TimeLine.replurked_only&&Poll.counts.replurked==0||TimeLine.user_ids&&Poll.counts.my==0){}if(f){DisplayOptions.filterTimeline("all",AJS.$gp(AJS.$("count_all_plurk"),"a"))}})},"rp");AJS.hideElement(AJS.$("noti_re_view"));AJS.showElement(AJS.$("noti_re_actions"));return false},syncNewPlurks:function(){var a=Poll.current_data.new_plurks;AJS.map(AJS.values(a),function(b){if(AJS.$("p"+b.id)){TimeLine.setHightlight(b.id);Plurks.highlightPlurk(b.id);delete a[b.id]}});Poll.showUpdates()},checkPlurks:function(){var c=Poll;if(c.disabled||PlurkAdder.posting||c.p_updating||!c.last_plurk){return}c.p_updating=true;var a=c._generateGetPlurksURL();var b=AJS.loadJSON(a,"GET");b.addCallback(c.fetchedPlurks);b.addErrback(function(){c.p_updating=false});b.sendReq()},setLastPlurk:function(a){if(!Poll.last_plurk){Poll.last_plurk=a}else{if(Poll.last_plurk&&Poll.last_plurk.getTime()<a.getTime()){Poll.last_plurk=a}}},fetchedPlurks:function(d){var c=Poll;if(!TimeLine.fetched_plurks){AJS.setSingleTimeout("fetchedPlurks",AJS.$p(c.fetchedPlurks,d),300);return}var a=c.current_data;if(Array.isArray(d)&&d.length>0){var b={};d.forEach(function(f){if(f==0||Plurk.getById(f.id)){return}if(Poll.last_plurk&&Poll.last_plurk.getTime()>=f.posted.getTime()){return}var e=PlurkAdder.new_plurk_data;if(e){if(e.content==f.content_raw&&e.qualifier==f.qualifier&&e.uid==SiteState.getSessionUser().id){return}}if(Plurk.getById(f.plurk_id,null,"plurk_id")){return}if(typeof f.posted==="string"){f.posted=new Date(f.posted)}a.new_plurks[f.id]=f;Poll.setLastPlurk(f.posted);b[f.owner_id]=true;if(f.anonymous&&SiteState.getSessionUser().num_of_friends<10){return}TimeLineCache.addPlurk(f)});PlurkAdder.fetchUsersIfNeeded(Object.keys(b),function(){},"fdp")}if(d.length>0){if(c.mode!="new"){c.showUpdates()}}Poll.p_updating=false;Users.updateTitle()},_p_count:0,_generateGetPlurksURL:function(){var b=Poll;var c={last_plurk:AJS.serializeJSON(b.last_plurk)};var a="/Poll/getPlurks/"+SiteState.getSessionUser().id+"?"+AJS.encodeArguments(c);a+="&r="+b._p_count++;return a},checkResponses:function(){var d=Poll;if(d.r_updating||Poll.disabled||PlurkAdder.posting){return}d.r_updating=true;var a=d._generateGetResponsesURL();var c=AJS.loadJSON(a,"POST");c.addCallback(d.fetchedResponses);c.addErrback(function(){d.r_updating=false});var e={};if(Poll.current_data.unread_plurks){var b=[];AJS.map(AJS.values(Poll.current_data.unread_plurks),function(f){b.push(f.plurk_id.toString(36))});e.plurk_ids=b.join(",")}c.sendReq(e)},fetchedResponses:function(c){var g=Poll;var a=g.current_data;try{if(c.length>0){var d=0,f=0;var b=SiteState.getSessionUser();AJS.map(c,function(j){var e=Plurk.getById(j.id)||Plurk.getById(j.id,AJS.values(Poll._backup_plurks));var l=a.new_plurks[j.id];if(Plurk.isExpanded(j.plurk_id)){return}if(!a.unread_plurks[j.id]){j.highlight=true}if(e){if(e.is_unread==2){return}a.unread_plurks[e.id]=e;if(e.owner_id==b.id&&j.response_count>e.response_count){d++}if(Plurk.isPrivate(e)&&j.response_count>e.response_count){f++}if(j.response_count>e.response_count){AJS.update(e,{response_count:j.response_count})}AJS.update(e,{content:j.content,content_raw:j.content_raw})}else{if(l){Plurk.updatePlurk(l,{response_count:j.response_count});a.unread_plurks[j.id]=j}else{a.unread_plurks[j.id]=j}}});if(d>0||f>0){}Poll.markRenderedUnreadPlurks(c)}if(c.length>0){Poll.showUpdates()}}catch(h){AJS.log(h)}Poll.r_updating=false;Users.updateTitle()},markRenderedUnreadPlurks:function(a){var b=AJS.$bytc("div","plurk");AJS.map(a,function(d){if(Poll.mode!="unread"&&TimeLine.excludeUser(d.owner_id)){return}var c=Plurk.getById(d.id);if(c&&b){if(Plurk.isExpanded(c.plurk_id)||c.is_unread==2){return}AJS.map(b,function(e){var g=getPD(e);if(!g){return}var f=g.obj.id;if(f==d.id&&e.response_count!=d.response_count){AJS.setHTML(g.response_count,d.response_count);AJS.addClass(e,"new");if(d.highlight&&!TimeLine.highlight_ids[f]){TimeLine.highlight_ids[f]=true;Plurks.highlightPlurk(f,10000)}AJS.showElement(g.response_count)}});Plurk.updatePlurk(c,{response_count:d.response_count})}})},_generateGetResponsesURL:function(){var a="/Poll/getResponsesN/"+SiteState.getSessionUser().id;return a}};ChatPoll={chatResponse:function(c,a,b){if(!$dp.holder_shown){return}var e=$dp.current_div;if(e&&getPD(e).obj.plurk_id==a.id){Responses.addToList(c);var d=AJS.getRequest("/Responses/markAsRead");d.addErrback(function(){});d.sendReq({plurk_id:a.plurk_id,user_id:SiteState.getSessionUser().id});return true}return false}};MOVEMENT_TO=null;WINDOW_ACTIVE=false;function activeWindowChecks(){if(MOVEMENT_TO){clearTimeout(MOVEMENT_TO)}WINDOW_ACTIVE=true;MOVEMENT_TO=setTimeout(setWindowInactive,60000)}function setWindowInactive(){WINDOW_ACTIVE=false}AJS.AEV(window,"focus",function(){activeWindowChecks()});AJS.AEV(window,"blur",function(){setWindowInactive()});AJS.AEV(window,"load",function(){AJS.AEV(document,"click",activeWindowChecks);AJS.AEV(document,"keypress",activeWindowChecks);MOVEMENT_TO=setTimeout(setWindowInactive,60000)});(function(g){var d=null;var f=null;var h=function(j){var l="from=plurk-iframe";if(GLOBAL.session_user&&GLOBAL.session_user.solda_link){l+="&solda_id="+GLOBAL.session_user.solda_link.solda_id}return j+(j.indexOf("?")!=-1?"&":"?")+l};var c=function(j){var n=GLOBAL.session_user;var l={lang:(n&&n.default_lang)||"en"};f=new PlurkPoster(l);f.menu.setQualifier("shares");g(f.input).val(j+" ").focus().trigger("input");var m=g('<div class="share-poster"></div>').css("bottom",-250);m.append(f.table);g(d.view).append(m);f.onSubmit(function(o){f.setPosting(true);jQuery.when(PlurkAdder.addPlurk(o)).done(function(p){b()}).fail(function(p){if(p&&p.msg){alert(p.msg)}f.setPosting(false)})});g('<div class="share-poster-close pif-cancel"></div>').click(function(){b()}).appendTo(m);setTimeout(function(){m.css({bottom:""})},20)};var b=function(){var j=g(d.view).find(".share-poster");j.css("bottom",-j.outerHeight());setTimeout(function(){j.remove();f=null},300)};var e=function(l,m){m=g.extend({url:h(l),width:"80%",height:"90%"},m);var o=m.onClose;m.onClose=function(){d=null;f=null;if(o){o()}};d=new PopWindow(m);d.show();var n=g(d.view);n.addClass("store-window");var j=g('<div class="manager"></div>');g('<a class="pif-outlink" target="_blank">另開視窗</a>').attr("href",l).click(function(){setTimeout(function(){d.close()},20);return true}).appendTo(j);g('<a void class="pif-replurk">分享商品</a>').click(function(){if(f){b()}else{c(l)}}).appendTo(j);n.append(j)};var a=function(j,l){l=g.extend({url:h(j),width:"80%",height:"90%"},l);var m=l.onClose;l.onClose=function(){d=null;if(m){m()}};d=new PopWindow(l);d.show()};StoreWindow={openUrl:function(j,l){if(/\/products\/[0-9]*$/.test(j)){e(j,l)}else{a(j,l)}},openLink:function(m,l){var j=g(m).attr("href");if(j){StoreWindow.openUrl(j,l)}return false}}})(jQuery);TouchEvent={attachTLScroll:function(b){var a=AJS.$(b);if(a==null){return}if(a.addEventListener){a.addEventListener("touchstart",TouchEvent.touchStart,false);a.addEventListener("touchmove",TouchEvent.touchMove,false);a.addEventListener("touchend",TouchEvent.touchEnd,false)}else{if(a.attachEvent){a.attachEvent("touchstart",TouchEvent.touchStart);a.attachEvent("touchmove",TouchEvent.touchMove);a.attachEvent("touchend",TouchEvent.touchEnd)}}},startx:null,starty:null,touchStart:function(a){if(!a.touches.length){return}var b=a.touches[0];TouchEvent.startx=b.pageX;TouchEvent.starty=b.pageY;return false},touchEnd:function(a){if(!a.touches.length){return}TouchEvent.startx=TouchEvent.starty=null;return false},touchMove:function(a){a.preventDefault();if(!a.touches.length){return}var c=a.touches[0];if(!TouchEvent.startx){TouchEvent.startx=c.pageX;return true}var b=c.pageX-TouchEvent.startx;if(b!=0){TimeLine.santa_redlight();Plurks.removeCurrentOpen();if(InfoOverlay.info_view){InfoOverlay.hide()}TimeLine.slideBack(10,b,(b<0)?"right":"left")}TouchEvent.startx=c.pageX;return false}};DisplayOptions={menu:null,timer:null,filterTimeline:function(a,b){Plurks.removeCurrentOpen();this.selectTab(b);this._filter();window.scrollTo(0,0);return false},selectTab:function(c){jQuery("#filter_tab a").removeClass("filter_selected bottom_line_bg").addClass("off_tab");jQuery(c).removeClass("off_tab").addClass("filter_selected bottom_line_bg");var b="all";var a=c.id;switch(a){case"own_plurks_tab_btn":b="own";break;case"private_plurks_tab_btn":b="private";break;case"responded_plurks_tab_btn":b="responded";break;case"mentioned_plurks_tab_btn":b="mentioned";break;case"favorite_plurks_tab_btn":b="favorite";break;case"replurked_plurks_tab_btn":b="replurked";break}DisplayOptions._setRightMode(b)},_setRightMode:function(c){TimeLine.private_only=false;TimeLine.responded_only=false;TimeLine.mentioned_only=false;TimeLine.favorite_only=false;TimeLine.replurked_only=false;TimeLine.mode=c;var b=SiteState.getPageUser().uid;var a=null;if(c=="own"){a=[b]}else{if(c=="private"){TimeLine.private_only=true}else{if(c=="favorite"){TimeLine.favorite_only=true}else{if(c=="replurked"){TimeLine.replurked_only=true}else{if(c=="responded"){TimeLine.responded_only=true}else{if(c=="mentioned"){TimeLine.mentioned_only=true}else{if(c=="all"&&!SiteState.canEdit()){a=AJS.keys(FRIENDS);a.push(b)}}}}}}}TimeLine.user_ids=a},_filterByPoll:function(d){var e=[2,3,6];if(Poll.mode=="new"){var a=TimeLine.user_ids;var b=AJS.values(Poll.current_data.unread_plurks);var c=[];if(TimeLine.mode=="all"){c=b}else{AJS.map(b,function(f){if(TimeLine.private_only&&f.limited_to){c.push(f)}if(TimeLine.favorite_only&&f.favorite){c.push(f)}if(TimeLine.replurked_only&&f.replurked){c.push(f)}if(TimeLine.responded_only&&AJS.isIn(f.plurk_type,e)){c.push(f)}if(TimeLine.mentioned_only&&f.mentioned){c.push(f)}if(a&&AJS.isIn(f.owner_id,a)){c.push(f)}})}TimeLine.reset(true);TimeLine.showLoading();setTimeout(function(){TimeLine.insertPlurks(c);if(AJS.isFunction(d)){d()}else{TimeLine.hideLoading()}},20)}},_filter:function(a){if(Poll.mode=="new"){DisplayOptions._filterByPoll()}else{a=a||TimeLine.getPlurks;TimeLine.reset();Tracks.init();TimeLine.showLoading();a(function(){Poll.syncNewPlurks()})}},show:function(){}};jQuery(document).ready(function(a){var b=function(){if(!window.history){return}var c=window.location.toString();if(c[c.length-1]==="#"){c=c.substr(0,c.length-1);history.replaceState(history.state,"",c)}if(c[c.length-4]==="#_=_"){c=c.substr(0,c.length-4);history.replaceState(history.state,"",c)}}()});(function(a){a.fn.caret=function(h){var g=this[0];var d=g.contentEditable==="true";if(arguments.length==0){if(window.getSelection){if(d){g.focus();var c=window.getSelection().getRangeAt(0),b=c.cloneRange();b.selectNodeContents(g);b.setEnd(c.endContainer,c.endOffset);return b.toString().length}return g.selectionStart}if(document.selection){g.focus();if(d){var c=document.selection.createRange(),b=document.body.createTextRange();b.moveToElementText(g);b.setEndPoint("EndToEnd",c);return b.text.length}var h=0,e=g.createTextRange(),b=document.selection.createRange().duplicate(),f=b.getBookmark();e.moveToBookmark(f);while(e.moveStart("character",-1)!==0){h++}return h}return 0}if(h==-1){h=this[d?"text":"val"]().length}if(window.getSelection){if(d){g.focus();window.getSelection().collapse(g.firstChild,h)}else{g.setSelectionRange(h,h)}}else{if(document.body.createTextRange){var e=document.body.createTextRange();e.moveToElementText(g);e.moveStart("character",h);e.collapse(true);e.select()}}if(!d){g.focus()}return h}})(jQuery);(function(){var a="https:"==document.location.protocol;var b=(a?"https:":"http:")+"//www.googletagservices.com/tag/js/gpt.js";document.write('<script src="'+b+'"><\/script>')})();SendGift={renderSendGift:function(){var a=jQuery("#render_send_gift a:first");if(a.length){var b=function(){SendGift.showSendGift(top.SiteState.getPageUser().id)};a.on("click",b)}},showSendGift:function(a,c){var b="/Premium/gift?user_id="+a;if(c){b+="&birthday=1"}(new PopWindow({url:b,width:600,height:440})).show()}};(function(){var a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(b){return window.setTimeout(b,1000/30)};window.requestAnimationFrame=a})();function isCanvasSupported(){var a=document.createElement("canvas");return !!(a.getContext&&a.getContext("2d"))}var canvas_snow={cv:null,ctx:null,flakes:null,flakeCount:null,mX:null,mY:null,aniID:null,Tracks_init:null,init:function(restart){if(!window.letitsnow){return}var me=canvas_snow;restart=restart||false;if(!canvas_snow.Tracks_init){eval("canvas_snow.Tracks_init = "+Tracks.init.toString());if(!canvas_snow.Tracks_init){return}Tracks.init=function(){me.Tracks_init();var snowTimer=window.setTimeout(canvas_snow.init,1500)}}var cv=me.cv=document.getElementById("snow_canvas");if(!cv){var th=document.getElementById("timeline_holder");if(!th){return}cv=me.cv=document.createElement("canvas");cv.id="snow_canvas";cv.width=th.offsetWidth;cv.height=th.offsetHeight;me.flakeCount=Math.floor(cv.width*cv.height/20000);th.appendChild(cv)}var ctx=me.ctx=cv.getContext("2d");if(me.flakes&&(!restart)){return}var flakeCount=me.flakeCount||50;var flakes=me.flakes=[];var mX=me.mX=-100;var mY=me.mY=-100;for(var i=0;i<flakeCount;i++){var x=Math.floor(Math.random()*cv.width),y=Math.floor(Math.random()*cv.height),size=(Math.random()*2.5)+2,speed=(Math.random()*0.6)+0.2,opacity=(Math.random()*0.5)+0.3;flakes.push({speed:speed,velY:speed,velX:0,x:x,y:y,size:size,stepSize:(Math.random())/80,step:0,angle:180,opacity:opacity})}me.snow()},snow:function(){var j=canvas_snow;var q=j.ctx;var e=j.cv;q.clearRect(0,0,e.width,e.height);for(var d=0;d<j.flakeCount;d++){var f=j.flakes[d],n=j.mX,m=j.mY,o=100,b=f.x,l=f.y;var h=Math.sqrt((b-n)*(b-n)+(l-m)*(l-m)),s=b-n,p=l-m;if(h<o){var c=o/(h*h),a=(n-b)/h,r=(m-l)/h,g=c/2;f.velX-=g*a;f.velY-=g*r}else{f.velX*=0.98;if(f.velY<=f.speed){f.velY=f.speed}f.velX+=Math.cos(f.step+=0.05)*f.stepSize}q.fillStyle="rgba(255,255,255,"+f.opacity+")";f.y+=f.velY;f.x+=f.velX;if(f.y>=e.height||f.y<=0){j.resetFlake(f)}if(f.x>=e.width||f.x<=0){j.resetFlake(f)}q.beginPath();q.arc(f.x,f.y,f.size,0,Math.PI*2);q.fill()}j.aniID=requestAnimationFrame(j.snow)},resetFlake:function(a){a.x=Math.floor(Math.random()*canvas_snow.cv.width);a.y=0;a.size=(Math.random()*2.5)+2;a.speed=(Math.random()*0.6)+0.2;a.velY=a.speed;a.velX=0;a.opacity=(Math.random()*0.5)+0.3}};jQuery(document).ready(function(b){if(!b("body").hasClass("timeline")||!isCanvasSupported()){return}if(document.cookie.replace(/(?:(?:^|.*;\s*)psnow\s*\=\s*([^;]*).*$)|^.*$/,"$1")!=="true"){window.letitsnow=false}else{window.letitsnow=true}var a=b("<span class='snowflake'>❄</span>").appendTo(".timeline");b(".snowflake").click(function(){var c=new Date(Date.now()+(86400*1000*30));if(window.letitsnow){window.letitsnow=false;document.cookie="psnow=false; path=/; expires="+c.toUTCString();b(canvas_snow.cv).remove();window.cancelAnimationFrame(canvas_snow.aniID);window.clearTimeout(canvas_snow.aniID)}else{window.letitsnow=true;document.cookie="psnow=true; path=/; expires="+c.toUTCString();canvas_snow.init(true)}});window.setTimeout(canvas_snow.init,3000)});jQuery(document).ready(function(a){annoplurk={topics:[],initEvt:function(){a.getJSON("/Topics/getTopicsList").done(function(b){if(Array.isArray(b)){annoplurk.topics=b}});a("#timeline_cnt, #vert_timeline").on("click","a.hashtag",function(c){var b=this.text.replace(/^#/,"");_gaq_push(["_trackEvent","hashtag","click",b]);window.open(this.href);return false})},attach:function(d){var c=a(d);if(c.find(".text_holder").length){c=c.find(".text_holder")}var b=c.html();if(b.indexOf("#")>-1){c.html(annoplurk.annotate(b))}},annotate:function(b){var c=/(^|\s|>)#([^\s'"#\(\)<>]+)(?![^<]*<\/a>)/g;return b.replace(c,function(g,f,d){if(d.match(/^\d+$/)){return g}var e=(annoplurk.topics.indexOf(d)>-1)?"/topics/":"/w/#";return f+"<a class='hashtag' target='_blank' href='"+e+d+"'>#"+d+"</a>"})}};annoplurk.initEvt()});